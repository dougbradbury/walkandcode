--- 
name: Roasters (a coffee-themed blog / brochure)
records:
  PageFields: 
    16: 
      name: Description
      page_id: 8
      id: 16
      content: 
    5: 
      name: Keywords
      page_id: 3
      id: 5
      content: 
    22: 
      name: Description
      page_id: 11
      id: 22
      content: 
    11: 
      name: Keywords
      page_id: 6
      id: 11
      content: 
    17: 
      name: Keywords
      page_id: 9
      id: 17
      content: 
    6: 
      name: Description
      page_id: 3
      id: 6
      content: 
    23: 
      name: Keywords
      page_id: 12
      id: 23
      content: 
    12: 
      name: Description
      page_id: 6
      id: 12
      content: 
    1: 
      name: Keywords
      page_id: 1
      id: 1
      content: 
    18: 
      name: Description
      page_id: 9
      id: 18
      content: 
    7: 
      name: Keywords
      page_id: 4
      id: 7
      content: 
    24: 
      name: Description
      page_id: 12
      id: 24
      content: 
    2: 
      name: Description
      page_id: 1
      id: 2
      content: 
    19: 
      name: Keywords
      page_id: 10
      id: 19
      content: 
    8: 
      name: Description
      page_id: 4
      id: 8
      content: 
    25: 
      name: Keywords
      page_id: 13
      id: 25
      content: 
    3: 
      name: Keywords
      page_id: 2
      id: 3
      content: 
    20: 
      name: Description
      page_id: 10
      id: 20
      content: 
    9: 
      name: Keywords
      page_id: 5
      id: 9
      content: 
    26: 
      name: Description
      page_id: 13
      id: 26
      content: 
    15: 
      name: Keywords
      page_id: 8
      id: 15
      content: 
    4: 
      name: Description
      page_id: 2
      id: 4
      content: 
    21: 
      name: Keywords
      page_id: 11
      id: 21
      content: 
    10: 
      name: Description
      page_id: 5
      id: 10
      content: 
  Snippets: 
    5: 
      updated_by_id: 
      name: rss
      created_at: 2008-12-31 07:04:11 Z
      filter_id: ""
      updated_at: 2009-01-02 07:05:37 Z
      created_by_id: 1
      lock_version: 5
      id: 5
      content: |
        <img src="/images/roasters/rss.gif" />
        <h3>RSS</h3>
        <p>Get the <a href="/rss/">feed</a> for our latest news. Neque porro quisquam est, qui dolorem ipsum quia dolor sit amet, consectetur, adipisci velit, sed quia non numquam eius modi tempora.</p>

    6: 
      updated_by_id: 
      name: articles
      created_at: 2009-01-01 22:40:23 Z
      filter_id: ""
      updated_at: 2009-01-02 07:19:28 Z
      created_by_id: 1
      lock_version: 19
      id: 6
      content: |-
        <r:find url="/news">
          <r:children:each order="desc" limit="3">
          <div class="entry">
            <h3><r:link /></h3>
            <div class="posted">
              Posted by <r:author /> on <r:date format="%B %d, %Y" /><em>|</em><img src="/images/roasters/comment.png" /><a href="<r:url />#disqus_thread">Comments</a><em>|</em><r:link>Read full article</r:link>    
            </div>
            <r:content part="summary" />
          </div>
          </r:children:each>
        </r:find>
      
        <r:snippet name="comments_summary" />
    1: 
      updated_by_id: 
      name: header
      created_at: 2008-12-24 01:08:44 Z
      filter_id: ""
      updated_at: 2009-01-02 07:01:43 Z
      created_by_id: 1
      lock_version: 9
      id: 1
      content: |
        <div id="header">
        <img src="/images/roasters/banner.jpg" width="900px" alt="Your Company" />
        </div>

    7: 
      updated_by_id: 
      name: sitemap
      created_at: 2009-01-01 23:51:52 Z
      filter_id: ""
      updated_at: 2009-01-02 00:45:01 Z
      created_by_id: 1
      lock_version: 14
      id: 7
      content: " <r:children:each by=\"title\" order=\"asc\">\r\n   <r:unless_content part=\"no-map\">\r\n     <li>\r\n       <r:link />\r\n       <r:if_children>\r\n         <ul class=\"second\">\r\n           <r:snippet name=\"sitemap\" />\r\n         </ul>\r\n       </r:if_children>\r\n     </li>\r\n   </r:unless_content>\r\n </r:children:each>\r\n\
        \r\n"
    2: 
      updated_by_id: 
      name: footer
      created_at: 2008-12-24 01:08:44 Z
      filter_id: ""
      updated_at: 2009-01-02 07:45:16 Z
      created_by_id: 1
      lock_version: 5
      id: 2
      content: |
        Copyright &copy; <r:date format="%Y" /> your company. All rights reserved | <a href="mailto:info@yourcompany.com">Contact</a> | <a href="/sitemap">Site Map</a> | Powered by <a href="http://radiantcms.org/">Radiant</a>

    8: 
      updated_by_id: 
      name: comments
      created_at: 2009-01-02 02:17:21 Z
      filter_id: ""
      updated_at: 2009-01-02 07:20:55 Z
      created_by_id: 1
      lock_version: 3
      id: 8
      content: |-
        <img src="/images/roasters/comments.jpg" />
      
        <div id="disqus_thread"></div><r:comment><script type="text/javascript" src="http://disqus.com/forums/radiant/embed.js"></script><noscript><a href="http://radiant.disqus.com/?url=ref">View the discussion thread.</a></noscript></r:comment><a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>
    3: 
      updated_by_id: 
      name: navigation
      created_at: 2008-12-30 21:38:09 Z
      filter_id: ""
      updated_at: 2009-01-02 07:45:54 Z
      created_by_id: 1
      lock_version: 9
      id: 3
      content: "<ul>\r\n  <r:navigation urls=\"Home: /\">\r\n      <r:normal><li><a href=\"<r:url />\"><r:title /></a></li></r:normal>\r\n      <r:here><li class=\"selected\"><a href=\"<r:url />\"><r:title /></a></li></r:here>\r\n      <r:selected><li><a href=\"<r:url />\"><r:title /></a></li></r:selected>\r\n  </r:navigation>\r\n  <r:navigation urls=\"Tour: /tour | News: /news | Locations: /locations | About: /about\">\r\n    <r:normal><li><a href=\"<r:url />\"><r:title /></a></li></r:normal>\r\n    <r:here><li class=\"selected\"><a href=\"<r:url />\"><r:title /></a></li></r:here>\r\n    <r:selected><li class=\"selected\"><a href=\"<r:url />\"><r:title /></a></li></r:selected>\r\n  </r:navigation>\r\n\
        </ul>    "
    9: 
      updated_by_id: 
      name: comments_summary
      created_at: 2009-01-02 02:18:23 Z
      filter_id: ""
      updated_at: 2009-01-02 02:59:44 Z
      created_by_id: 1
      lock_version: 4
      id: 9
      content: "\xEF\xBB\xBF\xEF\xBB\xBF\xEF\xBB\xBF\xEF\xBB\xBF<script type=\"text/javascript\">\r\n\
        //<![CDATA[\r\n\
        (function() {\r\n\
        \t\tvar links = document.getElementsByTagName('a');\r\n\
        \t\tvar query = '?';\r\n\
        \t\tfor(var i = 0; i < links.length; i++) {\r\n\
        \t\t\tif(links[i].href.indexOf('#disqus_thread') >= 0) {\r\n\
        \t\t\t\tquery += 'url' + i + '=' + encodeURIComponent(links[i].href) + '&';\r\n\
        \t\t\t}\r\n\
        \t\t}\r\n\
        \t\tdocument.write('<script type=\"text/javascript\" src=\"http://disqus.com/forums/radiant/get_num_replies.js' + query + '\"></' + 'script>');\r\n\
        \t})();\r\n\
        //]]>\r\n\
        </script>\r\n\
        \r\n"
    4: 
      updated_by_id: 
      name: newsletter
      created_at: 2008-12-31 01:08:12 Z
      filter_id: ""
      updated_at: 2009-01-02 06:11:14 Z
      created_by_id: 1
      lock_version: 19
      id: 4
      content: |-
        <div class="box">
          <h3>Our Newsletter</h3>
            <input class="email" value="Enter your email address..." type="text" onfocus="this.value=''"  id="" name="" />
            <input class="subscribe" type="submit" value="Subscribe" />
        </div>
    10: 
      updated_by_id: 
      name: posted
      created_at: 2009-01-02 07:32:00 Z
      filter_id: ""
      updated_at: 2009-01-02 07:32:00 Z
      created_by_id: 1
      lock_version: 0
      id: 10
      content: <div class="posted">Posted by <r:author /> on <r:date format="%B %d, %Y" /><em>|</em><img src="/images/roasters/comment.png" /><a href="<r:url />#disqus_thread">Comments</a></div>
  Pages: 
    16: 
      updated_by_id: 
      slug: reset.css
      class_name: StylesheetPage
      created_at: 2010-10-16 03:53:52 Z
      virtual: true
      title: reset.css
      updated_at: 2010-10-16 03:53:52 Z
      created_by_id: 1
      lock_version: 0
      id: 16
      breadcrumb: reset.css
      parent_id: 15
      status_id: 100
      published_at: 2010-10-16 03:53:52 Z
      layout_id: 
    5: 
      updated_by_id: 
      slug: new-location-opening-tonight
      class_name: Page
      created_at: 2008-12-24 01:08:45 Z
      virtual: false
      title: New location opening tonight
      updated_at: 2009-01-02 09:27:43 Z
      created_by_id: 1
      lock_version: 16
      id: 5
      breadcrumb: New location opening tonight
      parent_id: 4
      status_id: 100
      published_at: 2006-06-09 00:00:00 Z
      layout_id: 
    22: 
      updated_by_id: 
      slug: effects.js
      class_name: JavascriptPage
      created_at: 2010-10-16 04:17:41 Z
      virtual: true
      title: effects.js
      updated_at: 2010-10-16 04:17:41 Z
      created_by_id: 1
      lock_version: 0
      id: 22
      breadcrumb: effects.js
      parent_id: 18
      status_id: 100
      published_at: 2010-10-16 04:17:41 Z
      layout_id: 
    11: 
      updated_by_id: 
      slug: sitemap
      class_name: Page
      created_at: 2009-01-01 23:49:07 Z
      virtual: false
      title: Site Map
      updated_at: 2009-01-02 01:31:41 Z
      created_by_id: 1
      lock_version: 11
      id: 11
      breadcrumb: Site Map
      parent_id: 1
      status_id: 100
      published_at: 2009-01-01 16:49:07 Z
      layout_id: 
    17: 
      updated_by_id: 
      slug: styles.css
      class_name: StylesheetPage
      created_at: 2010-10-16 03:54:15 Z
      virtual: true
      title: styles.css
      updated_at: 2010-10-16 03:54:15 Z
      created_by_id: 1
      lock_version: 0
      id: 17
      breadcrumb: styles.css
      parent_id: 15
      status_id: 100
      published_at: 2010-10-16 03:54:15 Z
      layout_id: 
    6: 
      updated_by_id: 
      slug: grass-fed-foam-from-jersey
      class_name: Page
      created_at: 2008-12-24 01:08:45 Z
      virtual: false
      title: Grass-fed foam from Jersey
      updated_at: 2009-01-02 07:31:42 Z
      created_by_id: 1
      lock_version: 8
      id: 6
      breadcrumb: Grass-fed foam from Jersey
      parent_id: 4
      status_id: 100
      published_at: 2006-06-10 00:00:00 Z
      layout_id: 
    23: 
      updated_by_id: 
      slug: builder.js
      class_name: JavascriptPage
      created_at: 2010-10-16 04:18:05 Z
      virtual: true
      title: builder.js
      updated_at: 2010-10-16 04:18:05 Z
      created_by_id: 1
      lock_version: 0
      id: 23
      breadcrumb: builder.js
      parent_id: 18
      status_id: 100
      published_at: 2010-10-16 04:18:04 Z
      layout_id: 
    12: 
      updated_by_id: 
      slug: locations
      class_name: Page
      created_at: 2009-01-02 02:11:32 Z
      virtual: false
      title: Locations
      updated_at: 2009-01-02 04:08:35 Z
      created_by_id: 1
      lock_version: 8
      id: 12
      breadcrumb: Locations
      parent_id: 1
      status_id: 100
      published_at: 2009-01-01 19:11:32 Z
      layout_id: 
    1: 
      updated_by_id: 
      slug: /
      class_name: Page
      created_at: 2008-12-24 01:08:45 Z
      virtual: false
      title: Home Page
      updated_at: 2009-01-02 07:38:13 Z
      created_by_id: 1
      lock_version: 78
      id: 1
      breadcrumb: Home
      parent_id: 
      status_id: 100
      published_at: 2008-12-23 18:08:45 Z
      layout_id: 1
    18: 
      updated_by_id: 
      slug: js
      class_name: JavascriptPage
      created_at: 2010-10-16 04:06:08 Z
      virtual: true
      title: js
      updated_at: 2010-10-16 04:06:08 Z
      created_by_id: 
      lock_version: 0
      id: 18
      breadcrumb: js
      parent_id: 1
      status_id: 100
      published_at: 2010-10-16 04:06:08 Z
      layout_id: 
    13: 
      updated_by_id: 
      slug: tour
      class_name: Page
      created_at: 2009-01-02 07:36:32 Z
      virtual: false
      title: Tour
      updated_at: 2009-01-02 09:48:51 Z
      created_by_id: 1
      lock_version: 25
      id: 13
      breadcrumb: Tour
      parent_id: 1
      status_id: 100
      published_at: 2009-01-02 00:49:40 Z
      layout_id: 
    2: 
      updated_by_id: 
      slug: file-not-found
      class_name: FileNotFoundPage
      created_at: 2008-12-24 01:08:45 Z
      virtual: true
      title: File Not Found
      updated_at: 2008-12-24 01:08:45 Z
      created_by_id: 1
      lock_version: 0
      id: 2
      breadcrumb: File Not Found
      parent_id: 1
      status_id: 100
      published_at: 2008-12-23 18:08:45 Z
      layout_id: 
    19: 
      updated_by_id: 
      slug: swfobject.js
      class_name: JavascriptPage
      created_at: 2010-10-16 04:06:40 Z
      virtual: true
      title: swfobject.js
      updated_at: 2010-10-16 04:06:40 Z
      created_by_id: 1
      lock_version: 0
      id: 19
      breadcrumb: swfobject.js
      parent_id: 18
      status_id: 100
      published_at: 2010-10-16 04:06:40 Z
      layout_id: 
    8: 
      updated_by_id: 
      slug: the-finest-grind
      class_name: Page
      created_at: 2008-12-24 01:08:45 Z
      virtual: false
      title: The Finest grind
      updated_at: 2009-01-02 09:27:11 Z
      created_by_id: 1
      lock_version: 11
      id: 8
      breadcrumb: The Finest grind
      parent_id: 4
      status_id: 100
      published_at: 2008-12-23 18:08:45 Z
      layout_id: 
    3: 
      updated_by_id: 
      slug: rss
      class_name: 
      created_at: 2008-12-24 01:08:45 Z
      virtual: false
      title: RSS Feed
      updated_at: 2008-12-24 01:08:45 Z
      created_by_id: 1
      lock_version: 0
      id: 3
      breadcrumb: RSS Feed
      parent_id: 1
      status_id: 100
      published_at: 2008-12-23 18:08:45 Z
      layout_id: 3
    20: 
      updated_by_id: 
      slug: prototype.js
      class_name: JavascriptPage
      created_at: 2010-10-16 04:11:38 Z
      virtual: true
      title: prototype.js
      updated_at: 2010-10-16 04:11:38 Z
      created_by_id: 1
      lock_version: 0
      id: 20
      breadcrumb: prototype.js
      parent_id: 18
      status_id: 100
      published_at: 2010-10-16 04:11:38 Z
      layout_id: 
    9: 
      updated_by_id: 
      slug: about
      class_name: Page
      created_at: 2008-12-24 01:08:45 Z
      virtual: false
      title: About
      updated_at: 2009-01-02 09:22:02 Z
      created_by_id: 1
      lock_version: 9
      id: 9
      breadcrumb: About
      parent_id: 1
      status_id: 100
      published_at: 2008-12-23 18:08:45 Z
      layout_id: 
    15: 
      updated_by_id: 
      slug: css
      class_name: StylesheetPage
      created_at: 2010-10-16 03:53:40 Z
      virtual: true
      title: css
      updated_at: 2010-10-16 03:53:40 Z
      created_by_id: 1
      lock_version: 0
      id: 15
      breadcrumb: css
      parent_id: 1
      status_id: 100
      published_at: 2010-10-16 03:53:40 Z
      layout_id: 
    4: 
      updated_by_id: 
      slug: news
      class_name: ArchivePage
      created_at: 2008-12-24 01:08:45 Z
      virtual: false
      title: Articles
      updated_at: 2009-01-02 07:27:53 Z
      created_by_id: 1
      lock_version: 18
      id: 4
      breadcrumb: News
      parent_id: 1
      status_id: 100
      published_at: 2008-12-23 18:08:45 Z
      layout_id: 
    21: 
      updated_by_id: 1
      slug: lightbox.js
      class_name: JavascriptPage
      created_at: 2010-10-16 04:15:58 Z
      virtual: true
      title: lightbox.js
      updated_at: 2010-10-16 04:20:36 Z
      created_by_id: 1
      lock_version: 1
      id: 21
      breadcrumb: lightbox.js
      parent_id: 18
      status_id: 100
      published_at: 2010-10-16 04:20:36 Z
      layout_id: 
    10: 
      updated_by_id: 
      slug: monthly-archives
      class_name: ArchiveMonthIndexPage
      created_at: 2008-12-24 01:08:45 Z
      virtual: true
      title: "%B %Y Archives"
      updated_at: 2009-01-02 07:29:46 Z
      created_by_id: 1
      lock_version: 9
      id: 10
      breadcrumb: Monthly Archives
      parent_id: 4
      status_id: 100
      published_at: 2008-12-23 18:08:45 Z
      layout_id: 
  Layouts: 
    1: 
      updated_by_id: 1
      name: Normal
      created_at: 2008-12-24 01:08:45 Z
      content_type: ""
      updated_at: 2010-10-16 04:18:46 Z
      created_by_id: 1
      lock_version: 37
      id: 1
      content: |
        <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
          "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
        <html>
          <head>
            <title><r:title /></title>
            <link href="/rss/" rel="alternate" title="RSS" type="application/rss+xml" />
            <link rel="stylesheet" type="text/css" href="/css/reset.css" />
            <link rel="stylesheet" type="text/css" href="/css/styles.css" />
            <script type="text/javascript" src="/js/swfobject.js"></script>
            <script type="text/javascript" src="/js/prototype.js"></script>
            <script type="text/javascript" src="/js/effects.js"></script>
            <script type="text/javascript" src="/js/builder.js"></script>
            <script type="text/javascript" src="/js/lightbox.js"></script>
      
            <!--[if IE 6]>
              <style type="text/css" media="screen">
                @import url("/css/ie6.css");
              </style>
            <![endif]-->
      
            <!--[if IE 7]>
              <style type="text/css" media="screen">
                @import url("/css/ie7.css");
              </style>
            <![endif]-->
      
          </head>
          <body>
            <div id="page">
              <r:snippet name="header" />
              <div id="nav">
                <r:snippet name="navigation" />
              </div>
              <div id="main">
                <div id="content-wrapper">
                  <div id="content">
                    <r:content />
                    <r:if_content part="extended">
                    <div id="extended">
                      <r:content part="extended" />
                    </div>
                    </r:if_content>
                  </div>
                </div>
                <div id="sidebar-wrapper">
                  <div id="sidebar">
                    <r:content part="sidebar" inherit="true" />
                  </div>
                </div>
              </div>
            <div style="clear:both"></div>
            </div>
          </body>
          <div id="footer-wrapper">
            <div id="footer">
              <r:snippet name="footer" />
            </div>
          </div>
        </html>

    3: 
      updated_by_id: 
      name: XML Feed
      created_at: 2008-12-24 01:08:45 Z
      content_type: text/xml
      updated_at: 2008-12-24 01:08:45 Z
      created_by_id: 1
      lock_version: 0
      id: 3
      content: |
        <r:content />

  PageParts: 
    16: 
      name: summary
      filter_id: Textile
      page_id: 8
      id: 16
      content: Vivamus mollis porttitor odio. Vestibulum id mi. Suspendisse a tortor quis metus imperdiet eleifend. Pellentesque libero nulla, aliquam in, tristique vel, elementum et, odio. Fusce id ligula. Vivamus dapibus imperdiet ante. Aliquam id eros ut velit eleifend aliquet. Nulla commodo viverra orci. Sed auctor. Maecenas commodo. Mauris adipiscing lectus quis quam. Nulla a nisl in augue suscipit tincidunt. Nunc eros. Nam eget sapien eget lorem ultrices pulvinar. Vivamus dolor.
    27: 
      name: body
      filter_id: ""
      page_id: 15
      id: 27
      content: 
    5: 
      name: body
      filter_id: Textile
      page_id: 5
      id: 5
      content: |
        <h3><r:title /></h3>
        <r:snippet name="posted" />
      
        At vero eos et accusamus et iusto odio dignissimos ducimus qui blanditiis praesentium voluptatum deleniti atque corrupti quos dolores et quas molestias excepturi sint occaecati cupiditate non provident, similique sunt in culpa qui officia deserunt mollitia animi, id est laborum et dolorum fuga. Et harum quidem rerum facilis est et expedita distinctio. Nam libero tempore, cum soluta nobis est eligendi optio cumque nihil impedit quo minus id quod maxime placeat facere possimus, omnis voluptas assumenda est, omnis dolor repellendus.
      
        Temporibus autem quibusdam et aut officiis debitis aut rerum necessitatibus saepe eveniet ut et voluptates repudiandae sint et molestiae non recusandae. Itaque earum rerum hic tenetur a sapiente delectus, ut aut reiciendis voluptatibus maiores alias consequatur aut perferendis doloribus asperiores repellat.
      
        Sed ut perspiciatis unde omnis iste natus error sit voluptatem accusantium doloremque laudantium, totam rem aperiam, eaque ipsa quae ab illo inventore veritatis et quasi architecto beatae vitae dicta sunt explicabo. Nemo enim ipsam voluptatem quia voluptas sit aspernatur aut odit aut fugit, sed quia consequuntur magni dolores eos qui ratione voluptatem sequi nesciunt.
      
        <r:snippet name="comments" />

    22: 
      name: sidebar
      filter_id: ""
      page_id: 12
      id: 22
      content: ""
    11: 
      name: sidebar
      filter_id: ""
      page_id: 9
      id: 11
      content: |
        <div class="box" style="margin-top:50px">
          <h3>Main office</h3>
          222 Address Street<br />
          Portland, OR 97008<br />
          (503) 545-7777
        </div>

    33: 
      name: body
      filter_id: ""
      page_id: 21
      id: 33
      content: |-
        // -----------------------------------------------------------------------------------
        //
        //  Lightbox v2.04
        //  by Lokesh Dhakar - http://www.lokeshdhakar.com
        //  Last Modification: 2/9/08
        //
        //  For more information, visit:
        //  http://lokeshdhakar.com/projects/lightbox2/
        //
        //  Licensed under the Creative Commons Attribution 2.5 License - http://creativecommons.org/licenses/by/2.5/
        //    - Free for use in both personal and commercial projects
        //    - Attribution requires leaving author name, author link, and the license info intact.
        //  
        //  Thanks: Scott Upton(uptonic.com), Peter-Paul Koch(quirksmode.com), and Thomas Fuchs(mir.aculo.us) for ideas, libs, and snippets.
        //      Artemy Tregubenko (arty.name) for cleanup and help in updating to latest ver of proto-aculous.
        //
        // -----------------------------------------------------------------------------------
        /*
      
            Table of Contents
            -----------------
            Configuration
      
            Lightbox Class Declaration
            - initialize()
            - updateImageList()
            - start()
            - changeImage()
            - resizeImageContainer()
            - showImage()
            - updateDetails()
            - updateNav()
            - enableKeyboardNav()
            - disableKeyboardNav()
            - keyboardAction()
            - preloadNeighborImages()
            - end()
          
            Function Calls
            - document.observe()
         
        */
        // -----------------------------------------------------------------------------------
      
        //
        //  Configurationl
        //
        LightboxOptions = Object.extend({
            fileLoadingImage:        '/images/roasters/loading.gif',     
            fileBottomNavCloseImage: '/images/roasters/closelabel.gif',
      
            overlayOpacity: 0.8,   // controls transparency of shadow overlay
      
            animate: true,         // toggles resizing animations
            resizeSpeed: 7,        // controls the speed of the image resizing animations (1=slowest and 10=fastest)
      
            borderSize: 10,         //if you adjust the padding in the CSS, you will need to update this variable
      
          // When grouping images this is used to write: Image # of #.
          // Change it for non-english localization
          labelImage: "Image",
          labelOf: "of"
        }, window.LightboxOptions || {});
      
        // -----------------------------------------------------------------------------------
      
        var Lightbox = Class.create();
      
        Lightbox.prototype = {
            imageArray: [],
            activeImage: undefined,
          
            // initialize()
            // Constructor runs on completion of the DOM loading. Calls updateImageList and then
            // the function inserts html at the bottom of the page which is used to display the shadow 
            // overlay and the image container.
            //
            initialize: function() {    
              
                this.updateImageList();
              
                this.keyboardAction = this.keyboardAction.bindAsEventListener(this);
      
                if (LightboxOptions.resizeSpeed > 10) LightboxOptions.resizeSpeed = 10;
                if (LightboxOptions.resizeSpeed < 1)  LightboxOptions.resizeSpeed = 1;
      
              this.resizeDuration = LightboxOptions.animate ? ((11 - LightboxOptions.resizeSpeed) * 0.15) : 0;
              this.overlayDuration = LightboxOptions.animate ? 0.2 : 0;  // shadow fade in/out duration
      
                // When Lightbox starts it will resize itself from 250 by 250 to the current image dimension.
                // If animations are turned off, it will be hidden as to prevent a flicker of a
                // white 250 by 250 box.
                var size = (LightboxOptions.animate ? 250 : 1) + 'px';
              
      
                // Code inserts html at the bottom of the page that looks similar to this:
                //
                //  <div id="overlay"></div>
                //  <div id="lightbox">
                //      <div id="outerImageContainer">
                //          <div id="imageContainer">
                //              <img id="lightboxImage">
                //              <div style="" id="hoverNav">
                //                  <a href="#" id="prevLink"></a>
                //                  <a href="#" id="nextLink"></a>
                //              </div>
                //              <div id="loading">
                //                  <a href="#" id="loadingLink">
                //                      <img src="/images/roasters/loading.gif">
                //                  </a>
                //              </div>
                //          </div>
                //      </div>
                //      <div id="imageDataContainer">
                //          <div id="imageData">
                //              <div id="imageDetails">
                //                  <span id="caption"></span>
                //                  <span id="numberDisplay"></span>
                //              </div>
                //              <div id="bottomNav">
                //                  <a href="#" id="bottomNavClose">
                //                      <img src="images/roasters/close.gif">
                //                  </a>
                //              </div>
                //          </div>
                //      </div>
                //  </div>
      
      
                var objBody = $$('body')[0];
      
            objBody.appendChild(Builder.node('div',{id:'overlay'}));
        
                objBody.appendChild(Builder.node('div',{id:'lightbox'}, [
                    Builder.node('div',{id:'outerImageContainer'}, 
                        Builder.node('div',{id:'imageContainer'}, [
                            Builder.node('img',{id:'lightboxImage'}), 
                            Builder.node('div',{id:'hoverNav'}, [
                                Builder.node('a',{id:'prevLink', href: '#' }),
                                Builder.node('a',{id:'nextLink', href: '#' })
                            ]),
                            Builder.node('div',{id:'loading'}, 
                                Builder.node('a',{id:'loadingLink', href: '#' }, 
                                    Builder.node('img', {src: LightboxOptions.fileLoadingImage})
                                )
                            )
                        ])
                    ),
                    Builder.node('div', {id:'imageDataContainer'},
                        Builder.node('div',{id:'imageData'}, [
                            Builder.node('div',{id:'imageDetails'}, [
                                Builder.node('span',{id:'caption'}),
                                Builder.node('span',{id:'numberDisplay'})
                            ]),
                            Builder.node('div',{id:'bottomNav'},
                                Builder.node('a',{id:'bottomNavClose', href: '#' },
                                    Builder.node('img', { src: LightboxOptions.fileBottomNavCloseImage })
                                )
                            )
                        ])
                    )
                ]));
      
      
            $('overlay').hide().observe('click', (function() { this.end(); }).bind(this));
            $('lightbox').hide().observe('click', (function(event) { if (event.element().id == 'lightbox') this.end(); }).bind(this));
            $('outerImageContainer').setStyle({ width: size, height: size });
            $('prevLink').observe('click', (function(event) { event.stop(); this.changeImage(this.activeImage - 1); }).bindAsEventListener(this));
            $('nextLink').observe('click', (function(event) { event.stop(); this.changeImage(this.activeImage + 1); }).bindAsEventListener(this));
            $('loadingLink').observe('click', (function(event) { event.stop(); this.end(); }).bind(this));
            $('bottomNavClose').observe('click', (function(event) { event.stop(); this.end(); }).bind(this));
      
                var th = this;
                (function(){
                    var ids = 
                        'overlay lightbox outerImageContainer imageContainer lightboxImage hoverNav prevLink nextLink loading loadingLink ' + 
                        'imageDataContainer imageData imageDetails caption numberDisplay bottomNav bottomNavClose';   
                    $w(ids).each(function(id){ th[id] = $(id); });
                }).defer();
            },
      
            //
            // updateImageList()
            // Loops through anchor tags looking for 'lightbox' references and applies onclick
            // events to appropriate links. You can rerun after dynamically adding images w/ajax.
            //
            updateImageList: function() {   
                this.updateImageList = Prototype.emptyFunction;
      
                document.observe('click', (function(event){
                    var target = event.findElement('a[rel^=lightbox]') || event.findElement('area[rel^=lightbox]');
                    if (target) {
                        event.stop();
                        this.start(target);
                    }
                }).bind(this));
            },
          
            //
            //  start()
            //  Display overlay and lightbox. If image is part of a set, add siblings to imageArray.
            //
            start: function(imageLink) {    
      
                $$('select', 'object', 'embed').each(function(node){ node.style.visibility = 'hidden' });
      
                // stretch overlay to fill page and fade in
                var arrayPageSize = this.getPageSize();
                $('overlay').setStyle({ width: arrayPageSize[0] + 'px', height: arrayPageSize[1] + 'px' });
      
                new Effect.Appear(this.overlay, { duration: this.overlayDuration, from: 0.0, to: LightboxOptions.overlayOpacity });
      
                this.imageArray = [];
                var imageNum = 0;       
      
                if ((imageLink.rel == 'lightbox')){
                    // if image is NOT part of a set, add single image to imageArray
                    this.imageArray.push([imageLink.href, imageLink.title]);         
                } else {
                    // if image is part of a set..
                    this.imageArray = 
                        $$(imageLink.tagName + '[href][rel="' + imageLink.rel + '"]').
                        collect(function(anchor){ return [anchor.href, anchor.title]; }).
                        uniq();
                  
                    while (this.imageArray[imageNum][0] != imageLink.href) { imageNum++; }
                }
      
                // calculate top and left offset for the lightbox 
                var arrayPageScroll = document.viewport.getScrollOffsets();
                var lightboxTop = arrayPageScroll[1] + (document.viewport.getHeight() / 10);
                var lightboxLeft = arrayPageScroll[0];
                this.lightbox.setStyle({ top: lightboxTop + 'px', left: lightboxLeft + 'px' }).show();
              
                this.changeImage(imageNum);
            },
      
            //
            //  changeImage()
            //  Hide most elements and preload image in preparation for resizing image container.
            //
            changeImage: function(imageNum) {   
              
                this.activeImage = imageNum; // update global var
      
                // hide elements during transition
                if (LightboxOptions.animate) this.loading.show();
                this.lightboxImage.hide();
                this.hoverNav.hide();
                this.prevLink.hide();
                this.nextLink.hide();
            // HACK: Opera9 does not currently support scriptaculous opacity and appear fx
                this.imageDataContainer.setStyle({opacity: .0001});
                this.numberDisplay.hide();      
              
                var imgPreloader = new Image();
              
                // once image is preloaded, resize image container
      
      
                imgPreloader.onload = (function(){
                    this.lightboxImage.src = this.imageArray[this.activeImage][0];
                    this.resizeImageContainer(imgPreloader.width, imgPreloader.height);
                }).bind(this);
                imgPreloader.src = this.imageArray[this.activeImage][0];
            },
      
            //
            //  resizeImageContainer()
            //
            resizeImageContainer: function(imgWidth, imgHeight) {
      
                // get current width and height
                var widthCurrent  = this.outerImageContainer.getWidth();
                var heightCurrent = this.outerImageContainer.getHeight();
      
                // get new width and height
                var widthNew  = (imgWidth  + LightboxOptions.borderSize * 2);
                var heightNew = (imgHeight + LightboxOptions.borderSize * 2);
      
                // scalars based on change from old to new
                var xScale = (widthNew  / widthCurrent)  * 100;
                var yScale = (heightNew / heightCurrent) * 100;
      
                // calculate size difference between new and old image, and resize if necessary
                var wDiff = widthCurrent - widthNew;
                var hDiff = heightCurrent - heightNew;
      
                if (hDiff != 0) new Effect.Scale(this.outerImageContainer, yScale, {scaleX: false, duration: this.resizeDuration, queue: 'front'}); 
                if (wDiff != 0) new Effect.Scale(this.outerImageContainer, xScale, {scaleY: false, duration: this.resizeDuration, delay: this.resizeDuration}); 
      
                // if new and old image are same size and no scaling transition is necessary, 
                // do a quick pause to prevent image flicker.
                var timeout = 0;
                if ((hDiff == 0) && (wDiff == 0)){
                    timeout = 100;
                    if (Prototype.Browser.IE) timeout = 250;   
                }
      
                (function(){
                    this.prevLink.setStyle({ height: imgHeight + 'px' });
                    this.nextLink.setStyle({ height: imgHeight + 'px' });
                    this.imageDataContainer.setStyle({ width: widthNew + 'px' });
      
                    this.showImage();
                }).bind(this).delay(timeout / 1000);
            },
          
            //
            //  showImage()
            //  Display image and begin preloading neighbors.
            //
            showImage: function(){
                this.loading.hide();
                new Effect.Appear(this.lightboxImage, { 
                    duration: this.resizeDuration, 
                    queue: 'end', 
                    afterFinish: (function(){ this.updateDetails(); }).bind(this) 
                });
                this.preloadNeighborImages();
            },
      
            //
            //  updateDetails()
            //  Display caption, image number, and bottom nav.
            //
            updateDetails: function() {
          
                // if caption is not null
                if (this.imageArray[this.activeImage][1] != ""){
                    this.caption.update(this.imageArray[this.activeImage][1]).show();
                }
              
                // if image is part of set display 'Image x of x' 
                if (this.imageArray.length > 1){
                    this.numberDisplay.update( LightboxOptions.labelImage + ' ' + (this.activeImage + 1) + ' ' + LightboxOptions.labelOf + '  ' + this.imageArray.length).show();
                }
      
                new Effect.Parallel(
                    [ 
                        new Effect.SlideDown(this.imageDataContainer, { sync: true, duration: this.resizeDuration, from: 0.0, to: 1.0 }), 
                        new Effect.Appear(this.imageDataContainer, { sync: true, duration: this.resizeDuration }) 
                    ], 
                    { 
                        duration: this.resizeDuration, 
                        afterFinish: (function() {
                          // update overlay size and update nav
                          var arrayPageSize = this.getPageSize();
                          this.overlay.setStyle({ height: arrayPageSize[1] + 'px' });
                          this.updateNav();
                        }).bind(this)
                    } 
                );
            },
      
            //
            //  updateNav()
            //  Display appropriate previous and next hover navigation.
            //
            updateNav: function() {
      
                this.hoverNav.show();               
      
                // if not first image in set, display prev image button
                if (this.activeImage > 0) this.prevLink.show();
      
                // if not last image in set, display next image button
                if (this.activeImage < (this.imageArray.length - 1)) this.nextLink.show();
              
                this.enableKeyboardNav();
            },
      
            //
            //  enableKeyboardNav()
            //
            enableKeyboardNav: function() {
                document.observe('keydown', this.keyboardAction); 
            },
      
            //
            //  disableKeyboardNav()
            //
            disableKeyboardNav: function() {
                document.stopObserving('keydown', this.keyboardAction); 
            },
      
            //
            //  keyboardAction()
            //
            keyboardAction: function(event) {
                var keycode = event.keyCode;
      
                var escapeKey;
                if (event.DOM_VK_ESCAPE) {  // mozilla
                    escapeKey = event.DOM_VK_ESCAPE;
                } else { // ie
                    escapeKey = 27;
                }
      
                var key = String.fromCharCode(keycode).toLowerCase();
              
                if (key.match(/x|o|c/) || (keycode == escapeKey)){ // close lightbox
                    this.end();
                } else if ((key == 'p') || (keycode == 37)){ // display previous image
                    if (this.activeImage != 0){
                        this.disableKeyboardNav();
                        this.changeImage(this.activeImage - 1);
                    }
                } else if ((key == 'n') || (keycode == 39)){ // display next image
                    if (this.activeImage != (this.imageArray.length - 1)){
                        this.disableKeyboardNav();
                        this.changeImage(this.activeImage + 1);
                    }
                }
            },
      
            //
            //  preloadNeighborImages()
            //  Preload previous and next images.
            //
            preloadNeighborImages: function(){
                var preloadNextImage, preloadPrevImage;
                if (this.imageArray.length > this.activeImage + 1){
                    preloadNextImage = new Image();
                    preloadNextImage.src = this.imageArray[this.activeImage + 1][0];
                }
                if (this.activeImage > 0){
                    preloadPrevImage = new Image();
                    preloadPrevImage.src = this.imageArray[this.activeImage - 1][0];
                }
          
            },
      
            //
            //  end()
            //
            end: function() {
                this.disableKeyboardNav();
                this.lightbox.hide();
                new Effect.Fade(this.overlay, { duration: this.overlayDuration });
                $$('select', 'object', 'embed').each(function(node){ node.style.visibility = 'visible' });
            },
      
            //
            //  getPageSize()
            //
            getPageSize: function() {
                
               var xScroll, yScroll;
          
            if (window.innerHeight && window.scrollMaxY) {  
              xScroll = window.innerWidth + window.scrollMaxX;
              yScroll = window.innerHeight + window.scrollMaxY;
            } else if (document.body.scrollHeight > document.body.offsetHeight){ // all but Explorer Mac
              xScroll = document.body.scrollWidth;
              yScroll = document.body.scrollHeight;
            } else { // Explorer Mac...would also work in Explorer 6 Strict, Mozilla and Safari
              xScroll = document.body.offsetWidth;
              yScroll = document.body.offsetHeight;
            }
          
            var windowWidth, windowHeight;
          
            if (self.innerHeight) {  // all except Explorer
              if(document.documentElement.clientWidth){
                windowWidth = document.documentElement.clientWidth; 
              } else {
                windowWidth = self.innerWidth;
              }
              windowHeight = self.innerHeight;
            } else if (document.documentElement && document.documentElement.clientHeight) { // Explorer 6 Strict Mode
              windowWidth = document.documentElement.clientWidth;
              windowHeight = document.documentElement.clientHeight;
            } else if (document.body) { // other Explorers
              windowWidth = document.body.clientWidth;
              windowHeight = document.body.clientHeight;
            }  
          
            // for small pages with total height less then height of the viewport
            if(yScroll < windowHeight){
              pageHeight = windowHeight;
            } else { 
              pageHeight = yScroll;
            }
        
            // for small pages with total width less then width of the viewport
            if(xScroll < windowWidth){  
              pageWidth = xScroll;    
            } else {
              pageWidth = windowWidth;
            }
      
            return [pageWidth,pageHeight];
          }
        }
      
        document.observe('dom:loaded', function () { new Lightbox(); });
    28: 
      name: body
      filter_id: ""
      page_id: 16
      id: 28
      content: |
        /* -------------------------------------------------------------- 
      
           reset.css
           * Resets default browser CSS.
      
           Based on work by Eric Meyer:
           * meyerweb.com/eric/thoughts/2007/05/01/reset-reloaded/
      
           Icons are available for purchase at:
           * http://www.istockphoto.com/file_closeup/arts-and-entertainment/arts-symbols/4575877-satin-icons-set-9.php?id=4575877
      
        -------------------------------------------------------------- */
      
        html, body, div, span, object, iframe,
        h1, h2, h3, h4, h5, h6, p, blockquote, pre,
        a, abbr, acronym, address, code,
        del, dfn, em, img, q, dl, dt, dd, ol, ul, li,
        fieldset, form, label, legend,
        table, caption, tbody, tfoot, thead, tr, th, td {
          margin: 0;
          padding: 0;
          border: 0;
          font-weight: inherit;
          font-style: inherit;
          font-size: 100%;
          font-family: inherit;
          vertical-align: baseline;
        }
      
      
        body { line-height: 1.5; background: #fff; margin:1.5em 0; }
      
        /* Tables still need 'cellspacing="0"' in the markup. */
        table { border-collapse: separate; border-spacing: 0; }
        caption, th, td { text-align: left; font-weight:400; }
      
        /* Remove possible quote marks (") from <q>, <blockquote>. */
        blockquote:before, blockquote:after, q:before, q:after { content: ""; }
        blockquote, q { quotes: "" ""; }
      
        a img { border: none; }

    17: 
      name: body
      filter_id: ""
      page_id: 11
      id: 17
      content: |
        <h2>Site Map</h2>
      
        <div id="sitemap">
         <ul>
           <r:find url="/">
             <r:snippet name="sitemap" />
           </r:find>
         </ul>
        </div>

    6: 
      name: body
      filter_id: Textile
      page_id: 6
      id: 6
      content: |-
        <h3><r:title /></h3>
        <r:snippet name="posted" />
      
        Ut enim ad minima veniam, quis nostrum exercitationem ullam corporis suscipit laboriosam, nisi ut aliquid ex ea commodi consequatur? Quis autem vel eum iure reprehenderit qui in ea voluptate velit esse quam nihil molestiae consequatur, vel illum qui dolorem eum fugiat quo voluptas nulla pariatur?
      
        Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.
      
        Nemo enim ipsam voluptatem quia voluptas sit aspernatur aut odit aut fugit, sed quia consequuntur magni dolores eos qui ratione voluptatem sequi nesciunt. Neque porro quisquam est, qui dolorem ipsum quia dolor sit amet, consectetur, adipisci velit, sed quia non numquam eius modi tempora incidunt ut labore et dolore magnam aliquam quaerat voluptatem. 
      
        <r:snippet name="comments" />
    12: 
      name: sidebar
      filter_id: ""
      page_id: 4
      id: 12
      content: |-
        <div class="box">
        <h3>News Archives</h3>
        <ul>
        <r:find url="/news/">
        <r:children:each order="desc">
        <r:header><li><a href="<r:date format="/news/%Y/%m/" />"><r:date format="%B %Y" /></a></li></r:header>
        </r:children:each>
        </r:find>
        </ul>
        </div>
      
        <r:snippet name="newsletter" />
      
        <div class="spot"><r:snippet name="rss" /></div>
    34: 
      name: body
      filter_id: ""
      page_id: 22
      id: 34
      content: |-
        // script.aculo.us effects.js v1.8.1, Thu Jan 03 22:07:12 -0500 2008
      
        // Copyright (c) 2005-2007 Thomas Fuchs (http://script.aculo.us, http://mir.aculo.us)
        // Contributors:
        //  Justin Palmer (http://encytemedia.com/)
        //  Mark Pilgrim (http://diveintomark.org/)
        //  Martin Bialasinki
        // 
        // script.aculo.us is freely distributable under the terms of an MIT-style license.
        // For details, see the script.aculo.us web site: http://script.aculo.us/ 
      
        // converts rgb() and #xxx to #xxxxxx format,  
        // returns self (or first argument) if not convertable  
        String.prototype.parseColor = function() {  
          var color = '#';
          if (this.slice(0,4) == 'rgb(') {  
            var cols = this.slice(4,this.length-1).split(',');  
            var i=0; do { color += parseInt(cols[i]).toColorPart() } while (++i<3);  
          } else {  
            if (this.slice(0,1) == '#') {  
              if (this.length==4) for(var i=1;i<4;i++) color += (this.charAt(i) + this.charAt(i)).toLowerCase();  
              if (this.length==7) color = this.toLowerCase();  
            }  
          }  
          return (color.length==7 ? color : (arguments[0] || this));  
        };
      
        /*--------------------------------------------------------------------------*/
      
        Element.collectTextNodes = function(element) {  
          return $A($(element).childNodes).collect( function(node) {
            return (node.nodeType==3 ? node.nodeValue : 
              (node.hasChildNodes() ? Element.collectTextNodes(node) : ''));
          }).flatten().join('');
        };
      
        Element.collectTextNodesIgnoreClass = function(element, className) {  
          return $A($(element).childNodes).collect( function(node) {
            return (node.nodeType==3 ? node.nodeValue : 
              ((node.hasChildNodes() && !Element.hasClassName(node,className)) ? 
                Element.collectTextNodesIgnoreClass(node, className) : ''));
          }).flatten().join('');
        };
      
        Element.setContentZoom = function(element, percent) {
          element = $(element);  
          element.setStyle({fontSize: (percent/100) + 'em'});   
          if (Prototype.Browser.WebKit) window.scrollBy(0,0);
          return element;
        };
      
        Element.getInlineOpacity = function(element){
          return $(element).style.opacity || '';
        };
      
        Element.forceRerendering = function(element) {
          try {
            element = $(element);
            var n = document.createTextNode(' ');
            element.appendChild(n);
            element.removeChild(n);
          } catch(e) { }
        };
      
        /*--------------------------------------------------------------------------*/
      
        var Effect = {
          _elementDoesNotExistError: {
            name: 'ElementDoesNotExistError',
            message: 'The specified DOM element does not exist, but is required for this effect to operate'
          },
          Transitions: {
            linear: Prototype.K,
            sinoidal: function(pos) {
              return (-Math.cos(pos*Math.PI)/2) + 0.5;
            },
            reverse: function(pos) {
              return 1-pos;
            },
            flicker: function(pos) {
              var pos = ((-Math.cos(pos*Math.PI)/4) + 0.75) + Math.random()/4;
              return pos > 1 ? 1 : pos;
            },
            wobble: function(pos) {
              return (-Math.cos(pos*Math.PI*(9*pos))/2) + 0.5;
            },
            pulse: function(pos, pulses) { 
              pulses = pulses || 5; 
              return (
                ((pos % (1/pulses)) * pulses).round() == 0 ? 
                      ((pos * pulses * 2) - (pos * pulses * 2).floor()) : 
                  1 - ((pos * pulses * 2) - (pos * pulses * 2).floor())
                );
            },
            spring: function(pos) { 
              return 1 - (Math.cos(pos * 4.5 * Math.PI) * Math.exp(-pos * 6)); 
            },
            none: function(pos) {
              return 0;
            },
            full: function(pos) {
              return 1;
            }
          },
          DefaultOptions: {
            duration:   1.0,   // seconds
            fps:        100,   // 100= assume 66fps max.
            sync:       false, // true for combining
            from:       0.0,
            to:         1.0,
            delay:      0.0,
            queue:      'parallel'
          },
          tagifyText: function(element) {
            var tagifyStyle = 'position:relative';
            if (Prototype.Browser.IE) tagifyStyle += ';zoom:1';
          
            element = $(element);
            $A(element.childNodes).each( function(child) {
              if (child.nodeType==3) {
                child.nodeValue.toArray().each( function(character) {
                  element.insertBefore(
                    new Element('span', {style: tagifyStyle}).update(
                      character == ' ' ? String.fromCharCode(160) : character), 
                      child);
                });
                Element.remove(child);
              }
            });
          },
          multiple: function(element, effect) {
            var elements;
            if (((typeof element == 'object') || 
                Object.isFunction(element)) && 
               (element.length))
              elements = element;
            else
              elements = $(element).childNodes;
            
            var options = Object.extend({
              speed: 0.1,
              delay: 0.0
            }, arguments[2] || { });
            var masterDelay = options.delay;
      
            $A(elements).each( function(element, index) {
              new effect(element, Object.extend(options, { delay: index * options.speed + masterDelay }));
            });
          },
          PAIRS: {
            'slide':  ['SlideDown','SlideUp'],
            'blind':  ['BlindDown','BlindUp'],
            'appear': ['Appear','Fade']
          },
          toggle: function(element, effect) {
            element = $(element);
            effect = (effect || 'appear').toLowerCase();
            var options = Object.extend({
              queue: { position:'end', scope:(element.id || 'global'), limit: 1 }
            }, arguments[2] || { });
            Effect[element.visible() ? 
              Effect.PAIRS[effect][1] : Effect.PAIRS[effect][0]](element, options);
          }
        };
      
        Effect.DefaultOptions.transition = Effect.Transitions.sinoidal;
      
        /* ------------- core effects ------------- */
      
        Effect.ScopedQueue = Class.create(Enumerable, {
          initialize: function() {
            this.effects  = [];
            this.interval = null;    
          },
          _each: function(iterator) {
            this.effects._each(iterator);
          },
          add: function(effect) {
            var timestamp = new Date().getTime();
          
            var position = Object.isString(effect.options.queue) ? 
              effect.options.queue : effect.options.queue.position;
          
            switch(position) {
              case 'front':
                // move unstarted effects after this effect  
                this.effects.findAll(function(e){ return e.state=='idle' }).each( function(e) {
                    e.startOn  += effect.finishOn;
                    e.finishOn += effect.finishOn;
                  });
                break;
              case 'with-last':
                timestamp = this.effects.pluck('startOn').max() || timestamp;
                break;
              case 'end':
                // start effect after last queued effect has finished
                timestamp = this.effects.pluck('finishOn').max() || timestamp;
                break;
            }
          
            effect.startOn  += timestamp;
            effect.finishOn += timestamp;
      
            if (!effect.options.queue.limit || (this.effects.length < effect.options.queue.limit))
              this.effects.push(effect);
          
            if (!this.interval)
              this.interval = setInterval(this.loop.bind(this), 15);
          },
          remove: function(effect) {
            this.effects = this.effects.reject(function(e) { return e==effect });
            if (this.effects.length == 0) {
              clearInterval(this.interval);
              this.interval = null;
            }
          },
          loop: function() {
            var timePos = new Date().getTime();
            for(var i=0, len=this.effects.length;i<len;i++) 
              this.effects[i] && this.effects[i].loop(timePos);
          }
        });
      
        Effect.Queues = {
          instances: $H(),
          get: function(queueName) {
            if (!Object.isString(queueName)) return queueName;
          
            return this.instances.get(queueName) ||
              this.instances.set(queueName, new Effect.ScopedQueue());
          }
        };
        Effect.Queue = Effect.Queues.get('global');
      
        Effect.Base = Class.create({
          position: null,
          start: function(options) {
            function codeForEvent(options,eventName){
              return (
                (options[eventName+'Internal'] ? 'this.options.'+eventName+'Internal(this);' : '') +
                (options[eventName] ? 'this.options.'+eventName+'(this);' : '')
              );
            }
            if (options && options.transition === false) options.transition = Effect.Transitions.linear;
            this.options      = Object.extend(Object.extend({ },Effect.DefaultOptions), options || { });
            this.currentFrame = 0;
            this.state        = 'idle';
            this.startOn      = this.options.delay*1000;
            this.finishOn     = this.startOn+(this.options.duration*1000);
            this.fromToDelta  = this.options.to-this.options.from;
            this.totalTime    = this.finishOn-this.startOn;
            this.totalFrames  = this.options.fps*this.options.duration;
          
            eval('this.render = function(pos){ '+
              'if (this.state=="idle"){this.state="running";'+
              codeForEvent(this.options,'beforeSetup')+
              (this.setup ? 'this.setup();':'')+ 
              codeForEvent(this.options,'afterSetup')+
              '};if (this.state=="running"){'+
              'pos=this.options.transition(pos)*'+this.fromToDelta+'+'+this.options.from+';'+
              'this.position=pos;'+
              codeForEvent(this.options,'beforeUpdate')+
              (this.update ? 'this.update(pos);':'')+
              codeForEvent(this.options,'afterUpdate')+
              '}}');
          
            this.event('beforeStart');
            if (!this.options.sync)
              Effect.Queues.get(Object.isString(this.options.queue) ? 
                'global' : this.options.queue.scope).add(this);
          },
          loop: function(timePos) {
            if (timePos >= this.startOn) {
              if (timePos >= this.finishOn) {
                this.render(1.0);
                this.cancel();
                this.event('beforeFinish');
                if (this.finish) this.finish(); 
                this.event('afterFinish');
                return;  
              }
              var pos   = (timePos - this.startOn) / this.totalTime,
                  frame = (pos * this.totalFrames).round();
              if (frame > this.currentFrame) {
                this.render(pos);
                this.currentFrame = frame;
              }
            }
          },
          cancel: function() {
            if (!this.options.sync)
              Effect.Queues.get(Object.isString(this.options.queue) ? 
                'global' : this.options.queue.scope).remove(this);
            this.state = 'finished';
          },
          event: function(eventName) {
            if (this.options[eventName + 'Internal']) this.options[eventName + 'Internal'](this);
            if (this.options[eventName]) this.options[eventName](this);
          },
          inspect: function() {
            var data = $H();
            for(property in this)
              if (!Object.isFunction(this[property])) data.set(property, this[property]);
            return '#<Effect:' + data.inspect() + ',options:' + $H(this.options).inspect() + '>';
          }
        });
      
        Effect.Parallel = Class.create(Effect.Base, {
          initialize: function(effects) {
            this.effects = effects || [];
            this.start(arguments[1]);
          },
          update: function(position) {
            this.effects.invoke('render', position);
          },
          finish: function(position) {
            this.effects.each( function(effect) {
              effect.render(1.0);
              effect.cancel();
              effect.event('beforeFinish');
              if (effect.finish) effect.finish(position);
              effect.event('afterFinish');
            });
          }
        });
      
        Effect.Tween = Class.create(Effect.Base, {
          initialize: function(object, from, to) {
            object = Object.isString(object) ? $(object) : object;
            var args = $A(arguments), method = args.last(), 
              options = args.length == 5 ? args[3] : null;
            this.method = Object.isFunction(method) ? method.bind(object) :
              Object.isFunction(object[method]) ? object[method].bind(object) : 
              function(value) { object[method] = value };
            this.start(Object.extend({ from: from, to: to }, options || { }));
          },
          update: function(position) {
            this.method(position);
          }
        });
      
        Effect.Event = Class.create(Effect.Base, {
          initialize: function() {
            this.start(Object.extend({ duration: 0 }, arguments[0] || { }));
          },
          update: Prototype.emptyFunction
        });
      
        Effect.Opacity = Class.create(Effect.Base, {
          initialize: function(element) {
            this.element = $(element);
            if (!this.element) throw(Effect._elementDoesNotExistError);
            // make this work on IE on elements without 'layout'
            if (Prototype.Browser.IE && (!this.element.currentStyle.hasLayout))
              this.element.setStyle({zoom: 1});
            var options = Object.extend({
              from: this.element.getOpacity() || 0.0,
              to:   1.0
            }, arguments[1] || { });
            this.start(options);
          },
          update: function(position) {
            this.element.setOpacity(position);
          }
        });
      
        Effect.Move = Class.create(Effect.Base, {
          initialize: function(element) {
            this.element = $(element);
            if (!this.element) throw(Effect._elementDoesNotExistError);
            var options = Object.extend({
              x:    0,
              y:    0,
              mode: 'relative'
            }, arguments[1] || { });
            this.start(options);
          },
          setup: function() {
            this.element.makePositioned();
            this.originalLeft = parseFloat(this.element.getStyle('left') || '0');
            this.originalTop  = parseFloat(this.element.getStyle('top')  || '0');
            if (this.options.mode == 'absolute') {
              this.options.x = this.options.x - this.originalLeft;
              this.options.y = this.options.y - this.originalTop;
            }
          },
          update: function(position) {
            this.element.setStyle({
              left: (this.options.x  * position + this.originalLeft).round() + 'px',
              top:  (this.options.y  * position + this.originalTop).round()  + 'px'
            });
          }
        });
      
        // for backwards compatibility
        Effect.MoveBy = function(element, toTop, toLeft) {
          return new Effect.Move(element, 
            Object.extend({ x: toLeft, y: toTop }, arguments[3] || { }));
        };
      
        Effect.Scale = Class.create(Effect.Base, {
          initialize: function(element, percent) {
            this.element = $(element);
            if (!this.element) throw(Effect._elementDoesNotExistError);
            var options = Object.extend({
              scaleX: true,
              scaleY: true,
              scaleContent: true,
              scaleFromCenter: false,
              scaleMode: 'box',        // 'box' or 'contents' or { } with provided values
              scaleFrom: 100.0,
              scaleTo:   percent
            }, arguments[2] || { });
            this.start(options);
          },
          setup: function() {
            this.restoreAfterFinish = this.options.restoreAfterFinish || false;
            this.elementPositioning = this.element.getStyle('position');
          
            this.originalStyle = { };
            ['top','left','width','height','fontSize'].each( function(k) {
              this.originalStyle[k] = this.element.style[k];
            }.bind(this));
            
            this.originalTop  = this.element.offsetTop;
            this.originalLeft = this.element.offsetLeft;
          
            var fontSize = this.element.getStyle('font-size') || '100%';
            ['em','px','%','pt'].each( function(fontSizeType) {
              if (fontSize.indexOf(fontSizeType)>0) {
                this.fontSize     = parseFloat(fontSize);
                this.fontSizeType = fontSizeType;
              }
            }.bind(this));
          
            this.factor = (this.options.scaleTo - this.options.scaleFrom)/100;
          
            this.dims = null;
            if (this.options.scaleMode=='box')
              this.dims = [this.element.offsetHeight, this.element.offsetWidth];
            if (/^content/.test(this.options.scaleMode))
              this.dims = [this.element.scrollHeight, this.element.scrollWidth];
            if (!this.dims)
              this.dims = [this.options.scaleMode.originalHeight,
                           this.options.scaleMode.originalWidth];
          },
          update: function(position) {
            var currentScale = (this.options.scaleFrom/100.0) + (this.factor * position);
            if (this.options.scaleContent && this.fontSize)
              this.element.setStyle({fontSize: this.fontSize * currentScale + this.fontSizeType });
            this.setDimensions(this.dims[0] * currentScale, this.dims[1] * currentScale);
          },
          finish: function(position) {
            if (this.restoreAfterFinish) this.element.setStyle(this.originalStyle);
          },
          setDimensions: function(height, width) {
            var d = { };
            if (this.options.scaleX) d.width = width.round() + 'px';
            if (this.options.scaleY) d.height = height.round() + 'px';
            if (this.options.scaleFromCenter) {
              var topd  = (height - this.dims[0])/2;
              var leftd = (width  - this.dims[1])/2;
              if (this.elementPositioning == 'absolute') {
                if (this.options.scaleY) d.top = this.originalTop-topd + 'px';
                if (this.options.scaleX) d.left = this.originalLeft-leftd + 'px';
              } else {
                if (this.options.scaleY) d.top = -topd + 'px';
                if (this.options.scaleX) d.left = -leftd + 'px';
              }
            }
            this.element.setStyle(d);
          }
        });
      
        Effect.Highlight = Class.create(Effect.Base, {
          initialize: function(element) {
            this.element = $(element);
            if (!this.element) throw(Effect._elementDoesNotExistError);
            var options = Object.extend({ startcolor: '#ffff99' }, arguments[1] || { });
            this.start(options);
          },
          setup: function() {
            // Prevent executing on elements not in the layout flow
            if (this.element.getStyle('display')=='none') { this.cancel(); return; }
            // Disable background image during the effect
            this.oldStyle = { };
            if (!this.options.keepBackgroundImage) {
              this.oldStyle.backgroundImage = this.element.getStyle('background-image');
              this.element.setStyle({backgroundImage: 'none'});
            }
            if (!this.options.endcolor)
              this.options.endcolor = this.element.getStyle('background-color').parseColor('#ffffff');
            if (!this.options.restorecolor)
              this.options.restorecolor = this.element.getStyle('background-color');
            // init color calculations
            this._base  = $R(0,2).map(function(i){ return parseInt(this.options.startcolor.slice(i*2+1,i*2+3),16) }.bind(this));
            this._delta = $R(0,2).map(function(i){ return parseInt(this.options.endcolor.slice(i*2+1,i*2+3),16)-this._base[i] }.bind(this));
          },
          update: function(position) {
            this.element.setStyle({backgroundColor: $R(0,2).inject('#',function(m,v,i){
              return m+((this._base[i]+(this._delta[i]*position)).round().toColorPart()); }.bind(this)) });
          },
          finish: function() {
            this.element.setStyle(Object.extend(this.oldStyle, {
              backgroundColor: this.options.restorecolor
            }));
          }
        });
      
        Effect.ScrollTo = function(element) {
          var options = arguments[1] || { },
            scrollOffsets = document.viewport.getScrollOffsets(),
            elementOffsets = $(element).cumulativeOffset(),
            max = (window.height || document.body.scrollHeight) - document.viewport.getHeight();  
      
          if (options.offset) elementOffsets[1] += options.offset;
      
          return new Effect.Tween(null,
            scrollOffsets.top,
            elementOffsets[1] > max ? max : elementOffsets[1],
            options,
            function(p){ scrollTo(scrollOffsets.left, p.round()) }
          );
        };
      
        /* ------------- combination effects ------------- */
      
        Effect.Fade = function(element) {
          element = $(element);
          var oldOpacity = element.getInlineOpacity();
          var options = Object.extend({
            from: element.getOpacity() || 1.0,
            to:   0.0,
            afterFinishInternal: function(effect) { 
              if (effect.options.to!=0) return;
              effect.element.hide().setStyle({opacity: oldOpacity}); 
            }
          }, arguments[1] || { });
          return new Effect.Opacity(element,options);
        };
      
        Effect.Appear = function(element) {
          element = $(element);
          var options = Object.extend({
          from: (element.getStyle('display') == 'none' ? 0.0 : element.getOpacity() || 0.0),
          to:   1.0,
          // force Safari to render floated elements properly
          afterFinishInternal: function(effect) {
            effect.element.forceRerendering();
          },
          beforeSetup: function(effect) {
            effect.element.setOpacity(effect.options.from).show(); 
          }}, arguments[1] || { });
          return new Effect.Opacity(element,options);
        };
      
        Effect.Puff = function(element) {
          element = $(element);
          var oldStyle = { 
            opacity: element.getInlineOpacity(), 
            position: element.getStyle('position'),
            top:  element.style.top,
            left: element.style.left,
            width: element.style.width,
            height: element.style.height
          };
          return new Effect.Parallel(
           [ new Effect.Scale(element, 200, 
              { sync: true, scaleFromCenter: true, scaleContent: true, restoreAfterFinish: true }), 
             new Effect.Opacity(element, { sync: true, to: 0.0 } ) ], 
             Object.extend({ duration: 1.0, 
              beforeSetupInternal: function(effect) {
                Position.absolutize(effect.effects[0].element)
              },
              afterFinishInternal: function(effect) {
                 effect.effects[0].element.hide().setStyle(oldStyle); }
             }, arguments[1] || { })
           );
        };
      
        Effect.BlindUp = function(element) {
          element = $(element);
          element.makeClipping();
          return new Effect.Scale(element, 0,
            Object.extend({ scaleContent: false, 
              scaleX: false, 
              restoreAfterFinish: true,
              afterFinishInternal: function(effect) {
                effect.element.hide().undoClipping();
              } 
            }, arguments[1] || { })
          );
        };
      
        Effect.BlindDown = function(element) {
          element = $(element);
          var elementDimensions = element.getDimensions();
          return new Effect.Scale(element, 100, Object.extend({ 
            scaleContent: false, 
            scaleX: false,
            scaleFrom: 0,
            scaleMode: {originalHeight: elementDimensions.height, originalWidth: elementDimensions.width},
            restoreAfterFinish: true,
            afterSetup: function(effect) {
              effect.element.makeClipping().setStyle({height: '0px'}).show(); 
            },  
            afterFinishInternal: function(effect) {
              effect.element.undoClipping();
            }
          }, arguments[1] || { }));
        };
      
        Effect.SwitchOff = function(element) {
          element = $(element);
          var oldOpacity = element.getInlineOpacity();
          return new Effect.Appear(element, Object.extend({
            duration: 0.4,
            from: 0,
            transition: Effect.Transitions.flicker,
            afterFinishInternal: function(effect) {
              new Effect.Scale(effect.element, 1, { 
                duration: 0.3, scaleFromCenter: true,
                scaleX: false, scaleContent: false, restoreAfterFinish: true,
                beforeSetup: function(effect) { 
                  effect.element.makePositioned().makeClipping();
                },
                afterFinishInternal: function(effect) {
                  effect.element.hide().undoClipping().undoPositioned().setStyle({opacity: oldOpacity});
                }
              })
            }
          }, arguments[1] || { }));
        };
      
        Effect.DropOut = function(element) {
          element = $(element);
          var oldStyle = {
            top: element.getStyle('top'),
            left: element.getStyle('left'),
            opacity: element.getInlineOpacity() };
          return new Effect.Parallel(
            [ new Effect.Move(element, {x: 0, y: 100, sync: true }), 
              new Effect.Opacity(element, { sync: true, to: 0.0 }) ],
            Object.extend(
              { duration: 0.5,
                beforeSetup: function(effect) {
                  effect.effects[0].element.makePositioned(); 
                },
                afterFinishInternal: function(effect) {
                  effect.effects[0].element.hide().undoPositioned().setStyle(oldStyle);
                } 
              }, arguments[1] || { }));
        };
      
        Effect.Shake = function(element) {
          element = $(element);
          var options = Object.extend({
            distance: 20,
            duration: 0.5
          }, arguments[1] || {});
          var distance = parseFloat(options.distance);
          var split = parseFloat(options.duration) / 10.0;
          var oldStyle = {
            top: element.getStyle('top'),
            left: element.getStyle('left') };
            return new Effect.Move(element,
              { x:  distance, y: 0, duration: split, afterFinishInternal: function(effect) {
            new Effect.Move(effect.element,
              { x: -distance*2, y: 0, duration: split*2,  afterFinishInternal: function(effect) {
            new Effect.Move(effect.element,
              { x:  distance*2, y: 0, duration: split*2,  afterFinishInternal: function(effect) {
            new Effect.Move(effect.element,
              { x: -distance*2, y: 0, duration: split*2,  afterFinishInternal: function(effect) {
            new Effect.Move(effect.element,
              { x:  distance*2, y: 0, duration: split*2,  afterFinishInternal: function(effect) {
            new Effect.Move(effect.element,
              { x: -distance, y: 0, duration: split, afterFinishInternal: function(effect) {
                effect.element.undoPositioned().setStyle(oldStyle);
          }}) }}) }}) }}) }}) }});
        };
      
        Effect.SlideDown = function(element) {
          element = $(element).cleanWhitespace();
          // SlideDown need to have the content of the element wrapped in a container element with fixed height!
          var oldInnerBottom = element.down().getStyle('bottom');
          var elementDimensions = element.getDimensions();
          return new Effect.Scale(element, 100, Object.extend({ 
            scaleContent: false, 
            scaleX: false, 
            scaleFrom: window.opera ? 0 : 1,
            scaleMode: {originalHeight: elementDimensions.height, originalWidth: elementDimensions.width},
            restoreAfterFinish: true,
            afterSetup: function(effect) {
              effect.element.makePositioned();
              effect.element.down().makePositioned();
              if (window.opera) effect.element.setStyle({top: ''});
              effect.element.makeClipping().setStyle({height: '0px'}).show(); 
            },
            afterUpdateInternal: function(effect) {
              effect.element.down().setStyle({bottom:
                (effect.dims[0] - effect.element.clientHeight) + 'px' }); 
            },
            afterFinishInternal: function(effect) {
              effect.element.undoClipping().undoPositioned();
              effect.element.down().undoPositioned().setStyle({bottom: oldInnerBottom}); }
            }, arguments[1] || { })
          );
        };
      
        Effect.SlideUp = function(element) {
          element = $(element).cleanWhitespace();
          var oldInnerBottom = element.down().getStyle('bottom');
          var elementDimensions = element.getDimensions();
          return new Effect.Scale(element, window.opera ? 0 : 1,
           Object.extend({ scaleContent: false, 
            scaleX: false, 
            scaleMode: 'box',
            scaleFrom: 100,
            scaleMode: {originalHeight: elementDimensions.height, originalWidth: elementDimensions.width},
            restoreAfterFinish: true,
            afterSetup: function(effect) {
              effect.element.makePositioned();
              effect.element.down().makePositioned();
              if (window.opera) effect.element.setStyle({top: ''});
              effect.element.makeClipping().show();
            },  
            afterUpdateInternal: function(effect) {
              effect.element.down().setStyle({bottom:
                (effect.dims[0] - effect.element.clientHeight) + 'px' });
            },
            afterFinishInternal: function(effect) {
              effect.element.hide().undoClipping().undoPositioned();
              effect.element.down().undoPositioned().setStyle({bottom: oldInnerBottom});
            }
           }, arguments[1] || { })
          );
        };
      
        // Bug in opera makes the TD containing this element expand for a instance after finish 
        Effect.Squish = function(element) {
          return new Effect.Scale(element, window.opera ? 1 : 0, { 
            restoreAfterFinish: true,
            beforeSetup: function(effect) {
              effect.element.makeClipping(); 
            },  
            afterFinishInternal: function(effect) {
              effect.element.hide().undoClipping(); 
            }
          });
        };
      
        Effect.Grow = function(element) {
          element = $(element);
          var options = Object.extend({
            direction: 'center',
            moveTransition: Effect.Transitions.sinoidal,
            scaleTransition: Effect.Transitions.sinoidal,
            opacityTransition: Effect.Transitions.full
          }, arguments[1] || { });
          var oldStyle = {
            top: element.style.top,
            left: element.style.left,
            height: element.style.height,
            width: element.style.width,
            opacity: element.getInlineOpacity() };
      
          var dims = element.getDimensions();    
          var initialMoveX, initialMoveY;
          var moveX, moveY;
        
          switch (options.direction) {
            case 'top-left':
              initialMoveX = initialMoveY = moveX = moveY = 0; 
              break;
            case 'top-right':
              initialMoveX = dims.width;
              initialMoveY = moveY = 0;
              moveX = -dims.width;
              break;
            case 'bottom-left':
              initialMoveX = moveX = 0;
              initialMoveY = dims.height;
              moveY = -dims.height;
              break;
            case 'bottom-right':
              initialMoveX = dims.width;
              initialMoveY = dims.height;
              moveX = -dims.width;
              moveY = -dims.height;
              break;
            case 'center':
              initialMoveX = dims.width / 2;
              initialMoveY = dims.height / 2;
              moveX = -dims.width / 2;
              moveY = -dims.height / 2;
              break;
          }
        
          return new Effect.Move(element, {
            x: initialMoveX,
            y: initialMoveY,
            duration: 0.01, 
            beforeSetup: function(effect) {
              effect.element.hide().makeClipping().makePositioned();
            },
            afterFinishInternal: function(effect) {
              new Effect.Parallel(
                [ new Effect.Opacity(effect.element, { sync: true, to: 1.0, from: 0.0, transition: options.opacityTransition }),
                  new Effect.Move(effect.element, { x: moveX, y: moveY, sync: true, transition: options.moveTransition }),
                  new Effect.Scale(effect.element, 100, {
                    scaleMode: { originalHeight: dims.height, originalWidth: dims.width }, 
                    sync: true, scaleFrom: window.opera ? 1 : 0, transition: options.scaleTransition, restoreAfterFinish: true})
                ], Object.extend({
                     beforeSetup: function(effect) {
                       effect.effects[0].element.setStyle({height: '0px'}).show(); 
                     },
                     afterFinishInternal: function(effect) {
                       effect.effects[0].element.undoClipping().undoPositioned().setStyle(oldStyle); 
                     }
                   }, options)
              )
            }
          });
        };
      
        Effect.Shrink = function(element) {
          element = $(element);
          var options = Object.extend({
            direction: 'center',
            moveTransition: Effect.Transitions.sinoidal,
            scaleTransition: Effect.Transitions.sinoidal,
            opacityTransition: Effect.Transitions.none
          }, arguments[1] || { });
          var oldStyle = {
            top: element.style.top,
            left: element.style.left,
            height: element.style.height,
            width: element.style.width,
            opacity: element.getInlineOpacity() };
      
          var dims = element.getDimensions();
          var moveX, moveY;
        
          switch (options.direction) {
            case 'top-left':
              moveX = moveY = 0;
              break;
            case 'top-right':
              moveX = dims.width;
              moveY = 0;
              break;
            case 'bottom-left':
              moveX = 0;
              moveY = dims.height;
              break;
            case 'bottom-right':
              moveX = dims.width;
              moveY = dims.height;
              break;
            case 'center':  
              moveX = dims.width / 2;
              moveY = dims.height / 2;
              break;
          }
        
          return new Effect.Parallel(
            [ new Effect.Opacity(element, { sync: true, to: 0.0, from: 1.0, transition: options.opacityTransition }),
              new Effect.Scale(element, window.opera ? 1 : 0, { sync: true, transition: options.scaleTransition, restoreAfterFinish: true}),
              new Effect.Move(element, { x: moveX, y: moveY, sync: true, transition: options.moveTransition })
            ], Object.extend({            
                 beforeStartInternal: function(effect) {
                   effect.effects[0].element.makePositioned().makeClipping(); 
                 },
                 afterFinishInternal: function(effect) {
                   effect.effects[0].element.hide().undoClipping().undoPositioned().setStyle(oldStyle); }
               }, options)
          );
        };
      
        Effect.Pulsate = function(element) {
          element = $(element);
          var options    = arguments[1] || { };
          var oldOpacity = element.getInlineOpacity();
          var transition = options.transition || Effect.Transitions.sinoidal;
          var reverser   = function(pos){ return transition(1-Effect.Transitions.pulse(pos, options.pulses)) };
          reverser.bind(transition);
          return new Effect.Opacity(element, 
            Object.extend(Object.extend({  duration: 2.0, from: 0,
              afterFinishInternal: function(effect) { effect.element.setStyle({opacity: oldOpacity}); }
            }, options), {transition: reverser}));
        };
      
        Effect.Fold = function(element) {
          element = $(element);
          var oldStyle = {
            top: element.style.top,
            left: element.style.left,
            width: element.style.width,
            height: element.style.height };
          element.makeClipping();
          return new Effect.Scale(element, 5, Object.extend({   
            scaleContent: false,
            scaleX: false,
            afterFinishInternal: function(effect) {
            new Effect.Scale(element, 1, { 
              scaleContent: false, 
              scaleY: false,
              afterFinishInternal: function(effect) {
                effect.element.hide().undoClipping().setStyle(oldStyle);
              } });
          }}, arguments[1] || { }));
        };
      
        Effect.Morph = Class.create(Effect.Base, {
          initialize: function(element) {
            this.element = $(element);
            if (!this.element) throw(Effect._elementDoesNotExistError);
            var options = Object.extend({
              style: { }
            }, arguments[1] || { });
          
            if (!Object.isString(options.style)) this.style = $H(options.style);
            else {
              if (options.style.include(':'))
                this.style = options.style.parseStyle();
              else {
                this.element.addClassName(options.style);
                this.style = $H(this.element.getStyles());
                this.element.removeClassName(options.style);
                var css = this.element.getStyles();
                this.style = this.style.reject(function(style) {
                  return style.value == css[style.key];
                });
                options.afterFinishInternal = function(effect) {
                  effect.element.addClassName(effect.options.style);
                  effect.transforms.each(function(transform) {
                    effect.element.style[transform.style] = '';
                  });
                }
              }
            }
            this.start(options);
          },
        
          setup: function(){
            function parseColor(color){
              if (!color || ['rgba(0, 0, 0, 0)','transparent'].include(color)) color = '#ffffff';
              color = color.parseColor();
              return $R(0,2).map(function(i){
                return parseInt( color.slice(i*2+1,i*2+3), 16 ) 
              });
            }
            this.transforms = this.style.map(function(pair){
              var property = pair[0], value = pair[1], unit = null;
      
              if (value.parseColor('#zzzzzz') != '#zzzzzz') {
                value = value.parseColor();
                unit  = 'color';
              } else if (property == 'opacity') {
                value = parseFloat(value);
                if (Prototype.Browser.IE && (!this.element.currentStyle.hasLayout))
                  this.element.setStyle({zoom: 1});
              } else if (Element.CSS_LENGTH.test(value)) {
                  var components = value.match(/^([\+\-]?[0-9\.]+)(.*)$/);
                  value = parseFloat(components[1]);
                  unit = (components.length == 3) ? components[2] : null;
              }
      
              var originalValue = this.element.getStyle(property);
              return { 
                style: property.camelize(), 
                originalValue: unit=='color' ? parseColor(originalValue) : parseFloat(originalValue || 0), 
                targetValue: unit=='color' ? parseColor(value) : value,
                unit: unit
              };
            }.bind(this)).reject(function(transform){
              return (
                (transform.originalValue == transform.targetValue) ||
                (
                  transform.unit != 'color' &&
                  (isNaN(transform.originalValue) || isNaN(transform.targetValue))
                )
              )
            });
          },
          update: function(position) {
            var style = { }, transform, i = this.transforms.length;
            while(i--)
              style[(transform = this.transforms[i]).style] = 
                transform.unit=='color' ? '#'+
                  (Math.round(transform.originalValue[0]+
                    (transform.targetValue[0]-transform.originalValue[0])*position)).toColorPart() +
                  (Math.round(transform.originalValue[1]+
                    (transform.targetValue[1]-transform.originalValue[1])*position)).toColorPart() +
                  (Math.round(transform.originalValue[2]+
                    (transform.targetValue[2]-transform.originalValue[2])*position)).toColorPart() :
                (transform.originalValue +
                  (transform.targetValue - transform.originalValue) * position).toFixed(3) + 
                    (transform.unit === null ? '' : transform.unit);
            this.element.setStyle(style, true);
          }
        });
      
        Effect.Transform = Class.create({
          initialize: function(tracks){
            this.tracks  = [];
            this.options = arguments[1] || { };
            this.addTracks(tracks);
          },
          addTracks: function(tracks){
            tracks.each(function(track){
              track = $H(track);
              var data = track.values().first();
              this.tracks.push($H({
                ids:     track.keys().first(),
                effect:  Effect.Morph,
                options: { style: data }
              }));
            }.bind(this));
            return this;
          },
          play: function(){
            return new Effect.Parallel(
              this.tracks.map(function(track){
                var ids = track.get('ids'), effect = track.get('effect'), options = track.get('options');
                var elements = [$(ids) || $$(ids)].flatten();
                return elements.map(function(e){ return new effect(e, Object.extend({ sync:true }, options)) });
              }).flatten(),
              this.options
            );
          }
        });
      
        Element.CSS_PROPERTIES = $w(
          'backgroundColor backgroundPosition borderBottomColor borderBottomStyle ' + 
          'borderBottomWidth borderLeftColor borderLeftStyle borderLeftWidth ' +
          'borderRightColor borderRightStyle borderRightWidth borderSpacing ' +
          'borderTopColor borderTopStyle borderTopWidth bottom clip color ' +
          'fontSize fontWeight height left letterSpacing lineHeight ' +
          'marginBottom marginLeft marginRight marginTop markerOffset maxHeight '+
          'maxWidth minHeight minWidth opacity outlineColor outlineOffset ' +
          'outlineWidth paddingBottom paddingLeft paddingRight paddingTop ' +
          'right textIndent top width wordSpacing zIndex');
        
        Element.CSS_LENGTH = /^(([\+\-]?[0-9\.]+)(em|ex|px|in|cm|mm|pt|pc|\%))|0$/;
      
        String.__parseStyleElement = document.createElement('div');
        String.prototype.parseStyle = function(){
          var style, styleRules = $H();
          if (Prototype.Browser.WebKit)
            style = new Element('div',{style:this}).style;
          else {
            String.__parseStyleElement.innerHTML = '<div style="' + this + '"></div>';
            style = String.__parseStyleElement.childNodes[0].style;
          }
        
          Element.CSS_PROPERTIES.each(function(property){
            if (style[property]) styleRules.set(property, style[property]); 
          });
        
          if (Prototype.Browser.IE && this.include('opacity'))
            styleRules.set('opacity', this.match(/opacity:\s*((?:0|1)?(?:\.\d*)?)/)[1]);
      
          return styleRules;
        };
      
        if (document.defaultView && document.defaultView.getComputedStyle) {
          Element.getStyles = function(element) {
            var css = document.defaultView.getComputedStyle($(element), null);
            return Element.CSS_PROPERTIES.inject({ }, function(styles, property) {
              styles[property] = css[property];
              return styles;
            });
          };
        } else {
          Element.getStyles = function(element) {
            element = $(element);
            var css = element.currentStyle, styles;
            styles = Element.CSS_PROPERTIES.inject({ }, function(results, property) {
              results[property] = css[property];
              return results;
            });
            if (!styles.opacity) styles.opacity = element.getOpacity();
            return styles;
          };
        };
      
        Effect.Methods = {
          morph: function(element, style) {
            element = $(element);
            new Effect.Morph(element, Object.extend({ style: style }, arguments[2] || { }));
            return element;
          },
          visualEffect: function(element, effect, options) {
            element = $(element)
            var s = effect.dasherize().camelize(), klass = s.charAt(0).toUpperCase() + s.substring(1);
            new Effect[klass](element, options);
            return element;
          },
          highlight: function(element, options) {
            element = $(element);
            new Effect.Highlight(element, options);
            return element;
          }
        };
      
        $w('fade appear grow shrink fold blindUp blindDown slideUp slideDown '+
          'pulsate shake puff squish switchOff dropOut').each(
          function(effect) { 
            Effect.Methods[effect] = function(element, options){
              element = $(element);
              Effect[effect.charAt(0).toUpperCase() + effect.substring(1)](element, options);
              return element;
            }
          }
        );
      
        $w('getInlineOpacity forceRerendering setContentZoom collectTextNodes collectTextNodesIgnoreClass getStyles').each( 
          function(f) { Effect.Methods[f] = Element[f]; }
        );
      
        Element.addMethods(Effect.Methods);
    23: 
      name: body
      filter_id: ""
      page_id: 13
      id: 23
      content: |
        <div id="extra">
          <div class="box">
            <div id="gallery">
              <a href="/images/roasters/gallery1.jpg" rel="lightbox[growers]" title="This is a caption." /><img src="/images/roasters/thumb-grower.jpg" /></a>
              <a href="/images/roasters/gallery2.jpg" rel="lightbox[growers]" title="This is a caption."></a>
              <a href="/images/roasters/gallery3.jpg" rel="lightbox[growers]" title="This is a caption."></a>
              <a href="/images/roasters/gallery4.jpg" rel="lightbox[growers]" title="This is a caption."></a>
            </div>
            <h2>Our growers</h2>
            <p><span>Fromus neatus farmus alwaze.</span><br /> In portor auctor neque. Morbi gravida elit non ante. Praesent eros elit, consequat et, rhoncuses atet, rhoncus posuere, massa. Praesent tempor, felis varius gravida!</p>
          </div>
        </div>
      
        <div id="extra">
          <div class="box">
            <div id="gallery">
              <a href="/images/roasters/gallery1.jpg" rel="lightbox[roasters]" title="This is a caption." /><img src="/images/roasters/thumb-roaster.jpg" /></a>
              <a href="/images/roasters/gallery2.jpg" rel="lightbox[roasters]" title="This is a caption."></a>
              <a href="/images/roasters/gallery3.jpg" rel="lightbox[roasters]" title="This is a caption."></a>
              <a href="/images/roasters/gallery4.jpg" rel="lightbox[roasters]" title="This is a caption."></a>
            </div>
            <h2>Our roasters</h2>
            <p><span>Bestes machinum inde wurlde.</span><br /> In portor auctor neque. Morbi gravida elit non ante. Praesent eros elit, consequat et, rhoncuses atet, rhoncus posuere, massa. Praesent tempor, felis varius gravida!</p>
          </div>
        </div>
      
        <div id="extra">
          <div class="box">
            <div id="gallery">
              <a href="/images/roasters/gallery1.jpg" rel="lightbox[grinders]" title="This is a caption." /><img src="/images/roasters/thumb-grinder.jpg" /></a>
              <a href="/images/roasters/gallery2.jpg" rel="lightbox[grinders]" title="This is a caption."></a>
              <a href="/images/roasters/gallery3.jpg" rel="lightbox[grinders]" title="This is a caption."></a>
              <a href="/images/roasters/gallery4.jpg" rel="lightbox[grinders]" title="This is a caption."></a>
            </div>
            <h2>Our grinders</h2>
            <p><span>Whata treet itis tu heerit.</span><br /> In portor auctor neque. Morbi gravida elit non ante. Praesent eros elit, consequat et, rhoncuses atet, rhoncus posuere, massa. Praesent tempor, felis varius gravida!</p>
          </div>
        </div>

    1: 
      name: body
      filter_id: ""
      page_id: 1
      id: 1
      content: |
        <div id="extra">
          <div class="box">
            <div id="player">
            <script type="text/javascript">
            var so = new SWFObject('/video/player.swf','mpl','200','145','8');
            so.addParam('allowscriptaccess','always');
            so.addParam('allowfullscreen','true');
            so.addParam('flashvars','&file=http://content.bitsontherun.com/videos/3ta6fhJQ.flv&image=/images/roasters/preview.jpg&controlbar=none');
            so.write('player');
            </script>
            </div>
        <h2>Yummy!</h2>
            <p><span>Vivamust consumey morfoamy.</span><br /> In portor auctor neque. Morbi gravida elit non ante. Praesent eros elit, consequat et, rhoncuses atet, rhoncus posuere, massa. Praesent tempor, felis varius gravida!</p>
          </div>
        </div>
      
        <r:snippet name="articles" />

    18: 
      name: extended
      filter_id: ""
      page_id: 11
      id: 18
      content: ""
    29: 
      name: body
      filter_id: ""
      page_id: 17
      id: 29
      content: |
        /*---------------------------------  Styles.css  ---*/ 
      
        body {
          background-color: #BFC1C4;
          font-family: Verdana, Arial, Helvetica, sans-serif;
          font-size: 80%;
          padding: 0;
          margin: 0;
          text-align: center; }
      
        #page {
          margin: 15px auto;
          width: 900px;
          text-align: left;
          border: 2px solid #9EA3AC;
          padding: 5px;
          background-color: #FFFFFF;
          clear: both; }
      
        #header {
          color: #FFFFFF;
          font-family: Arial,Helvetica,Geneva,sans-serif;
          font-size: 35px;
          font-weight: bold;
          letter-spacing: 0.02em;
          line-height: 0.72em;
          text-transform: uppercase; }
      
        #main {
          background-color: white;
          float: left;
          width: 100%;
          margin: 15px 0px 30px; }
      
        h1 {
          color: #FFFFFF;
          font-family: Arial, Helvetica, sans-serif;
          font-size: 35px;
          font-weight: bold;
          letter-spacing: 0.02em;
          line-height: 0.72em;
          text-transform: uppercase; }
      
        h2 {
          color: #451811;
          font-family: Georgia, sans-serif;
          font-size: 270%;
          font-weight: normal;
          margin: 0px; }
      
        h3 {
          font-family: Helvetica, Arial, Verdana, sans-serif;
          font-size: 195%;
          margin: 0px;
          font-weight: bold; }
      
        h3 a {
          color: #451811;
          text-decoration: none;
          border-bottom: none;
          margin: 0px; }
      
        h3 a:hover {
          color: #902f1c;
          border-bottom: none; }
      
        a {
          color: #711e11;
          text-decoration: none;
          border-bottom: 1px solid #DBD6D1; }  
      
        a:hover {
          color: #451811;
          text-decoration: none;
          border-bottom: 2px solid #DBD6D1; }
      
        p {
          color: #232323;
          font-family: Georgia, Times, "Times New Roman";
          font-size: 1.3em;
          line-height: 1.3em;
          margin: 0px 0px 10px; }
      
        ul {
          padding: 0; }
      
        li {
          padding: 0; }
      
      
        /*---MAIN COLUMN---*/  
      
        #content-wrapper {
          float: left;
          width: 600px; }
      
        #content {
          padding: 0px 15px; }
      
      
        /*---SIDEBAR---*/  
      
        #sidebar-wrapper {
          float: right;
          width: 300px; }
      
        #sidebar {
          font-size: 90%;
          padding: 15px;
          padding-top: 0px; }
      
        #sidebar h3 {
          color: #222222;
          font-family: Helvetica, Arial, Verdana, sans-serif;
          font-size: 17px;
          font-weight: bold;
          margin: 0px; }
      
        #sidebar p {
          line-height: 1.4em; }
      
      
        /*---ARTICLE---*/ 
      
        .entry {
          margin-bottom: 20px; }
      
        .entry .info {
          margin-top: 1em;
          font-size: 1em; }
      
        .entry p {
          font-size: 1.1em; }
      
        .posted {
          color: #918C7E;
          font-family: "lucida grande",arial,helvetica,verdana,sans-serif;
          font-size: 10px;
          margin: -3px 0 5px;
          padding: 0px; }
      
        .posted em {
          color: #451811;
          font-style: italic;
          margin: 0px 6px;
          font-weight: bold; }
      
        .posted img {
          background: transparent none repeat scroll 0 0;
          border: medium none;
          margin: 0 4px -5px 2px;
          text-decoration: none; }
      
      
        /*---STYLES---*/ 
      
        #extra {
          margin-bottom: 10px; }
      
        #extra .box {
          background-color: #e8f0f6;
          border-color: #D5E9F6; }
      
        #extra p {
          line-height: 1.2em;
          margin: 0px 0px 5px 0px; }
      
        #extra em {
          font-style: italic; }
      
        #extra span {
          color: #d26511;
          font-size: 120%; }
      
        #player, #gallery {
          background: #FFFFFF;
          float: left;
          clear: both;
          margin: 0px 15px 15px 0px;
          padding: 3px;
          border: 1px solid #a9cde5; }
      
        #gallery a, 
        #gallery a:hover, 
        #player a, 
        #player a:hover,
        #extra img a,
        #extra img a:hover {
          border-bottom: none !important;
          text-decoration: none !important; }
      
        #extra a img {
          margin-bottom: -3px; }
      
        .spot {
          margin-bottom: 20px;
          clear: both; }
      
        .spot p {
          font-family: Verdana, sans-serif;
          font-size: 11px; 
          color: #333333;
          margin-top: 0px; }
      
        .spot img {
          float: left;
          padding: 0px 12px 10px 0px; }
      
        .box {
          padding: 15px;
          border: 1px solid #dbd6d1;
          background-color: #efedeb;
          margin-bottom: 20px; }
      
        .box h3 {
          font-size: 18px;
          margin-bottom: 2px; }
      
        .box input {
          margin-top: 5px; }
      
        .box input.email {
          font-size: 10px;
          padding: 3px; 
          color: #a29e96; 
          width: 140px; }
      
        .box input.subscribe {
          width: 70px;
          margin-left: 5px;
          color: #232323; }
      
        .box ul {
          margin-left: 20px; }
      
        .hidden {
          display: none; }
      
        .clear {
          clear: both; }
      
        /*---SITEMAP---*/ 
      
        #sitemap ul {
          list-style-type: disc;
          margin: 5px 0px 10px 35px;
          line-height: 2em; }
      
        #sitemap li a {
          font-family: Helvetica, Arial, Verdana, sans-serif;
          font-size: 180%;
          font-weight: bold;
          margin: 0px; 
          color: #451811;
          text-decoration: none;
          border-bottom: none; }
      
        #sitemap li a:hover {
          color: #902f1c;
          border-bottom: none; }
      
        #sitemap ul.second {
          font-size: 80%; }
      
        /*---FOOTER---*/ 
      
        #footer-wrapper {
          margin: 5px auto;
          width: 900px; }
      
        #footer {
          color: #595452;
          float: right;
          font-family: "Lucida Grande", Verdana, Helvetica, Arial, sans-serif;
          font-size: 90%;
          margin-bottom: 30px; }
      
      
        /*---------------------------------  Navigation.css  ---*/ 
      
        #nav {
          height: 38px;
          background: transparent url(/images/roasters/nav-background.gif) repeat-x top left; }
      
        #nav ul {
          display: block;
          margin: 0;
          padding: 0;
          list-style-type: none;
          width: auto; }
      
        #nav ul li {
          display: block;
          float: left;
          margin: 0;
          padding: 0; }
      
        #nav ul li a {
          font-family: "Lucida Sans", "Lucida Grande", Helvetica, Arial, sans-serif;
          font-size: 13px;
          display: block;
          float: left;
          color: #3D3D3D;
          text-decoration: none;
          padding: 8px 16px 7px;
          border-bottom: none;
          background: transparent url(/images/roasters/nav-divider.gif) no-repeat top right; }
      
        #nav ul li a:hover {
          color: #FFFFFF;
          background: #49140c;
          border-bottom: 1px solid #49140c; }
      
        #nav ul li.selected a {
          color: #FFFFFF;
          background: #0b0b0a;
          border-bottom: 1px solid #0b0b0a; }
      
      
        /*---------------------------------  Lightbox.css  ---*/ 
      
        #lightbox{  position: absolute;  left: 0; width: 100%; z-index: 100; text-align: center; line-height: 0;}
        #lightbox img{ width: auto; height: auto;}
        #lightbox a img{ border: none; }
      
        #outerImageContainer{ position: relative; background-color: #fff; width: 250px; height: 250px; margin: 0 auto; }
        #imageContainer{ padding: 10px; }
      
        #loading{ position: absolute; top: 40%; left: 0%; height: 25%; width: 100%; text-align: center; line-height: 0; }
        #hoverNav{ position: absolute; top: 0; left: 0; height: 100%; width: 100%; z-index: 10; border-bottom: none; }
        #imageContainer>#hoverNav{ left: 0;}
        #hoverNav a{ outline: none; border-bottom: none;}
      
        #prevLink, #nextLink{ width: 49%; height: 100%; background-image: url(data:image/gif;base64,AAAA); /* Trick IE into showing hover */ display: block; }
        #prevLink { left: 0; float: left;}
        #nextLink { right: 0; float: right;} 
        #prevLink:hover, #prevLink:visited:hover { background: url(/images/roasters/prevlabel.gif) left 15% no-repeat; }
        #nextLink:hover, #nextLink:visited:hover { background: url(/images/roasters/nextlabel.gif) right 15% no-repeat; }
      
        #imageDataContainer{ font: 10px Verdana, Helvetica, sans-serif; background-color: #fff; margin: 0 auto; line-height: 1.4em; overflow: auto; width: 100%  ; }
      
        #imageData{  padding:0 10px; color: #666; }
        #imageData #imageDetails{ width: 70%; float: left; text-align: left; }  
        #imageData #caption{ font-weight: bold;  }
        #imageData #numberDisplay{ display: block; clear: left; padding-bottom: 1.0em;  }      
        #imageData #bottomNavClose{ width: 66px; float: right;  padding-bottom: 0.7em; outline: none;}     
      
        #overlay{ position: absolute; top: 0; left: 0; z-index: 90; width: 100%; height: 500px; background-color: #000; }

    24: 
      name: sidebar
      filter_id: ""
      page_id: 13
      id: 24
      content: |
        <div class="spot">
        <img src="/images/roasters/open.gif" />
        <h3>Almost always open</h3>
        <p>Nemo enim ipsam voluptatem quia voluptas sit aspernatur aut odit aut fugit, sed quia <a href="/about">consequuntur</a> magni dolor eos qui ration volupt sequi nesciunt. Proin varius urna. In varius bibendum nisl. Donec nec nisi ut nisi varius porttitor.</p>
        </div>
      
        <div class="spot">
        <img src="/images/roasters/gift.gif" />
        <h3>Roaster gift cards</h3>
        <p>Mauris elit lacus, iaculis a, cons nec, vehicula <a href="/about">condimentum</a> at. Suspendisse sapien enim, tempus ut, facilisis at, vestibulum nec, nunc. Aliquam erat volutpat. Ut sit amet quam. Cum soci natoque penati et magnis dis partur montes, nascet ridiculus mus. Aen vel urna. In justo nisl, cursus in, molestie a, vulputate nec. </p> 
        </div>
      
        <div class="spot">
        <img src="/images/roasters/truck.gif" />
        <h3>Metro delivery</h3>
        <p>Iaculis a, cons nec, condi<a href="/about"> vehicula</a>. Suspendisse sapien enim, tempus ut, facilisis at, vestibulum nec, nunc. Aliquam erat volutpat. Ut sit amet quam. Cum soci natoque penati et magnis dis partur montes, nascet ridiculus mus. Aen vel urna. In justo nisl, cursus in, molestie. </p> 
        </div>

    35: 
      name: body
      filter_id: ""
      page_id: 23
      id: 35
      content: |-
        // script.aculo.us builder.js v1.8.1, Thu Jan 03 22:07:12 -0500 2008
      
        // Copyright (c) 2005-2007 Thomas Fuchs (http://script.aculo.us, http://mir.aculo.us)
        //
        // script.aculo.us is freely distributable under the terms of an MIT-style license.
        // For details, see the script.aculo.us web site: http://script.aculo.us/
      
        var Builder = {
          NODEMAP: {
            AREA: 'map',
            CAPTION: 'table',
            COL: 'table',
            COLGROUP: 'table',
            LEGEND: 'fieldset',
            OPTGROUP: 'select',
            OPTION: 'select',
            PARAM: 'object',
            TBODY: 'table',
            TD: 'table',
            TFOOT: 'table',
            TH: 'table',
            THEAD: 'table',
            TR: 'table'
          },
          // note: For Firefox < 1.5, OPTION and OPTGROUP tags are currently broken,
          //       due to a Firefox bug
          node: function(elementName) {
            elementName = elementName.toUpperCase();
          
            // try innerHTML approach
            var parentTag = this.NODEMAP[elementName] || 'div';
            var parentElement = document.createElement(parentTag);
            try { // prevent IE "feature": http://dev.rubyonrails.org/ticket/2707
              parentElement.innerHTML = "<" + elementName + "></" + elementName + ">";
            } catch(e) {}
            var element = parentElement.firstChild || null;
            
            // see if browser added wrapping tags
            if(element && (element.tagName.toUpperCase() != elementName))
              element = element.getElementsByTagName(elementName)[0];
          
            // fallback to createElement approach
            if(!element) element = document.createElement(elementName);
          
            // abort if nothing could be created
            if(!element) return;
      
            // attributes (or text)
            if(arguments[1])
              if(this._isStringOrNumber(arguments[1]) ||
                (arguments[1] instanceof Array) ||
                arguments[1].tagName) {
                  this._children(element, arguments[1]);
                } else {
                  var attrs = this._attributes(arguments[1]);
                  if(attrs.length) {
                    try { // prevent IE "feature": http://dev.rubyonrails.org/ticket/2707
                      parentElement.innerHTML = "<" +elementName + " " +
                        attrs + "></" + elementName + ">";
                    } catch(e) {}
                    element = parentElement.firstChild || null;
                    // workaround firefox 1.0.X bug
                    if(!element) {
                      element = document.createElement(elementName);
                      for(attr in arguments[1]) 
                        element[attr == 'class' ? 'className' : attr] = arguments[1][attr];
                    }
                    if(element.tagName.toUpperCase() != elementName)
                      element = parentElement.getElementsByTagName(elementName)[0];
                  }
                } 
      
            // text, or array of children
            if(arguments[2])
              this._children(element, arguments[2]);
      
             return element;
          },
          _text: function(text) {
             return document.createTextNode(text);
          },
      
          ATTR_MAP: {
            'className': 'class',
            'htmlFor': 'for'
          },
      
          _attributes: function(attributes) {
            var attrs = [];
            for(attribute in attributes)
              attrs.push((attribute in this.ATTR_MAP ? this.ATTR_MAP[attribute] : attribute) +
                  '="' + attributes[attribute].toString().escapeHTML().gsub(/"/,'&quot;') + '"');
            return attrs.join(" ");
          },
          _children: function(element, children) {
            if(children.tagName) {
              element.appendChild(children);
              return;
            }
            if(typeof children=='object') { // array can hold nodes and text
              children.flatten().each( function(e) {
                if(typeof e=='object')
                  element.appendChild(e)
                else
                  if(Builder._isStringOrNumber(e))
                    element.appendChild(Builder._text(e));
              });
            } else
              if(Builder._isStringOrNumber(children))
                element.appendChild(Builder._text(children));
          },
          _isStringOrNumber: function(param) {
            return(typeof param=='string' || typeof param=='number');
          },
          build: function(html) {
            var element = this.node('div');
            $(element).update(html.strip());
            return element.down();
          },
          dump: function(scope) { 
            if(typeof scope != 'object' && typeof scope != 'function') scope = window; //global scope 
        
            var tags = ("A ABBR ACRONYM ADDRESS APPLET AREA B BASE BASEFONT BDO BIG BLOCKQUOTE BODY " +
              "BR BUTTON CAPTION CENTER CITE CODE COL COLGROUP DD DEL DFN DIR DIV DL DT EM FIELDSET " +
              "FONT FORM FRAME FRAMESET H1 H2 H3 H4 H5 H6 HEAD HR HTML I IFRAME IMG INPUT INS ISINDEX "+
              "KBD LABEL LEGEND LI LINK MAP MENU META NOFRAMES NOSCRIPT OBJECT OL OPTGROUP OPTION P "+
              "PARAM PRE Q S SAMP SCRIPT SELECT SMALL SPAN STRIKE STRONG STYLE SUB SUP TABLE TBODY TD "+
              "TEXTAREA TFOOT TH THEAD TITLE TR TT U UL VAR").split(/\s+/);
        
            tags.each( function(tag){ 
              scope[tag] = function() { 
                return Builder.node.apply(Builder, [tag].concat($A(arguments)));  
              } 
            });
          }
        }
    13: 
      name: body
      filter_id: ""
      page_id: 10
      id: 13
      content: |-
        <r:archive:children:each order="desc">
        <div class="entry">
        <h3><r:link /></h3>
            <div class="posted">
              Posted by <r:author /> on <r:date format="%B %d, %Y" /><em>|</em><img src="/images/roasters/comment.png" /><a href="<r:url />#disqus_thread">Comments</a><em>|</em><r:link>Read full article</r:link>    
            </div>
          <r:content part="summary" />
        </div>
        </r:archive:children:each>
      
        <r:snippet name="comments_summary" />
    2: 
      name: body
      filter_id: Textile
      page_id: 2
      id: 2
      content: |
        The file you were looking for could not be found.
      
        Attempted URL: @<r:attempted_url />@
      
        It is possible that you typed the URL incorrectly or that you clicked on a bad link.
      
        "<< Back to Home Page":/

    8: 
      name: sidebar
      filter_id: ""
      page_id: 1
      id: 8
      content: |
        <div class="spot">
        <img src="/images/roasters/prize.gif" />
        <h3>Best of Show</h3>
        <p>Nemo enim ipsam voluptatem quia voluptas sit aspernatur aut odit aut fugit, sed quia <a href="/about">consequuntur</a> magni dolor eos qui ration volupt sequi nesciunt. Proin varius urna. In varius bibendum nisl. Donec nec nisi ut nisi varius porttitor.</p>
        </div>
      
        <div class="spot">
        <img src="/images/roasters/green.gif" />
        <h3>Happy Planet</h3>
        <p>Mauris elit lacus, iaculis a, cons nec, vehicula <a href="/about">condimentum</a> at. Suspendisse sapien enim, tempus ut, facilisis at, vestibulum nec, nunc. Aliquam erat volutpat. Ut sit amet quam. Cum soci natoque penati et magnis dis partur montes, nascet ridiculus mus. Aen vel urna. In justo nisl, cursus in, molestie a, vulputate nec. </p> 
        </div>
      
        <div class="spot">
        <img src="/images/roasters/recycle.gif" />
        <h3>Round and round</h3>
        <p>Donec tempor mollis ante. Nunc felis. Proin ac pede vel nulla lacinia congue. Cum sociis natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Morbi cursus, dui quis pretium blandit, erat massa lacinia neque, eu porttitor lacus erat ac leo.</p>
        </div>
      
        <r:snippet name="newsletter" />
      
        <div class="spot"><r:snippet name="rss" /></div>

    30: 
      name: body
      filter_id: ""
      page_id: 18
      id: 30
      content: 
    14: 
      name: summary
      filter_id: Textile
      page_id: 5
      id: 14
      content: At vero eos et accusamus et iusto odio dignissimos ducimus qui blanditiis praesentium voluptatum deleniti atque corrupti quos dolores et quas molestias excepturi sint occaecati cupiditate non provident, similique sunt in culpa qui officia deserunt mollitia animi, id est laborum et dolorum fuga. Et harum quidem rerum facilis est et expedita distinctio. Nam libero tempore, cum soluta nobis est eligendi optio cumque nihil impedit quo minus id quod maxime placeat facere possimus, omnis voluptas assumenda est, omnis dolor repellendus.
    3: 
      name: body
      filter_id: ""
      page_id: 3
      id: 3
      content: |
        <?xml version="1.0" encoding="UTF-8"?>
        <rss version="2.0" xmlns:dc="http://purl.org/dc/elements/1.1/">
          <channel>
            <title>Article RSS Feed</title>
            <link>http://your-web-site.com<r:url /></link>
            <language>en-us</language>
            <ttl>40</ttl>
            <description>The main blog feed for my Web site.</description>
            <r:find url="/news/">
            <r:children:each limit="10" order="desc">
                <item>
                  <title><r:title /></title>
                  <description><r:escape_html><r:content /></r:escape_html></description>
                  <pubDate><r:rfc1123_date /></pubDate>
                  <guid>http://your-web-site.com<r:url /></guid>
                  <link>http://your-web-site.com<r:url /></link>
                </item>
            </r:children:each>
            </r:find>
          </channel>
        </rss>

    20: 
      name: no-map
      filter_id: ""
      page_id: 11
      id: 20
      content: ""
    31: 
      name: body
      filter_id: ""
      page_id: 19
      id: 31
      content: |-
        /**
         * SWFObject v1.5: Flash Player detection and embed - http://blog.deconcept.com/swfobject/
         *
         * SWFObject is (c) 2007 Geoff Stearns and is released under the MIT License:
         * http://www.opensource.org/licenses/mit-license.php
         *
         */
        if(typeof deconcept=="undefined"){var deconcept=new Object();}if(typeof deconcept.util=="undefined"){deconcept.util=new Object();}if(typeof deconcept.SWFObjectUtil=="undefined"){deconcept.SWFObjectUtil=new Object();}deconcept.SWFObject=function(_1,id,w,h,_5,c,_7,_8,_9,_a){if(!document.getElementById){return;}this.DETECT_KEY=_a?_a:"detectflash";this.skipDetect=deconcept.util.getRequestParameter(this.DETECT_KEY);this.params=new Object();this.variables=new Object();this.attributes=new Array();if(_1){this.setAttribute("swf",_1);}if(id){this.setAttribute("id",id);}if(w){this.setAttribute("width",w);}if(h){this.setAttribute("height",h);}if(_5){this.setAttribute("version",new deconcept.PlayerVersion(_5.toString().split(".")));}this.installedVer=deconcept.SWFObjectUtil.getPlayerVersion();if(!window.opera&&document.all&&this.installedVer.major>7){deconcept.SWFObject.doPrepUnload=true;}if(c){this.addParam("bgcolor",c);}var q=_7?_7:"high";this.addParam("quality",q);this.setAttribute("useExpressInstall",false);this.setAttribute("doExpressInstall",false);var _c=(_8)?_8:window.location;this.setAttribute("xiRedirectUrl",_c);this.setAttribute("redirectUrl","");if(_9){this.setAttribute("redirectUrl",_9);}};deconcept.SWFObject.prototype={useExpressInstall:function(_d){this.xiSWFPath=!_d?"expressinstall.swf":_d;this.setAttribute("useExpressInstall",true);},setAttribute:function(_e,_f){this.attributes[_e]=_f;},getAttribute:function(_10){return this.attributes[_10];},addParam:function(_11,_12){this.params[_11]=_12;},getParams:function(){return this.params;},addVariable:function(_13,_14){this.variables[_13]=_14;},getVariable:function(_15){return this.variables[_15];},getVariables:function(){return this.variables;},getVariablePairs:function(){var _16=new Array();var key;var _18=this.getVariables();for(key in _18){_16[_16.length]=key+"="+_18[key];}return _16;},getSWFHTML:function(){var _19="";if(navigator.plugins&&navigator.mimeTypes&&navigator.mimeTypes.length){if(this.getAttribute("doExpressInstall")){this.addVariable("MMplayerType","PlugIn");this.setAttribute("swf",this.xiSWFPath);}_19="<embed type=\"application/x-shockwave-flash\" src=\""+this.getAttribute("swf")+"\" width=\""+this.getAttribute("width")+"\" height=\""+this.getAttribute("height")+"\" style=\""+this.getAttribute("style")+"\"";_19+=" id=\""+this.getAttribute("id")+"\" name=\""+this.getAttribute("id")+"\" ";var _1a=this.getParams();for(var key in _1a){_19+=[key]+"=\""+_1a[key]+"\" ";}var _1c=this.getVariablePairs().join("&");if(_1c.length>0){_19+="flashvars=\""+_1c+"\"";}_19+="/>";}else{if(this.getAttribute("doExpressInstall")){this.addVariable("MMplayerType","ActiveX");this.setAttribute("swf",this.xiSWFPath);}_19="<object id=\""+this.getAttribute("id")+"\" classid=\"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000\" width=\""+this.getAttribute("width")+"\" height=\""+this.getAttribute("height")+"\" style=\""+this.getAttribute("style")+"\">";_19+="<param name=\"movie\" value=\""+this.getAttribute("swf")+"\" />";var _1d=this.getParams();for(var key in _1d){_19+="<param name=\""+key+"\" value=\""+_1d[key]+"\" />";}var _1f=this.getVariablePairs().join("&");if(_1f.length>0){_19+="<param name=\"flashvars\" value=\""+_1f+"\" />";}_19+="</object>";}return _19;},write:function(_20){if(this.getAttribute("useExpressInstall")){var _21=new deconcept.PlayerVersion([6,0,65]);if(this.installedVer.versionIsValid(_21)&&!this.installedVer.versionIsValid(this.getAttribute("version"))){this.setAttribute("doExpressInstall",true);this.addVariable("MMredirectURL",escape(this.getAttribute("xiRedirectUrl")));document.title=document.title.slice(0,47)+" - Flash Player Installation";this.addVariable("MMdoctitle",document.title);}}if(this.skipDetect||this.getAttribute("doExpressInstall")||this.installedVer.versionIsValid(this.getAttribute("version"))){var n=(typeof _20=="string")?document.getElementById(_20):_20;n.innerHTML=this.getSWFHTML();return true;}else{if(this.getAttribute("redirectUrl")!=""){document.location.replace(this.getAttribute("redirectUrl"));}}return false;}};deconcept.SWFObjectUtil.getPlayerVersion=function(){var _23=new deconcept.PlayerVersion([0,0,0]);if(navigator.plugins&&navigator.mimeTypes.length){var x=navigator.plugins["Shockwave Flash"];if(x&&x.description){_23=new deconcept.PlayerVersion(x.description.replace(/([a-zA-Z]|\s)+/,"").replace(/(\s+r|\s+b[0-9]+)/,".").split("."));}}else{if(navigator.userAgent&&navigator.userAgent.indexOf("Windows CE")>=0){var axo=1;var _26=3;while(axo){try{_26++;axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash."+_26);_23=new deconcept.PlayerVersion([_26,0,0]);}catch(e){axo=null;}}}else{try{var axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.7");}catch(e){try{var axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.6");_23=new deconcept.PlayerVersion([6,0,21]);axo.AllowScriptAccess="always";}catch(e){if(_23.major==6){return _23;}}try{axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");}catch(e){}}if(axo!=null){_23=new deconcept.PlayerVersion(axo.GetVariable("$version").split(" ")[1].split(","));}}}return _23;};deconcept.PlayerVersion=function(_29){this.major=_29[0]!=null?parseInt(_29[0]):0;this.minor=_29[1]!=null?parseInt(_29[1]):0;this.rev=_29[2]!=null?parseInt(_29[2]):0;};deconcept.PlayerVersion.prototype.versionIsValid=function(fv){if(this.major<fv.major){return false;}if(this.major>fv.major){return true;}if(this.minor<fv.minor){return false;}if(this.minor>fv.minor){return true;}if(this.rev<fv.rev){return false;}return true;};deconcept.util={getRequestParameter:function(_2b){var q=document.location.search||document.location.hash;if(_2b==null){return q;}if(q){var _2d=q.substring(1).split("&");for(var i=0;i<_2d.length;i++){if(_2d[i].substring(0,_2d[i].indexOf("="))==_2b){return _2d[i].substring((_2d[i].indexOf("=")+1));}}}return "";}};deconcept.SWFObjectUtil.cleanupSWFs=function(){var _2f=document.getElementsByTagName("OBJECT");for(var i=_2f.length-1;i>=0;i--){_2f[i].style.display="none";for(var x in _2f[i]){if(typeof _2f[i][x]=="function"){_2f[i][x]=function(){};}}}};if(deconcept.SWFObject.doPrepUnload){if(!deconcept.unloadSet){deconcept.SWFObjectUtil.prepUnload=function(){__flash_unloadHandler=function(){};__flash_savedUnloadHandler=function(){};window.attachEvent("onunload",deconcept.SWFObjectUtil.cleanupSWFs);};window.attachEvent("onbeforeunload",deconcept.SWFObjectUtil.prepUnload);deconcept.unloadSet=true;}}if(!document.getElementById&&document.all){document.getElementById=function(id){return document.all[id];};}var getQueryParamValue=deconcept.util.getRequestParameter;var FlashObject=deconcept.SWFObject;var SWFObject=deconcept.SWFObject;
    9: 
      name: body
      filter_id: Textile
      page_id: 8
      id: 9
      content: |-
        <h3><r:title /></h3>
        <r:snippet name="posted" />
      
        Vivamus mollis porttitor odio. Vestibulum id mi. Suspendisse a tortor quis metus imperdiet eleifend. Pellentesque libero nulla, aliquam in, tristique vel, elementum et, odio. Fusce id ligula. Vivamus dapibus imperdiet ante. Aliquam id eros ut velit eleifend aliquet. Nulla commodo viverra orci. Sed auctor. Maecenas commodo. Mauris adipiscing lectus quis quam. Nulla a nisl in augue suscipit tincidunt. Nunc eros. Nam eget sapien eget lorem ultrices pulvinar. Vivamus dolor.
      
        Suspendisse auctor risus nec odio. Sed tortor sem, tempor eu, molestie ac, viverra et, arcu. Donec aliquet pede eget tellus. Pellentesque facilisis nibh in ante. Mauris et lectus. Nullam pede. Nam sed pede sollicitudin mi congue vestibulum. Suspendisse et diam sed odio venenatis dictum. 
      
        Integer eget nunc sit amet felis interdum sollicitudin. Mauris posuere, quam eu aliquam iaculis, ipsum magna pellentesque arcu, id rutrum augue erat luctus magna.
      
        Praesent ut lacus. Fusce interdum metus laoreet mi. Duis aliquet. Nunc malesuada leo id nulla. Praesent condimentum metus nec odio. Ut ut velit dapibus nibh interdum eleifend. Proin tempor sodales enim. Donec ultricies. Duis bibendum urna id ante. Donec ipsum lorem, venenatis et, tempus ut, vehicula et, mi. 
      
        <r:snippet name="comments" />
    15: 
      name: summary
      filter_id: Textile
      page_id: 6
      id: 15
      content: Ut enim ad minima veniam, quis nostrum exercitationem ullam corporis suscipit laboriosam, nisi ut aliquid ex ea commodi consequatur? Quis autem vel eum iure reprehenderit qui in ea voluptate velit esse quam nihil molestiae consequatur, vel illum qui dolorem eum fugiat quo voluptas nulla pariatur?
    4: 
      name: body
      filter_id: ""
      page_id: 4
      id: 4
      content: |-
        <r:children:each limit="5" order="desc">
        <div class="entry">
          <h3><r:link /></h3>
            <div class="posted">
              Posted by <r:author /> on <r:date format="%B %d, %Y" /><em>|</em><img src="/images/roasters/comment.png" /><a href="<r:url />#disqus_thread">Comments</a><em>|</em><r:link>Read full article</r:link>    
            </div>
          <r:content part="summary" />
        </div>
        </r:children:each>
      
        <r:snippet name="comments_summary" />
    32: 
      name: body
      filter_id: ""
      page_id: 20
      id: 32
      content: |-
        /*  Prototype JavaScript framework, version 1.6.1
         *  (c) 2005-2009 Sam Stephenson
         *
         *  Prototype is freely distributable under the terms of an MIT-style license.
         *  For details, see the Prototype web site: http://www.prototypejs.org/
         *
         *--------------------------------------------------------------------------*/
      
        var Prototype = {
          Version: '1.6.1',
      
          Browser: (function(){
            var ua = navigator.userAgent;
            var isOpera = Object.prototype.toString.call(window.opera) == '[object Opera]';
            return {
              IE:             !!window.attachEvent && !isOpera,
              Opera:          isOpera,
              WebKit:         ua.indexOf('AppleWebKit/') > -1,
              Gecko:          ua.indexOf('Gecko') > -1 && ua.indexOf('KHTML') === -1,
              MobileSafari:   /Apple.*Mobile.*Safari/.test(ua)
            }
          })(),
      
          BrowserFeatures: {
            XPath: !!document.evaluate,
            SelectorsAPI: !!document.querySelector,
            ElementExtensions: (function() {
              var constructor = window.Element || window.HTMLElement;
              return !!(constructor && constructor.prototype);
            })(),
            SpecificElementExtensions: (function() {
              if (typeof window.HTMLDivElement !== 'undefined')
                return true;
      
              var div = document.createElement('div');
              var form = document.createElement('form');
              var isSupported = false;
      
              if (div['__proto__'] && (div['__proto__'] !== form['__proto__'])) {
                isSupported = true;
              }
      
              div = form = null;
      
              return isSupported;
            })()
          },
      
          ScriptFragment: '<script[^>]*>([\\S\\s]*?)<\/script>',
          JSONFilter: /^\/\*-secure-([\s\S]*)\*\/\s*$/,
      
          emptyFunction: function() { },
          K: function(x) { return x }
        };
      
        if (Prototype.Browser.MobileSafari)
          Prototype.BrowserFeatures.SpecificElementExtensions = false;
      
      
        var Abstract = { };
      
      
        var Try = {
          these: function() {
            var returnValue;
      
            for (var i = 0, length = arguments.length; i < length; i++) {
              var lambda = arguments[i];
              try {
                returnValue = lambda();
                break;
              } catch (e) { }
            }
      
            return returnValue;
          }
        };
      
        /* Based on Alex Arnell's inheritance implementation. */
      
        var Class = (function() {
          function subclass() {};
          function create() {
            var parent = null, properties = $A(arguments);
            if (Object.isFunction(properties[0]))
              parent = properties.shift();
      
            function klass() {
              this.initialize.apply(this, arguments);
            }
      
            Object.extend(klass, Class.Methods);
            klass.superclass = parent;
            klass.subclasses = [];
      
            if (parent) {
              subclass.prototype = parent.prototype;
              klass.prototype = new subclass;
              parent.subclasses.push(klass);
            }
      
            for (var i = 0; i < properties.length; i++)
              klass.addMethods(properties[i]);
      
            if (!klass.prototype.initialize)
              klass.prototype.initialize = Prototype.emptyFunction;
      
            klass.prototype.constructor = klass;
            return klass;
          }
      
          function addMethods(source) {
            var ancestor   = this.superclass && this.superclass.prototype;
            var properties = Object.keys(source);
      
            if (!Object.keys({ toString: true }).length) {
              if (source.toString != Object.prototype.toString)
                properties.push("toString");
              if (source.valueOf != Object.prototype.valueOf)
                properties.push("valueOf");
            }
      
            for (var i = 0, length = properties.length; i < length; i++) {
              var property = properties[i], value = source[property];
              if (ancestor && Object.isFunction(value) &&
                  value.argumentNames().first() == "$super") {
                var method = value;
                value = (function(m) {
                  return function() { return ancestor[m].apply(this, arguments); };
                })(property).wrap(method);
      
                value.valueOf = method.valueOf.bind(method);
                value.toString = method.toString.bind(method);
              }
              this.prototype[property] = value;
            }
      
            return this;
          }
      
          return {
            create: create,
            Methods: {
              addMethods: addMethods
            }
          };
        })();
        (function() {
      
          var _toString = Object.prototype.toString;
      
          function extend(destination, source) {
            for (var property in source)
              destination[property] = source[property];
            return destination;
          }
      
          function inspect(object) {
            try {
              if (isUndefined(object)) return 'undefined';
              if (object === null) return 'null';
              return object.inspect ? object.inspect() : String(object);
            } catch (e) {
              if (e instanceof RangeError) return '...';
              throw e;
            }
          }
      
          function toJSON(object) {
            var type = typeof object;
            switch (type) {
              case 'undefined':
              case 'function':
              case 'unknown': return;
              case 'boolean': return object.toString();
            }
      
            if (object === null) return 'null';
            if (object.toJSON) return object.toJSON();
            if (isElement(object)) return;
      
            var results = [];
            for (var property in object) {
              var value = toJSON(object[property]);
              if (!isUndefined(value))
                results.push(property.toJSON() + ': ' + value);
            }
      
            return '{' + results.join(', ') + '}';
          }
      
          function toQueryString(object) {
            return $H(object).toQueryString();
          }
      
          function toHTML(object) {
            return object && object.toHTML ? object.toHTML() : String.interpret(object);
          }
      
          function keys(object) {
            var results = [];
            for (var property in object)
              results.push(property);
            return results;
          }
      
          function values(object) {
            var results = [];
            for (var property in object)
              results.push(object[property]);
            return results;
          }
      
          function clone(object) {
            return extend({ }, object);
          }
      
          function isElement(object) {
            return !!(object && object.nodeType == 1);
          }
      
          function isArray(object) {
            return _toString.call(object) == "[object Array]";
          }
      
      
          function isHash(object) {
            return object instanceof Hash;
          }
      
          function isFunction(object) {
            return typeof object === "function";
          }
      
          function isString(object) {
            return _toString.call(object) == "[object String]";
          }
      
          function isNumber(object) {
            return _toString.call(object) == "[object Number]";
          }
      
          function isUndefined(object) {
            return typeof object === "undefined";
          }
      
          extend(Object, {
            extend:        extend,
            inspect:       inspect,
            toJSON:        toJSON,
            toQueryString: toQueryString,
            toHTML:        toHTML,
            keys:          keys,
            values:        values,
            clone:         clone,
            isElement:     isElement,
            isArray:       isArray,
            isHash:        isHash,
            isFunction:    isFunction,
            isString:      isString,
            isNumber:      isNumber,
            isUndefined:   isUndefined
          });
        })();
        Object.extend(Function.prototype, (function() {
          var slice = Array.prototype.slice;
      
          function update(array, args) {
            var arrayLength = array.length, length = args.length;
            while (length--) array[arrayLength + length] = args[length];
            return array;
          }
      
          function merge(array, args) {
            array = slice.call(array, 0);
            return update(array, args);
          }
      
          function argumentNames() {
            var names = this.toString().match(/^[\s\(]*function[^(]*\(([^)]*)\)/)[1]
              .replace(/\/\/.*?[\r\n]|\/\*(?:.|[\r\n])*?\*\//g, '')
              .replace(/\s+/g, '').split(',');
            return names.length == 1 && !names[0] ? [] : names;
          }
      
          function bind(context) {
            if (arguments.length < 2 && Object.isUndefined(arguments[0])) return this;
            var __method = this, args = slice.call(arguments, 1);
            return function() {
              var a = merge(args, arguments);
              return __method.apply(context, a);
            }
          }
      
          function bindAsEventListener(context) {
            var __method = this, args = slice.call(arguments, 1);
            return function(event) {
              var a = update([event || window.event], args);
              return __method.apply(context, a);
            }
          }
      
          function curry() {
            if (!arguments.length) return this;
            var __method = this, args = slice.call(arguments, 0);
            return function() {
              var a = merge(args, arguments);
              return __method.apply(this, a);
            }
          }
      
          function delay(timeout) {
            var __method = this, args = slice.call(arguments, 1);
            timeout = timeout * 1000
            return window.setTimeout(function() {
              return __method.apply(__method, args);
            }, timeout);
          }
      
          function defer() {
            var args = update([0.01], arguments);
            return this.delay.apply(this, args);
          }
      
          function wrap(wrapper) {
            var __method = this;
            return function() {
              var a = update([__method.bind(this)], arguments);
              return wrapper.apply(this, a);
            }
          }
      
          function methodize() {
            if (this._methodized) return this._methodized;
            var __method = this;
            return this._methodized = function() {
              var a = update([this], arguments);
              return __method.apply(null, a);
            };
          }
      
          return {
            argumentNames:       argumentNames,
            bind:                bind,
            bindAsEventListener: bindAsEventListener,
            curry:               curry,
            delay:               delay,
            defer:               defer,
            wrap:                wrap,
            methodize:           methodize
          }
        })());
      
      
        Date.prototype.toJSON = function() {
          return '"' + this.getUTCFullYear() + '-' +
            (this.getUTCMonth() + 1).toPaddedString(2) + '-' +
            this.getUTCDate().toPaddedString(2) + 'T' +
            this.getUTCHours().toPaddedString(2) + ':' +
            this.getUTCMinutes().toPaddedString(2) + ':' +
            this.getUTCSeconds().toPaddedString(2) + 'Z"';
        };
      
      
        RegExp.prototype.match = RegExp.prototype.test;
      
        RegExp.escape = function(str) {
          return String(str).replace(/([.*+?^=!:${}()|[\]\/\\])/g, '\\$1');
        };
        var PeriodicalExecuter = Class.create({
          initialize: function(callback, frequency) {
            this.callback = callback;
            this.frequency = frequency;
            this.currentlyExecuting = false;
      
            this.registerCallback();
          },
      
          registerCallback: function() {
            this.timer = setInterval(this.onTimerEvent.bind(this), this.frequency * 1000);
          },
      
          execute: function() {
            this.callback(this);
          },
      
          stop: function() {
            if (!this.timer) return;
            clearInterval(this.timer);
            this.timer = null;
          },
      
          onTimerEvent: function() {
            if (!this.currentlyExecuting) {
              try {
                this.currentlyExecuting = true;
                this.execute();
                this.currentlyExecuting = false;
              } catch(e) {
                this.currentlyExecuting = false;
                throw e;
              }
            }
          }
        });
        Object.extend(String, {
          interpret: function(value) {
            return value == null ? '' : String(value);
          },
          specialChar: {
            '\b': '\\b',
            '\t': '\\t',
            '\n': '\\n',
            '\f': '\\f',
            '\r': '\\r',
            '\\': '\\\\'
          }
        });
      
        Object.extend(String.prototype, (function() {
      
          function prepareReplacement(replacement) {
            if (Object.isFunction(replacement)) return replacement;
            var template = new Template(replacement);
            return function(match) { return template.evaluate(match) };
          }
      
          function gsub(pattern, replacement) {
            var result = '', source = this, match;
            replacement = prepareReplacement(replacement);
      
            if (Object.isString(pattern))
              pattern = RegExp.escape(pattern);
      
            if (!(pattern.length || pattern.source)) {
              replacement = replacement('');
              return replacement + source.split('').join(replacement) + replacement;
            }
      
            while (source.length > 0) {
              if (match = source.match(pattern)) {
                result += source.slice(0, match.index);
                result += String.interpret(replacement(match));
                source  = source.slice(match.index + match[0].length);
              } else {
                result += source, source = '';
              }
            }
            return result;
          }
      
          function sub(pattern, replacement, count) {
            replacement = prepareReplacement(replacement);
            count = Object.isUndefined(count) ? 1 : count;
      
            return this.gsub(pattern, function(match) {
              if (--count < 0) return match[0];
              return replacement(match);
            });
          }
      
          function scan(pattern, iterator) {
            this.gsub(pattern, iterator);
            return String(this);
          }
      
          function truncate(length, truncation) {
            length = length || 30;
            truncation = Object.isUndefined(truncation) ? '...' : truncation;
            return this.length > length ?
              this.slice(0, length - truncation.length) + truncation : String(this);
          }
      
          function strip() {
            return this.replace(/^\s+/, '').replace(/\s+$/, '');
          }
      
          function stripTags() {
            return this.replace(/<\w+(\s+("[^"]*"|'[^']*'|[^>])+)?>|<\/\w+>/gi, '');
          }
      
          function stripScripts() {
            return this.replace(new RegExp(Prototype.ScriptFragment, 'img'), '');
          }
      
          function extractScripts() {
            var matchAll = new RegExp(Prototype.ScriptFragment, 'img');
            var matchOne = new RegExp(Prototype.ScriptFragment, 'im');
            return (this.match(matchAll) || []).map(function(scriptTag) {
              return (scriptTag.match(matchOne) || ['', ''])[1];
            });
          }
      
          function evalScripts() {
            return this.extractScripts().map(function(script) { return eval(script) });
          }
      
          function escapeHTML() {
            return this.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
          }
      
          function unescapeHTML() {
            return this.stripTags().replace(/&lt;/g,'<').replace(/&gt;/g,'>').replace(/&amp;/g,'&');
          }
      
      
          function toQueryParams(separator) {
            var match = this.strip().match(/([^?#]*)(#.*)?$/);
            if (!match) return { };
      
            return match[1].split(separator || '&').inject({ }, function(hash, pair) {
              if ((pair = pair.split('='))[0]) {
                var key = decodeURIComponent(pair.shift());
                var value = pair.length > 1 ? pair.join('=') : pair[0];
                if (value != undefined) value = decodeURIComponent(value);
      
                if (key in hash) {
                  if (!Object.isArray(hash[key])) hash[key] = [hash[key]];
                  hash[key].push(value);
                }
                else hash[key] = value;
              }
              return hash;
            });
          }
      
          function toArray() {
            return this.split('');
          }
      
          function succ() {
            return this.slice(0, this.length - 1) +
              String.fromCharCode(this.charCodeAt(this.length - 1) + 1);
          }
      
          function times(count) {
            return count < 1 ? '' : new Array(count + 1).join(this);
          }
      
          function camelize() {
            var parts = this.split('-'), len = parts.length;
            if (len == 1) return parts[0];
      
            var camelized = this.charAt(0) == '-'
              ? parts[0].charAt(0).toUpperCase() + parts[0].substring(1)
              : parts[0];
      
            for (var i = 1; i < len; i++)
              camelized += parts[i].charAt(0).toUpperCase() + parts[i].substring(1);
      
            return camelized;
          }
      
          function capitalize() {
            return this.charAt(0).toUpperCase() + this.substring(1).toLowerCase();
          }
      
          function underscore() {
            return this.replace(/::/g, '/')
                       .replace(/([A-Z]+)([A-Z][a-z])/g, '$1_$2')
                       .replace(/([a-z\d])([A-Z])/g, '$1_$2')
                       .replace(/-/g, '_')
                       .toLowerCase();
          }
      
          function dasherize() {
            return this.replace(/_/g, '-');
          }
      
          function inspect(useDoubleQuotes) {
            var escapedString = this.replace(/[\x00-\x1f\\]/g, function(character) {
              if (character in String.specialChar) {
                return String.specialChar[character];
              }
              return '\\u00' + character.charCodeAt().toPaddedString(2, 16);
            });
            if (useDoubleQuotes) return '"' + escapedString.replace(/"/g, '\\"') + '"';
            return "'" + escapedString.replace(/'/g, '\\\'') + "'";
          }
      
          function toJSON() {
            return this.inspect(true);
          }
      
          function unfilterJSON(filter) {
            return this.replace(filter || Prototype.JSONFilter, '$1');
          }
      
          function isJSON() {
            var str = this;
            if (str.blank()) return false;
            str = this.replace(/\\./g, '@').replace(/"[^"\\\n\r]*"/g, '');
            return (/^[,:{}\[\]0-9.\-+Eaeflnr-u \n\r\t]*$/).test(str);
          }
      
          function evalJSON(sanitize) {
            var json = this.unfilterJSON();
            try {
              if (!sanitize || json.isJSON()) return eval('(' + json + ')');
            } catch (e) { }
            throw new SyntaxError('Badly formed JSON string: ' + this.inspect());
          }
      
          function include(pattern) {
            return this.indexOf(pattern) > -1;
          }
      
          function startsWith(pattern) {
            return this.indexOf(pattern) === 0;
          }
      
          function endsWith(pattern) {
            var d = this.length - pattern.length;
            return d >= 0 && this.lastIndexOf(pattern) === d;
          }
      
          function empty() {
            return this == '';
          }
      
          function blank() {
            return /^\s*$/.test(this);
          }
      
          function interpolate(object, pattern) {
            return new Template(this, pattern).evaluate(object);
          }
      
          return {
            gsub:           gsub,
            sub:            sub,
            scan:           scan,
            truncate:       truncate,
            strip:          String.prototype.trim ? String.prototype.trim : strip,
            stripTags:      stripTags,
            stripScripts:   stripScripts,
            extractScripts: extractScripts,
            evalScripts:    evalScripts,
            escapeHTML:     escapeHTML,
            unescapeHTML:   unescapeHTML,
            toQueryParams:  toQueryParams,
            parseQuery:     toQueryParams,
            toArray:        toArray,
            succ:           succ,
            times:          times,
            camelize:       camelize,
            capitalize:     capitalize,
            underscore:     underscore,
            dasherize:      dasherize,
            inspect:        inspect,
            toJSON:         toJSON,
            unfilterJSON:   unfilterJSON,
            isJSON:         isJSON,
            evalJSON:       evalJSON,
            include:        include,
            startsWith:     startsWith,
            endsWith:       endsWith,
            empty:          empty,
            blank:          blank,
            interpolate:    interpolate
          };
        })());
      
        var Template = Class.create({
          initialize: function(template, pattern) {
            this.template = template.toString();
            this.pattern = pattern || Template.Pattern;
          },
      
          evaluate: function(object) {
            if (object && Object.isFunction(object.toTemplateReplacements))
              object = object.toTemplateReplacements();
      
            return this.template.gsub(this.pattern, function(match) {
              if (object == null) return (match[1] + '');
      
              var before = match[1] || '';
              if (before == '\\') return match[2];
      
              var ctx = object, expr = match[3];
              var pattern = /^([^.[]+|\[((?:.*?[^\\])?)\])(\.|\[|$)/;
              match = pattern.exec(expr);
              if (match == null) return before;
      
              while (match != null) {
                var comp = match[1].startsWith('[') ? match[2].replace(/\\\\]/g, ']') : match[1];
                ctx = ctx[comp];
                if (null == ctx || '' == match[3]) break;
                expr = expr.substring('[' == match[3] ? match[1].length : match[0].length);
                match = pattern.exec(expr);
              }
      
              return before + String.interpret(ctx);
            });
          }
        });
        Template.Pattern = /(^|.|\r|\n)(#\{(.*?)\})/;
      
        var $break = { };
      
        var Enumerable = (function() {
          function each(iterator, context) {
            var index = 0;
            try {
              this._each(function(value) {
                iterator.call(context, value, index++);
              });
            } catch (e) {
              if (e != $break) throw e;
            }
            return this;
          }
      
          function eachSlice(number, iterator, context) {
            var index = -number, slices = [], array = this.toArray();
            if (number < 1) return array;
            while ((index += number) < array.length)
              slices.push(array.slice(index, index+number));
            return slices.collect(iterator, context);
          }
      
          function all(iterator, context) {
            iterator = iterator || Prototype.K;
            var result = true;
            this.each(function(value, index) {
              result = result && !!iterator.call(context, value, index);
              if (!result) throw $break;
            });
            return result;
          }
      
          function any(iterator, context) {
            iterator = iterator || Prototype.K;
            var result = false;
            this.each(function(value, index) {
              if (result = !!iterator.call(context, value, index))
                throw $break;
            });
            return result;
          }
      
          function collect(iterator, context) {
            iterator = iterator || Prototype.K;
            var results = [];
            this.each(function(value, index) {
              results.push(iterator.call(context, value, index));
            });
            return results;
          }
      
          function detect(iterator, context) {
            var result;
            this.each(function(value, index) {
              if (iterator.call(context, value, index)) {
                result = value;
                throw $break;
              }
            });
            return result;
          }
      
          function findAll(iterator, context) {
            var results = [];
            this.each(function(value, index) {
              if (iterator.call(context, value, index))
                results.push(value);
            });
            return results;
          }
      
          function grep(filter, iterator, context) {
            iterator = iterator || Prototype.K;
            var results = [];
      
            if (Object.isString(filter))
              filter = new RegExp(RegExp.escape(filter));
      
            this.each(function(value, index) {
              if (filter.match(value))
                results.push(iterator.call(context, value, index));
            });
            return results;
          }
      
          function include(object) {
            if (Object.isFunction(this.indexOf))
              if (this.indexOf(object) != -1) return true;
      
            var found = false;
            this.each(function(value) {
              if (value == object) {
                found = true;
                throw $break;
              }
            });
            return found;
          }
      
          function inGroupsOf(number, fillWith) {
            fillWith = Object.isUndefined(fillWith) ? null : fillWith;
            return this.eachSlice(number, function(slice) {
              while(slice.length < number) slice.push(fillWith);
              return slice;
            });
          }
      
          function inject(memo, iterator, context) {
            this.each(function(value, index) {
              memo = iterator.call(context, memo, value, index);
            });
            return memo;
          }
      
          function invoke(method) {
            var args = $A(arguments).slice(1);
            return this.map(function(value) {
              return value[method].apply(value, args);
            });
          }
      
          function max(iterator, context) {
            iterator = iterator || Prototype.K;
            var result;
            this.each(function(value, index) {
              value = iterator.call(context, value, index);
              if (result == null || value >= result)
                result = value;
            });
            return result;
          }
      
          function min(iterator, context) {
            iterator = iterator || Prototype.K;
            var result;
            this.each(function(value, index) {
              value = iterator.call(context, value, index);
              if (result == null || value < result)
                result = value;
            });
            return result;
          }
      
          function partition(iterator, context) {
            iterator = iterator || Prototype.K;
            var trues = [], falses = [];
            this.each(function(value, index) {
              (iterator.call(context, value, index) ?
                trues : falses).push(value);
            });
            return [trues, falses];
          }
      
          function pluck(property) {
            var results = [];
            this.each(function(value) {
              results.push(value[property]);
            });
            return results;
          }
      
          function reject(iterator, context) {
            var results = [];
            this.each(function(value, index) {
              if (!iterator.call(context, value, index))
                results.push(value);
            });
            return results;
          }
      
          function sortBy(iterator, context) {
            return this.map(function(value, index) {
              return {
                value: value,
                criteria: iterator.call(context, value, index)
              };
            }).sort(function(left, right) {
              var a = left.criteria, b = right.criteria;
              return a < b ? -1 : a > b ? 1 : 0;
            }).pluck('value');
          }
      
          function toArray() {
            return this.map();
          }
      
          function zip() {
            var iterator = Prototype.K, args = $A(arguments);
            if (Object.isFunction(args.last()))
              iterator = args.pop();
      
            var collections = [this].concat(args).map($A);
            return this.map(function(value, index) {
              return iterator(collections.pluck(index));
            });
          }
      
          function size() {
            return this.toArray().length;
          }
      
          function inspect() {
            return '#<Enumerable:' + this.toArray().inspect() + '>';
          }
      
      
      
      
      
      
      
      
      
          return {
            each:       each,
            eachSlice:  eachSlice,
            all:        all,
            every:      all,
            any:        any,
            some:       any,
            collect:    collect,
            map:        collect,
            detect:     detect,
            findAll:    findAll,
            select:     findAll,
            filter:     findAll,
            grep:       grep,
            include:    include,
            member:     include,
            inGroupsOf: inGroupsOf,
            inject:     inject,
            invoke:     invoke,
            max:        max,
            min:        min,
            partition:  partition,
            pluck:      pluck,
            reject:     reject,
            sortBy:     sortBy,
            toArray:    toArray,
            entries:    toArray,
            zip:        zip,
            size:       size,
            inspect:    inspect,
            find:       detect
          };
        })();
        function $A(iterable) {
          if (!iterable) return [];
          if ('toArray' in Object(iterable)) return iterable.toArray();
          var length = iterable.length || 0, results = new Array(length);
          while (length--) results[length] = iterable[length];
          return results;
        }
      
        function $w(string) {
          if (!Object.isString(string)) return [];
          string = string.strip();
          return string ? string.split(/\s+/) : [];
        }
      
        Array.from = $A;
      
      
        (function() {
          var arrayProto = Array.prototype,
              slice = arrayProto.slice,
              _each = arrayProto.forEach; // use native browser JS 1.6 implementation if available
      
          function each(iterator) {
            for (var i = 0, length = this.length; i < length; i++)
              iterator(this[i]);
          }
          if (!_each) _each = each;
      
          function clear() {
            this.length = 0;
            return this;
          }
      
          function first() {
            return this[0];
          }
      
          function last() {
            return this[this.length - 1];
          }
      
          function compact() {
            return this.select(function(value) {
              return value != null;
            });
          }
      
          function flatten() {
            return this.inject([], function(array, value) {
              if (Object.isArray(value))
                return array.concat(value.flatten());
              array.push(value);
              return array;
            });
          }
      
          function without() {
            var values = slice.call(arguments, 0);
            return this.select(function(value) {
              return !values.include(value);
            });
          }
      
          function reverse(inline) {
            return (inline !== false ? this : this.toArray())._reverse();
          }
      
          function uniq(sorted) {
            return this.inject([], function(array, value, index) {
              if (0 == index || (sorted ? array.last() != value : !array.include(value)))
                array.push(value);
              return array;
            });
          }
      
          function intersect(array) {
            return this.uniq().findAll(function(item) {
              return array.detect(function(value) { return item === value });
            });
          }
      
      
          function clone() {
            return slice.call(this, 0);
          }
      
          function size() {
            return this.length;
          }
      
          function inspect() {
            return '[' + this.map(Object.inspect).join(', ') + ']';
          }
      
          function toJSON() {
            var results = [];
            this.each(function(object) {
              var value = Object.toJSON(object);
              if (!Object.isUndefined(value)) results.push(value);
            });
            return '[' + results.join(', ') + ']';
          }
      
          function indexOf(item, i) {
            i || (i = 0);
            var length = this.length;
            if (i < 0) i = length + i;
            for (; i < length; i++)
              if (this[i] === item) return i;
            return -1;
          }
      
          function lastIndexOf(item, i) {
            i = isNaN(i) ? this.length : (i < 0 ? this.length + i : i) + 1;
            var n = this.slice(0, i).reverse().indexOf(item);
            return (n < 0) ? n : i - n - 1;
          }
      
          function concat() {
            var array = slice.call(this, 0), item;
            for (var i = 0, length = arguments.length; i < length; i++) {
              item = arguments[i];
              if (Object.isArray(item) && !('callee' in item)) {
                for (var j = 0, arrayLength = item.length; j < arrayLength; j++)
                  array.push(item[j]);
              } else {
                array.push(item);
              }
            }
            return array;
          }
      
          Object.extend(arrayProto, Enumerable);
      
          if (!arrayProto._reverse)
            arrayProto._reverse = arrayProto.reverse;
      
          Object.extend(arrayProto, {
            _each:     _each,
            clear:     clear,
            first:     first,
            last:      last,
            compact:   compact,
            flatten:   flatten,
            without:   without,
            reverse:   reverse,
            uniq:      uniq,
            intersect: intersect,
            clone:     clone,
            toArray:   clone,
            size:      size,
            inspect:   inspect,
            toJSON:    toJSON
          });
      
          var CONCAT_ARGUMENTS_BUGGY = (function() {
            return [].concat(arguments)[0][0] !== 1;
          })(1,2)
      
          if (CONCAT_ARGUMENTS_BUGGY) arrayProto.concat = concat;
      
          if (!arrayProto.indexOf) arrayProto.indexOf = indexOf;
          if (!arrayProto.lastIndexOf) arrayProto.lastIndexOf = lastIndexOf;
        })();
        function $H(object) {
          return new Hash(object);
        };
      
        var Hash = Class.create(Enumerable, (function() {
          function initialize(object) {
            this._object = Object.isHash(object) ? object.toObject() : Object.clone(object);
          }
      
          function _each(iterator) {
            for (var key in this._object) {
              var value = this._object[key], pair = [key, value];
              pair.key = key;
              pair.value = value;
              iterator(pair);
            }
          }
      
          function set(key, value) {
            return this._object[key] = value;
          }
      
          function get(key) {
            if (this._object[key] !== Object.prototype[key])
              return this._object[key];
          }
      
          function unset(key) {
            var value = this._object[key];
            delete this._object[key];
            return value;
          }
      
          function toObject() {
            return Object.clone(this._object);
          }
      
          function keys() {
            return this.pluck('key');
          }
      
          function values() {
            return this.pluck('value');
          }
      
          function index(value) {
            var match = this.detect(function(pair) {
              return pair.value === value;
            });
            return match && match.key;
          }
      
          function merge(object) {
            return this.clone().update(object);
          }
      
          function update(object) {
            return new Hash(object).inject(this, function(result, pair) {
              result.set(pair.key, pair.value);
              return result;
            });
          }
      
          function toQueryPair(key, value) {
            if (Object.isUndefined(value)) return key;
            return key + '=' + encodeURIComponent(String.interpret(value));
          }
      
          function toQueryString() {
            return this.inject([], function(results, pair) {
              var key = encodeURIComponent(pair.key), values = pair.value;
      
              if (values && typeof values == 'object') {
                if (Object.isArray(values))
                  return results.concat(values.map(toQueryPair.curry(key)));
              } else results.push(toQueryPair(key, values));
              return results;
            }).join('&');
          }
      
          function inspect() {
            return '#<Hash:{' + this.map(function(pair) {
              return pair.map(Object.inspect).join(': ');
            }).join(', ') + '}>';
          }
      
          function toJSON() {
            return Object.toJSON(this.toObject());
          }
      
          function clone() {
            return new Hash(this);
          }
      
          return {
            initialize:             initialize,
            _each:                  _each,
            set:                    set,
            get:                    get,
            unset:                  unset,
            toObject:               toObject,
            toTemplateReplacements: toObject,
            keys:                   keys,
            values:                 values,
            index:                  index,
            merge:                  merge,
            update:                 update,
            toQueryString:          toQueryString,
            inspect:                inspect,
            toJSON:                 toJSON,
            clone:                  clone
          };
        })());
      
        Hash.from = $H;
        Object.extend(Number.prototype, (function() {
          function toColorPart() {
            return this.toPaddedString(2, 16);
          }
      
          function succ() {
            return this + 1;
          }
      
          function times(iterator, context) {
            $R(0, this, true).each(iterator, context);
            return this;
          }
      
          function toPaddedString(length, radix) {
            var string = this.toString(radix || 10);
            return '0'.times(length - string.length) + string;
          }
      
          function toJSON() {
            return isFinite(this) ? this.toString() : 'null';
          }
      
          function abs() {
            return Math.abs(this);
          }
      
          function round() {
            return Math.round(this);
          }
      
          function ceil() {
            return Math.ceil(this);
          }
      
          function floor() {
            return Math.floor(this);
          }
      
          return {
            toColorPart:    toColorPart,
            succ:           succ,
            times:          times,
            toPaddedString: toPaddedString,
            toJSON:         toJSON,
            abs:            abs,
            round:          round,
            ceil:           ceil,
            floor:          floor
          };
        })());
      
        function $R(start, end, exclusive) {
          return new ObjectRange(start, end, exclusive);
        }
      
        var ObjectRange = Class.create(Enumerable, (function() {
          function initialize(start, end, exclusive) {
            this.start = start;
            this.end = end;
            this.exclusive = exclusive;
          }
      
          function _each(iterator) {
            var value = this.start;
            while (this.include(value)) {
              iterator(value);
              value = value.succ();
            }
          }
      
          function include(value) {
            if (value < this.start)
              return false;
            if (this.exclusive)
              return value < this.end;
            return value <= this.end;
          }
      
          return {
            initialize: initialize,
            _each:      _each,
            include:    include
          };
        })());
      
      
      
        var Ajax = {
          getTransport: function() {
            return Try.these(
              function() {return new XMLHttpRequest()},
              function() {return new ActiveXObject('Msxml2.XMLHTTP')},
              function() {return new ActiveXObject('Microsoft.XMLHTTP')}
            ) || false;
          },
      
          activeRequestCount: 0
        };
      
        Ajax.Responders = {
          responders: [],
      
          _each: function(iterator) {
            this.responders._each(iterator);
          },
      
          register: function(responder) {
            if (!this.include(responder))
              this.responders.push(responder);
          },
      
          unregister: function(responder) {
            this.responders = this.responders.without(responder);
          },
      
          dispatch: function(callback, request, transport, json) {
            this.each(function(responder) {
              if (Object.isFunction(responder[callback])) {
                try {
                  responder[callback].apply(responder, [request, transport, json]);
                } catch (e) { }
              }
            });
          }
        };
      
        Object.extend(Ajax.Responders, Enumerable);
      
        Ajax.Responders.register({
          onCreate:   function() { Ajax.activeRequestCount++ },
          onComplete: function() { Ajax.activeRequestCount-- }
        });
        Ajax.Base = Class.create({
          initialize: function(options) {
            this.options = {
              method:       'post',
              asynchronous: true,
              contentType:  'application/x-www-form-urlencoded',
              encoding:     'UTF-8',
              parameters:   '',
              evalJSON:     true,
              evalJS:       true
            };
            Object.extend(this.options, options || { });
      
            this.options.method = this.options.method.toLowerCase();
      
            if (Object.isString(this.options.parameters))
              this.options.parameters = this.options.parameters.toQueryParams();
            else if (Object.isHash(this.options.parameters))
              this.options.parameters = this.options.parameters.toObject();
          }
        });
        Ajax.Request = Class.create(Ajax.Base, {
          _complete: false,
      
          initialize: function($super, url, options) {
            $super(options);
            this.transport = Ajax.getTransport();
            this.request(url);
          },
      
          request: function(url) {
            this.url = url;
            this.method = this.options.method;
            var params = Object.clone(this.options.parameters);
      
            if (!['get', 'post'].include(this.method)) {
              params['_method'] = this.method;
              this.method = 'post';
            }
      
            this.parameters = params;
      
            if (params = Object.toQueryString(params)) {
              if (this.method == 'get')
                this.url += (this.url.include('?') ? '&' : '?') + params;
              else if (/Konqueror|Safari|KHTML/.test(navigator.userAgent))
                params += '&_=';
            }
      
            try {
              var response = new Ajax.Response(this);
              if (this.options.onCreate) this.options.onCreate(response);
              Ajax.Responders.dispatch('onCreate', this, response);
      
              this.transport.open(this.method.toUpperCase(), this.url,
                this.options.asynchronous);
      
              if (this.options.asynchronous) this.respondToReadyState.bind(this).defer(1);
      
              this.transport.onreadystatechange = this.onStateChange.bind(this);
              this.setRequestHeaders();
      
              this.body = this.method == 'post' ? (this.options.postBody || params) : null;
              this.transport.send(this.body);
      
              /* Force Firefox to handle ready state 4 for synchronous requests */
              if (!this.options.asynchronous && this.transport.overrideMimeType)
                this.onStateChange();
      
            }
            catch (e) {
              this.dispatchException(e);
            }
          },
      
          onStateChange: function() {
            var readyState = this.transport.readyState;
            if (readyState > 1 && !((readyState == 4) && this._complete))
              this.respondToReadyState(this.transport.readyState);
          },
      
          setRequestHeaders: function() {
            var headers = {
              'X-Requested-With': 'XMLHttpRequest',
              'X-Prototype-Version': Prototype.Version,
              'Accept': 'text/javascript, text/html, application/xml, text/xml, */*'
            };
      
            if (this.method == 'post') {
              headers['Content-type'] = this.options.contentType +
                (this.options.encoding ? '; charset=' + this.options.encoding : '');
      
              /* Force "Connection: close" for older Mozilla browsers to work
               * around a bug where XMLHttpRequest sends an incorrect
               * Content-length header. See Mozilla Bugzilla #246651.
               */
              if (this.transport.overrideMimeType &&
                  (navigator.userAgent.match(/Gecko\/(\d{4})/) || [0,2005])[1] < 2005)
                    headers['Connection'] = 'close';
            }
      
            if (typeof this.options.requestHeaders == 'object') {
              var extras = this.options.requestHeaders;
      
              if (Object.isFunction(extras.push))
                for (var i = 0, length = extras.length; i < length; i += 2)
                  headers[extras[i]] = extras[i+1];
              else
                $H(extras).each(function(pair) { headers[pair.key] = pair.value });
            }
      
            for (var name in headers)
              this.transport.setRequestHeader(name, headers[name]);
          },
      
          success: function() {
            var status = this.getStatus();
            return !status || (status >= 200 && status < 300);
          },
      
          getStatus: function() {
            try {
              return this.transport.status || 0;
            } catch (e) { return 0 }
          },
      
          respondToReadyState: function(readyState) {
            var state = Ajax.Request.Events[readyState], response = new Ajax.Response(this);
      
            if (state == 'Complete') {
              try {
                this._complete = true;
                (this.options['on' + response.status]
                 || this.options['on' + (this.success() ? 'Success' : 'Failure')]
                 || Prototype.emptyFunction)(response, response.headerJSON);
              } catch (e) {
                this.dispatchException(e);
              }
      
              var contentType = response.getHeader('Content-type');
              if (this.options.evalJS == 'force'
                  || (this.options.evalJS && this.isSameOrigin() && contentType
                  && contentType.match(/^\s*(text|application)\/(x-)?(java|ecma)script(;.*)?\s*$/i)))
                this.evalResponse();
            }
      
            try {
              (this.options['on' + state] || Prototype.emptyFunction)(response, response.headerJSON);
              Ajax.Responders.dispatch('on' + state, this, response, response.headerJSON);
            } catch (e) {
              this.dispatchException(e);
            }
      
            if (state == 'Complete') {
              this.transport.onreadystatechange = Prototype.emptyFunction;
            }
          },
      
          isSameOrigin: function() {
            var m = this.url.match(/^\s*https?:\/\/[^\/]*/);
            return !m || (m[0] == '#{protocol}//#{domain}#{port}'.interpolate({
              protocol: location.protocol,
              domain: document.domain,
              port: location.port ? ':' + location.port : ''
            }));
          },
      
          getHeader: function(name) {
            try {
              return this.transport.getResponseHeader(name) || null;
            } catch (e) { return null; }
          },
      
          evalResponse: function() {
            try {
              return eval((this.transport.responseText || '').unfilterJSON());
            } catch (e) {
              this.dispatchException(e);
            }
          },
      
          dispatchException: function(exception) {
            (this.options.onException || Prototype.emptyFunction)(this, exception);
            Ajax.Responders.dispatch('onException', this, exception);
          }
        });
      
        Ajax.Request.Events =
          ['Uninitialized', 'Loading', 'Loaded', 'Interactive', 'Complete'];
      
      
      
      
      
      
      
      
        Ajax.Response = Class.create({
          initialize: function(request){
            this.request = request;
            var transport  = this.transport  = request.transport,
                readyState = this.readyState = transport.readyState;
      
            if((readyState > 2 && !Prototype.Browser.IE) || readyState == 4) {
              this.status       = this.getStatus();
              this.statusText   = this.getStatusText();
              this.responseText = String.interpret(transport.responseText);
              this.headerJSON   = this._getHeaderJSON();
            }
      
            if(readyState == 4) {
              var xml = transport.responseXML;
              this.responseXML  = Object.isUndefined(xml) ? null : xml;
              this.responseJSON = this._getResponseJSON();
            }
          },
      
          status:      0,
      
          statusText: '',
      
          getStatus: Ajax.Request.prototype.getStatus,
      
          getStatusText: function() {
            try {
              return this.transport.statusText || '';
            } catch (e) { return '' }
          },
      
          getHeader: Ajax.Request.prototype.getHeader,
      
          getAllHeaders: function() {
            try {
              return this.getAllResponseHeaders();
            } catch (e) { return null }
          },
      
          getResponseHeader: function(name) {
            return this.transport.getResponseHeader(name);
          },
      
          getAllResponseHeaders: function() {
            return this.transport.getAllResponseHeaders();
          },
      
          _getHeaderJSON: function() {
            var json = this.getHeader('X-JSON');
            if (!json) return null;
            json = decodeURIComponent(escape(json));
            try {
              return json.evalJSON(this.request.options.sanitizeJSON ||
                !this.request.isSameOrigin());
            } catch (e) {
              this.request.dispatchException(e);
            }
          },
      
          _getResponseJSON: function() {
            var options = this.request.options;
            if (!options.evalJSON || (options.evalJSON != 'force' &&
              !(this.getHeader('Content-type') || '').include('application/json')) ||
                this.responseText.blank())
                  return null;
            try {
              return this.responseText.evalJSON(options.sanitizeJSON ||
                !this.request.isSameOrigin());
            } catch (e) {
              this.request.dispatchException(e);
            }
          }
        });
      
        Ajax.Updater = Class.create(Ajax.Request, {
          initialize: function($super, container, url, options) {
            this.container = {
              success: (container.success || container),
              failure: (container.failure || (container.success ? null : container))
            };
      
            options = Object.clone(options);
            var onComplete = options.onComplete;
            options.onComplete = (function(response, json) {
              this.updateContent(response.responseText);
              if (Object.isFunction(onComplete)) onComplete(response, json);
            }).bind(this);
      
            $super(url, options);
          },
      
          updateContent: function(responseText) {
            var receiver = this.container[this.success() ? 'success' : 'failure'],
                options = this.options;
      
            if (!options.evalScripts) responseText = responseText.stripScripts();
      
            if (receiver = $(receiver)) {
              if (options.insertion) {
                if (Object.isString(options.insertion)) {
                  var insertion = { }; insertion[options.insertion] = responseText;
                  receiver.insert(insertion);
                }
                else options.insertion(receiver, responseText);
              }
              else receiver.update(responseText);
            }
          }
        });
      
        Ajax.PeriodicalUpdater = Class.create(Ajax.Base, {
          initialize: function($super, container, url, options) {
            $super(options);
            this.onComplete = this.options.onComplete;
      
            this.frequency = (this.options.frequency || 2);
            this.decay = (this.options.decay || 1);
      
            this.updater = { };
            this.container = container;
            this.url = url;
      
            this.start();
          },
      
          start: function() {
            this.options.onComplete = this.updateComplete.bind(this);
            this.onTimerEvent();
          },
      
          stop: function() {
            this.updater.options.onComplete = undefined;
            clearTimeout(this.timer);
            (this.onComplete || Prototype.emptyFunction).apply(this, arguments);
          },
      
          updateComplete: function(response) {
            if (this.options.decay) {
              this.decay = (response.responseText == this.lastText ?
                this.decay * this.options.decay : 1);
      
              this.lastText = response.responseText;
            }
            this.timer = this.onTimerEvent.bind(this).delay(this.decay * this.frequency);
          },
      
          onTimerEvent: function() {
            this.updater = new Ajax.Updater(this.container, this.url, this.options);
          }
        });
      
      
      
        function $(element) {
          if (arguments.length > 1) {
            for (var i = 0, elements = [], length = arguments.length; i < length; i++)
              elements.push($(arguments[i]));
            return elements;
          }
          if (Object.isString(element))
            element = document.getElementById(element);
          return Element.extend(element);
        }
      
        if (Prototype.BrowserFeatures.XPath) {
          document._getElementsByXPath = function(expression, parentElement) {
            var results = [];
            var query = document.evaluate(expression, $(parentElement) || document,
              null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
            for (var i = 0, length = query.snapshotLength; i < length; i++)
              results.push(Element.extend(query.snapshotItem(i)));
            return results;
          };
        }
      
        /*--------------------------------------------------------------------------*/
      
        if (!window.Node) var Node = { };
      
        if (!Node.ELEMENT_NODE) {
          Object.extend(Node, {
            ELEMENT_NODE: 1,
            ATTRIBUTE_NODE: 2,
            TEXT_NODE: 3,
            CDATA_SECTION_NODE: 4,
            ENTITY_REFERENCE_NODE: 5,
            ENTITY_NODE: 6,
            PROCESSING_INSTRUCTION_NODE: 7,
            COMMENT_NODE: 8,
            DOCUMENT_NODE: 9,
            DOCUMENT_TYPE_NODE: 10,
            DOCUMENT_FRAGMENT_NODE: 11,
            NOTATION_NODE: 12
          });
        }
      
      
        (function(global) {
      
          var SETATTRIBUTE_IGNORES_NAME = (function(){
            var elForm = document.createElement("form");
            var elInput = document.createElement("input");
            var root = document.documentElement;
            elInput.setAttribute("name", "test");
            elForm.appendChild(elInput);
            root.appendChild(elForm);
            var isBuggy = elForm.elements
              ? (typeof elForm.elements.test == "undefined")
              : null;
            root.removeChild(elForm);
            elForm = elInput = null;
            return isBuggy;
          })();
      
          var element = global.Element;
          global.Element = function(tagName, attributes) {
            attributes = attributes || { };
            tagName = tagName.toLowerCase();
            var cache = Element.cache;
            if (SETATTRIBUTE_IGNORES_NAME && attributes.name) {
              tagName = '<' + tagName + ' name="' + attributes.name + '">';
              delete attributes.name;
              return Element.writeAttribute(document.createElement(tagName), attributes);
            }
            if (!cache[tagName]) cache[tagName] = Element.extend(document.createElement(tagName));
            return Element.writeAttribute(cache[tagName].cloneNode(false), attributes);
          };
          Object.extend(global.Element, element || { });
          if (element) global.Element.prototype = element.prototype;
        })(this);
      
        Element.cache = { };
        Element.idCounter = 1;
      
        Element.Methods = {
          visible: function(element) {
            return $(element).style.display != 'none';
          },
      
          toggle: function(element) {
            element = $(element);
            Element[Element.visible(element) ? 'hide' : 'show'](element);
            return element;
          },
      
      
          hide: function(element) {
            element = $(element);
            element.style.display = 'none';
            return element;
          },
      
          show: function(element) {
            element = $(element);
            element.style.display = '';
            return element;
          },
      
          remove: function(element) {
            element = $(element);
            element.parentNode.removeChild(element);
            return element;
          },
      
          update: (function(){
      
            var SELECT_ELEMENT_INNERHTML_BUGGY = (function(){
              var el = document.createElement("select"),
                  isBuggy = true;
              el.innerHTML = "<option value=\"test\">test</option>";
              if (el.options && el.options[0]) {
                isBuggy = el.options[0].nodeName.toUpperCase() !== "OPTION";
              }
              el = null;
              return isBuggy;
            })();
      
            var TABLE_ELEMENT_INNERHTML_BUGGY = (function(){
              try {
                var el = document.createElement("table");
                if (el && el.tBodies) {
                  el.innerHTML = "<tbody><tr><td>test</td></tr></tbody>";
                  var isBuggy = typeof el.tBodies[0] == "undefined";
                  el = null;
                  return isBuggy;
                }
              } catch (e) {
                return true;
              }
            })();
      
            var SCRIPT_ELEMENT_REJECTS_TEXTNODE_APPENDING = (function () {
              var s = document.createElement("script"),
                  isBuggy = false;
              try {
                s.appendChild(document.createTextNode(""));
                isBuggy = !s.firstChild ||
                  s.firstChild && s.firstChild.nodeType !== 3;
              } catch (e) {
                isBuggy = true;
              }
              s = null;
              return isBuggy;
            })();
      
            function update(element, content) {
              element = $(element);
      
              if (content && content.toElement)
                content = content.toElement();
      
              if (Object.isElement(content))
                return element.update().insert(content);
      
              content = Object.toHTML(content);
      
              var tagName = element.tagName.toUpperCase();
      
              if (tagName === 'SCRIPT' && SCRIPT_ELEMENT_REJECTS_TEXTNODE_APPENDING) {
                element.text = content;
                return element;
              }
      
              if (SELECT_ELEMENT_INNERHTML_BUGGY || TABLE_ELEMENT_INNERHTML_BUGGY) {
                if (tagName in Element._insertionTranslations.tags) {
                  while (element.firstChild) {
                    element.removeChild(element.firstChild);
                  }
                  Element._getContentFromAnonymousElement(tagName, content.stripScripts())
                    .each(function(node) {
                      element.appendChild(node)
                    });
                }
                else {
                  element.innerHTML = content.stripScripts();
                }
              }
              else {
                element.innerHTML = content.stripScripts();
              }
      
              content.evalScripts.bind(content).defer();
              return element;
            }
      
            return update;
          })(),
      
          replace: function(element, content) {
            element = $(element);
            if (content && content.toElement) content = content.toElement();
            else if (!Object.isElement(content)) {
              content = Object.toHTML(content);
              var range = element.ownerDocument.createRange();
              range.selectNode(element);
              content.evalScripts.bind(content).defer();
              content = range.createContextualFragment(content.stripScripts());
            }
            element.parentNode.replaceChild(content, element);
            return element;
          },
      
          insert: function(element, insertions) {
            element = $(element);
      
            if (Object.isString(insertions) || Object.isNumber(insertions) ||
                Object.isElement(insertions) || (insertions && (insertions.toElement || insertions.toHTML)))
                  insertions = {bottom:insertions};
      
            var content, insert, tagName, childNodes;
      
            for (var position in insertions) {
              content  = insertions[position];
              position = position.toLowerCase();
              insert = Element._insertionTranslations[position];
      
              if (content && content.toElement) content = content.toElement();
              if (Object.isElement(content)) {
                insert(element, content);
                continue;
              }
      
              content = Object.toHTML(content);
      
              tagName = ((position == 'before' || position == 'after')
                ? element.parentNode : element).tagName.toUpperCase();
      
              childNodes = Element._getContentFromAnonymousElement(tagName, content.stripScripts());
      
              if (position == 'top' || position == 'after') childNodes.reverse();
              childNodes.each(insert.curry(element));
      
              content.evalScripts.bind(content).defer();
            }
      
            return element;
          },
      
          wrap: function(element, wrapper, attributes) {
            element = $(element);
            if (Object.isElement(wrapper))
              $(wrapper).writeAttribute(attributes || { });
            else if (Object.isString(wrapper)) wrapper = new Element(wrapper, attributes);
            else wrapper = new Element('div', wrapper);
            if (element.parentNode)
              element.parentNode.replaceChild(wrapper, element);
            wrapper.appendChild(element);
            return wrapper;
          },
      
          inspect: function(element) {
            element = $(element);
            var result = '<' + element.tagName.toLowerCase();
            $H({'id': 'id', 'className': 'class'}).each(function(pair) {
              var property = pair.first(), attribute = pair.last();
              var value = (element[property] || '').toString();
              if (value) result += ' ' + attribute + '=' + value.inspect(true);
            });
            return result + '>';
          },
      
          recursivelyCollect: function(element, property) {
            element = $(element);
            var elements = [];
            while (element = element[property])
              if (element.nodeType == 1)
                elements.push(Element.extend(element));
            return elements;
          },
      
          ancestors: function(element) {
            return Element.recursivelyCollect(element, 'parentNode');
          },
      
          descendants: function(element) {
            return Element.select(element, "*");
          },
      
          firstDescendant: function(element) {
            element = $(element).firstChild;
            while (element && element.nodeType != 1) element = element.nextSibling;
            return $(element);
          },
      
          immediateDescendants: function(element) {
            if (!(element = $(element).firstChild)) return [];
            while (element && element.nodeType != 1) element = element.nextSibling;
            if (element) return [element].concat($(element).nextSiblings());
            return [];
          },
      
          previousSiblings: function(element) {
            return Element.recursivelyCollect(element, 'previousSibling');
          },
      
          nextSiblings: function(element) {
            return Element.recursivelyCollect(element, 'nextSibling');
          },
      
          siblings: function(element) {
            element = $(element);
            return Element.previousSiblings(element).reverse()
              .concat(Element.nextSiblings(element));
          },
      
          match: function(element, selector) {
            if (Object.isString(selector))
              selector = new Selector(selector);
            return selector.match($(element));
          },
      
          up: function(element, expression, index) {
            element = $(element);
            if (arguments.length == 1) return $(element.parentNode);
            var ancestors = Element.ancestors(element);
            return Object.isNumber(expression) ? ancestors[expression] :
              Selector.findElement(ancestors, expression, index);
          },
      
          down: function(element, expression, index) {
            element = $(element);
            if (arguments.length == 1) return Element.firstDescendant(element);
            return Object.isNumber(expression) ? Element.descendants(element)[expression] :
              Element.select(element, expression)[index || 0];
          },
      
          previous: function(element, expression, index) {
            element = $(element);
            if (arguments.length == 1) return $(Selector.handlers.previousElementSibling(element));
            var previousSiblings = Element.previousSiblings(element);
            return Object.isNumber(expression) ? previousSiblings[expression] :
              Selector.findElement(previousSiblings, expression, index);
          },
      
          next: function(element, expression, index) {
            element = $(element);
            if (arguments.length == 1) return $(Selector.handlers.nextElementSibling(element));
            var nextSiblings = Element.nextSiblings(element);
            return Object.isNumber(expression) ? nextSiblings[expression] :
              Selector.findElement(nextSiblings, expression, index);
          },
      
      
          select: function(element) {
            var args = Array.prototype.slice.call(arguments, 1);
            return Selector.findChildElements(element, args);
          },
      
          adjacent: function(element) {
            var args = Array.prototype.slice.call(arguments, 1);
            return Selector.findChildElements(element.parentNode, args).without(element);
          },
      
          identify: function(element) {
            element = $(element);
            var id = Element.readAttribute(element, 'id');
            if (id) return id;
            do { id = 'anonymous_element_' + Element.idCounter++ } while ($(id));
            Element.writeAttribute(element, 'id', id);
            return id;
          },
      
          readAttribute: function(element, name) {
            element = $(element);
            if (Prototype.Browser.IE) {
              var t = Element._attributeTranslations.read;
              if (t.values[name]) return t.values[name](element, name);
              if (t.names[name]) name = t.names[name];
              if (name.include(':')) {
                return (!element.attributes || !element.attributes[name]) ? null :
                 element.attributes[name].value;
              }
            }
            return element.getAttribute(name);
          },
      
          writeAttribute: function(element, name, value) {
            element = $(element);
            var attributes = { }, t = Element._attributeTranslations.write;
      
            if (typeof name == 'object') attributes = name;
            else attributes[name] = Object.isUndefined(value) ? true : value;
      
            for (var attr in attributes) {
              name = t.names[attr] || attr;
              value = attributes[attr];
              if (t.values[attr]) name = t.values[attr](element, value);
              if (value === false || value === null)
                element.removeAttribute(name);
              else if (value === true)
                element.setAttribute(name, name);
              else element.setAttribute(name, value);
            }
            return element;
          },
      
          getHeight: function(element) {
            return Element.getDimensions(element).height;
          },
      
          getWidth: function(element) {
            return Element.getDimensions(element).width;
          },
      
          classNames: function(element) {
            return new Element.ClassNames(element);
          },
      
          hasClassName: function(element, className) {
            if (!(element = $(element))) return;
            var elementClassName = element.className;
            return (elementClassName.length > 0 && (elementClassName == className ||
              new RegExp("(^|\\s)" + className + "(\\s|$)").test(elementClassName)));
          },
      
          addClassName: function(element, className) {
            if (!(element = $(element))) return;
            if (!Element.hasClassName(element, className))
              element.className += (element.className ? ' ' : '') + className;
            return element;
          },
      
          removeClassName: function(element, className) {
            if (!(element = $(element))) return;
            element.className = element.className.replace(
              new RegExp("(^|\\s+)" + className + "(\\s+|$)"), ' ').strip();
            return element;
          },
      
          toggleClassName: function(element, className) {
            if (!(element = $(element))) return;
            return Element[Element.hasClassName(element, className) ?
              'removeClassName' : 'addClassName'](element, className);
          },
      
          cleanWhitespace: function(element) {
            element = $(element);
            var node = element.firstChild;
            while (node) {
              var nextNode = node.nextSibling;
              if (node.nodeType == 3 && !/\S/.test(node.nodeValue))
                element.removeChild(node);
              node = nextNode;
            }
            return element;
          },
      
          empty: function(element) {
            return $(element).innerHTML.blank();
          },
      
          descendantOf: function(element, ancestor) {
            element = $(element), ancestor = $(ancestor);
      
            if (element.compareDocumentPosition)
              return (element.compareDocumentPosition(ancestor) & 8) === 8;
      
            if (ancestor.contains)
              return ancestor.contains(element) && ancestor !== element;
      
            while (element = element.parentNode)
              if (element == ancestor) return true;
      
            return false;
          },
      
          scrollTo: function(element) {
            element = $(element);
            var pos = Element.cumulativeOffset(element);
            window.scrollTo(pos[0], pos[1]);
            return element;
          },
      
          getStyle: function(element, style) {
            element = $(element);
            style = style == 'float' ? 'cssFloat' : style.camelize();
            var value = element.style[style];
            if (!value || value == 'auto') {
              var css = document.defaultView.getComputedStyle(element, null);
              value = css ? css[style] : null;
            }
            if (style == 'opacity') return value ? parseFloat(value) : 1.0;
            return value == 'auto' ? null : value;
          },
      
          getOpacity: function(element) {
            return $(element).getStyle('opacity');
          },
      
          setStyle: function(element, styles) {
            element = $(element);
            var elementStyle = element.style, match;
            if (Object.isString(styles)) {
              element.style.cssText += ';' + styles;
              return styles.include('opacity') ?
                element.setOpacity(styles.match(/opacity:\s*(\d?\.?\d*)/)[1]) : element;
            }
            for (var property in styles)
              if (property == 'opacity') element.setOpacity(styles[property]);
              else
                elementStyle[(property == 'float' || property == 'cssFloat') ?
                  (Object.isUndefined(elementStyle.styleFloat) ? 'cssFloat' : 'styleFloat') :
                    property] = styles[property];
      
            return element;
          },
      
          setOpacity: function(element, value) {
            element = $(element);
            element.style.opacity = (value == 1 || value === '') ? '' :
              (value < 0.00001) ? 0 : value;
            return element;
          },
      
          getDimensions: function(element) {
            element = $(element);
            var display = Element.getStyle(element, 'display');
            if (display != 'none' && display != null) // Safari bug
              return {width: element.offsetWidth, height: element.offsetHeight};
      
            var els = element.style;
            var originalVisibility = els.visibility;
            var originalPosition = els.position;
            var originalDisplay = els.display;
            els.visibility = 'hidden';
            if (originalPosition != 'fixed') // Switching fixed to absolute causes issues in Safari
              els.position = 'absolute';
            els.display = 'block';
            var originalWidth = element.clientWidth;
            var originalHeight = element.clientHeight;
            els.display = originalDisplay;
            els.position = originalPosition;
            els.visibility = originalVisibility;
            return {width: originalWidth, height: originalHeight};
          },
      
          makePositioned: function(element) {
            element = $(element);
            var pos = Element.getStyle(element, 'position');
            if (pos == 'static' || !pos) {
              element._madePositioned = true;
              element.style.position = 'relative';
              if (Prototype.Browser.Opera) {
                element.style.top = 0;
                element.style.left = 0;
              }
            }
            return element;
          },
      
          undoPositioned: function(element) {
            element = $(element);
            if (element._madePositioned) {
              element._madePositioned = undefined;
              element.style.position =
                element.style.top =
                element.style.left =
                element.style.bottom =
                element.style.right = '';
            }
            return element;
          },
      
          makeClipping: function(element) {
            element = $(element);
            if (element._overflow) return element;
            element._overflow = Element.getStyle(element, 'overflow') || 'auto';
            if (element._overflow !== 'hidden')
              element.style.overflow = 'hidden';
            return element;
          },
      
          undoClipping: function(element) {
            element = $(element);
            if (!element._overflow) return element;
            element.style.overflow = element._overflow == 'auto' ? '' : element._overflow;
            element._overflow = null;
            return element;
          },
      
          cumulativeOffset: function(element) {
            var valueT = 0, valueL = 0;
            do {
              valueT += element.offsetTop  || 0;
              valueL += element.offsetLeft || 0;
              element = element.offsetParent;
            } while (element);
            return Element._returnOffset(valueL, valueT);
          },
      
          positionedOffset: function(element) {
            var valueT = 0, valueL = 0;
            do {
              valueT += element.offsetTop  || 0;
              valueL += element.offsetLeft || 0;
              element = element.offsetParent;
              if (element) {
                if (element.tagName.toUpperCase() == 'BODY') break;
                var p = Element.getStyle(element, 'position');
                if (p !== 'static') break;
              }
            } while (element);
            return Element._returnOffset(valueL, valueT);
          },
      
          absolutize: function(element) {
            element = $(element);
            if (Element.getStyle(element, 'position') == 'absolute') return element;
      
            var offsets = Element.positionedOffset(element);
            var top     = offsets[1];
            var left    = offsets[0];
            var width   = element.clientWidth;
            var height  = element.clientHeight;
      
            element._originalLeft   = left - parseFloat(element.style.left  || 0);
            element._originalTop    = top  - parseFloat(element.style.top || 0);
            element._originalWidth  = element.style.width;
            element._originalHeight = element.style.height;
      
            element.style.position = 'absolute';
            element.style.top    = top + 'px';
            element.style.left   = left + 'px';
            element.style.width  = width + 'px';
            element.style.height = height + 'px';
            return element;
          },
      
          relativize: function(element) {
            element = $(element);
            if (Element.getStyle(element, 'position') == 'relative') return element;
      
            element.style.position = 'relative';
            var top  = parseFloat(element.style.top  || 0) - (element._originalTop || 0);
            var left = parseFloat(element.style.left || 0) - (element._originalLeft || 0);
      
            element.style.top    = top + 'px';
            element.style.left   = left + 'px';
            element.style.height = element._originalHeight;
            element.style.width  = element._originalWidth;
            return element;
          },
      
          cumulativeScrollOffset: function(element) {
            var valueT = 0, valueL = 0;
            do {
              valueT += element.scrollTop  || 0;
              valueL += element.scrollLeft || 0;
              element = element.parentNode;
            } while (element);
            return Element._returnOffset(valueL, valueT);
          },
      
          getOffsetParent: function(element) {
            if (element.offsetParent) return $(element.offsetParent);
            if (element == document.body) return $(element);
      
            while ((element = element.parentNode) && element != document.body)
              if (Element.getStyle(element, 'position') != 'static')
                return $(element);
      
            return $(document.body);
          },
      
          viewportOffset: function(forElement) {
            var valueT = 0, valueL = 0;
      
            var element = forElement;
            do {
              valueT += element.offsetTop  || 0;
              valueL += element.offsetLeft || 0;
      
              if (element.offsetParent == document.body &&
                Element.getStyle(element, 'position') == 'absolute') break;
      
            } while (element = element.offsetParent);
      
            element = forElement;
            do {
              if (!Prototype.Browser.Opera || (element.tagName && (element.tagName.toUpperCase() == 'BODY'))) {
                valueT -= element.scrollTop  || 0;
                valueL -= element.scrollLeft || 0;
              }
            } while (element = element.parentNode);
      
            return Element._returnOffset(valueL, valueT);
          },
      
          clonePosition: function(element, source) {
            var options = Object.extend({
              setLeft:    true,
              setTop:     true,
              setWidth:   true,
              setHeight:  true,
              offsetTop:  0,
              offsetLeft: 0
            }, arguments[2] || { });
      
            source = $(source);
            var p = Element.viewportOffset(source);
      
            element = $(element);
            var delta = [0, 0];
            var parent = null;
            if (Element.getStyle(element, 'position') == 'absolute') {
              parent = Element.getOffsetParent(element);
              delta = Element.viewportOffset(parent);
            }
      
            if (parent == document.body) {
              delta[0] -= document.body.offsetLeft;
              delta[1] -= document.body.offsetTop;
            }
      
            if (options.setLeft)   element.style.left  = (p[0] - delta[0] + options.offsetLeft) + 'px';
            if (options.setTop)    element.style.top   = (p[1] - delta[1] + options.offsetTop) + 'px';
            if (options.setWidth)  element.style.width = source.offsetWidth + 'px';
            if (options.setHeight) element.style.height = source.offsetHeight + 'px';
            return element;
          }
        };
      
        Object.extend(Element.Methods, {
          getElementsBySelector: Element.Methods.select,
      
          childElements: Element.Methods.immediateDescendants
        });
      
        Element._attributeTranslations = {
          write: {
            names: {
              className: 'class',
              htmlFor:   'for'
            },
            values: { }
          }
        };
      
        if (Prototype.Browser.Opera) {
          Element.Methods.getStyle = Element.Methods.getStyle.wrap(
            function(proceed, element, style) {
              switch (style) {
                case 'left': case 'top': case 'right': case 'bottom':
                  if (proceed(element, 'position') === 'static') return null;
                case 'height': case 'width':
                  if (!Element.visible(element)) return null;
      
                  var dim = parseInt(proceed(element, style), 10);
      
                  if (dim !== element['offset' + style.capitalize()])
                    return dim + 'px';
      
                  var properties;
                  if (style === 'height') {
                    properties = ['border-top-width', 'padding-top',
                     'padding-bottom', 'border-bottom-width'];
                  }
                  else {
                    properties = ['border-left-width', 'padding-left',
                     'padding-right', 'border-right-width'];
                  }
                  return properties.inject(dim, function(memo, property) {
                    var val = proceed(element, property);
                    return val === null ? memo : memo - parseInt(val, 10);
                  }) + 'px';
                default: return proceed(element, style);
              }
            }
          );
      
          Element.Methods.readAttribute = Element.Methods.readAttribute.wrap(
            function(proceed, element, attribute) {
              if (attribute === 'title') return element.title;
              return proceed(element, attribute);
            }
          );
        }
      
        else if (Prototype.Browser.IE) {
          Element.Methods.getOffsetParent = Element.Methods.getOffsetParent.wrap(
            function(proceed, element) {
              element = $(element);
              try { element.offsetParent }
              catch(e) { return $(document.body) }
              var position = element.getStyle('position');
              if (position !== 'static') return proceed(element);
              element.setStyle({ position: 'relative' });
              var value = proceed(element);
              element.setStyle({ position: position });
              return value;
            }
          );
      
          $w('positionedOffset viewportOffset').each(function(method) {
            Element.Methods[method] = Element.Methods[method].wrap(
              function(proceed, element) {
                element = $(element);
                try { element.offsetParent }
                catch(e) { return Element._returnOffset(0,0) }
                var position = element.getStyle('position');
                if (position !== 'static') return proceed(element);
                var offsetParent = element.getOffsetParent();
                if (offsetParent && offsetParent.getStyle('position') === 'fixed')
                  offsetParent.setStyle({ zoom: 1 });
                element.setStyle({ position: 'relative' });
                var value = proceed(element);
                element.setStyle({ position: position });
                return value;
              }
            );
          });
      
          Element.Methods.cumulativeOffset = Element.Methods.cumulativeOffset.wrap(
            function(proceed, element) {
              try { element.offsetParent }
              catch(e) { return Element._returnOffset(0,0) }
              return proceed(element);
            }
          );
      
          Element.Methods.getStyle = function(element, style) {
            element = $(element);
            style = (style == 'float' || style == 'cssFloat') ? 'styleFloat' : style.camelize();
            var value = element.style[style];
            if (!value && element.currentStyle) value = element.currentStyle[style];
      
            if (style == 'opacity') {
              if (value = (element.getStyle('filter') || '').match(/alpha\(opacity=(.*)\)/))
                if (value[1]) return parseFloat(value[1]) / 100;
              return 1.0;
            }
      
            if (value == 'auto') {
              if ((style == 'width' || style == 'height') && (element.getStyle('display') != 'none'))
                return element['offset' + style.capitalize()] + 'px';
              return null;
            }
            return value;
          };
      
          Element.Methods.setOpacity = function(element, value) {
            function stripAlpha(filter){
              return filter.replace(/alpha\([^\)]*\)/gi,'');
            }
            element = $(element);
            var currentStyle = element.currentStyle;
            if ((currentStyle && !currentStyle.hasLayout) ||
              (!currentStyle && element.style.zoom == 'normal'))
                element.style.zoom = 1;
      
            var filter = element.getStyle('filter'), style = element.style;
            if (value == 1 || value === '') {
              (filter = stripAlpha(filter)) ?
                style.filter = filter : style.removeAttribute('filter');
              return element;
            } else if (value < 0.00001) value = 0;
            style.filter = stripAlpha(filter) +
              'alpha(opacity=' + (value * 100) + ')';
            return element;
          };
      
          Element._attributeTranslations = (function(){
      
            var classProp = 'className';
            var forProp = 'for';
      
            var el = document.createElement('div');
      
            el.setAttribute(classProp, 'x');
      
            if (el.className !== 'x') {
              el.setAttribute('class', 'x');
              if (el.className === 'x') {
                classProp = 'class';
              }
            }
            el = null;
      
            el = document.createElement('label');
            el.setAttribute(forProp, 'x');
            if (el.htmlFor !== 'x') {
              el.setAttribute('htmlFor', 'x');
              if (el.htmlFor === 'x') {
                forProp = 'htmlFor';
              }
            }
            el = null;
      
            return {
              read: {
                names: {
                  'class':      classProp,
                  'className':  classProp,
                  'for':        forProp,
                  'htmlFor':    forProp
                },
                values: {
                  _getAttr: function(element, attribute) {
                    return element.getAttribute(attribute);
                  },
                  _getAttr2: function(element, attribute) {
                    return element.getAttribute(attribute, 2);
                  },
                  _getAttrNode: function(element, attribute) {
                    var node = element.getAttributeNode(attribute);
                    return node ? node.value : "";
                  },
                  _getEv: (function(){
      
                    var el = document.createElement('div');
                    el.onclick = Prototype.emptyFunction;
                    var value = el.getAttribute('onclick');
                    var f;
      
                    if (String(value).indexOf('{') > -1) {
                      f = function(element, attribute) {
                        attribute = element.getAttribute(attribute);
                        if (!attribute) return null;
                        attribute = attribute.toString();
                        attribute = attribute.split('{')[1];
                        attribute = attribute.split('}')[0];
                        return attribute.strip();
                      };
                    }
                    else if (value === '') {
                      f = function(element, attribute) {
                        attribute = element.getAttribute(attribute);
                        if (!attribute) return null;
                        return attribute.strip();
                      };
                    }
                    el = null;
                    return f;
                  })(),
                  _flag: function(element, attribute) {
                    return $(element).hasAttribute(attribute) ? attribute : null;
                  },
                  style: function(element) {
                    return element.style.cssText.toLowerCase();
                  },
                  title: function(element) {
                    return element.title;
                  }
                }
              }
            }
          })();
      
          Element._attributeTranslations.write = {
            names: Object.extend({
              cellpadding: 'cellPadding',
              cellspacing: 'cellSpacing'
            }, Element._attributeTranslations.read.names),
            values: {
              checked: function(element, value) {
                element.checked = !!value;
              },
      
              style: function(element, value) {
                element.style.cssText = value ? value : '';
              }
            }
          };
      
          Element._attributeTranslations.has = {};
      
          $w('colSpan rowSpan vAlign dateTime accessKey tabIndex ' +
              'encType maxLength readOnly longDesc frameBorder').each(function(attr) {
            Element._attributeTranslations.write.names[attr.toLowerCase()] = attr;
            Element._attributeTranslations.has[attr.toLowerCase()] = attr;
          });
      
          (function(v) {
            Object.extend(v, {
              href:        v._getAttr2,
              src:         v._getAttr2,
              type:        v._getAttr,
              action:      v._getAttrNode,
              disabled:    v._flag,
              checked:     v._flag,
              readonly:    v._flag,
              multiple:    v._flag,
              onload:      v._getEv,
              onunload:    v._getEv,
              onclick:     v._getEv,
              ondblclick:  v._getEv,
              onmousedown: v._getEv,
              onmouseup:   v._getEv,
              onmouseover: v._getEv,
              onmousemove: v._getEv,
              onmouseout:  v._getEv,
              onfocus:     v._getEv,
              onblur:      v._getEv,
              onkeypress:  v._getEv,
              onkeydown:   v._getEv,
              onkeyup:     v._getEv,
              onsubmit:    v._getEv,
              onreset:     v._getEv,
              onselect:    v._getEv,
              onchange:    v._getEv
            });
          })(Element._attributeTranslations.read.values);
      
          if (Prototype.BrowserFeatures.ElementExtensions) {
            (function() {
              function _descendants(element) {
                var nodes = element.getElementsByTagName('*'), results = [];
                for (var i = 0, node; node = nodes[i]; i++)
                  if (node.tagName !== "!") // Filter out comment nodes.
                    results.push(node);
                return results;
              }
      
              Element.Methods.down = function(element, expression, index) {
                element = $(element);
                if (arguments.length == 1) return element.firstDescendant();
                return Object.isNumber(expression) ? _descendants(element)[expression] :
                  Element.select(element, expression)[index || 0];
              }
            })();
          }
      
        }
      
        else if (Prototype.Browser.Gecko && /rv:1\.8\.0/.test(navigator.userAgent)) {
          Element.Methods.setOpacity = function(element, value) {
            element = $(element);
            element.style.opacity = (value == 1) ? 0.999999 :
              (value === '') ? '' : (value < 0.00001) ? 0 : value;
            return element;
          };
        }
      
        else if (Prototype.Browser.WebKit) {
          Element.Methods.setOpacity = function(element, value) {
            element = $(element);
            element.style.opacity = (value == 1 || value === '') ? '' :
              (value < 0.00001) ? 0 : value;
      
            if (value == 1)
              if(element.tagName.toUpperCase() == 'IMG' && element.width) {
                element.width++; element.width--;
              } else try {
                var n = document.createTextNode(' ');
                element.appendChild(n);
                element.removeChild(n);
              } catch (e) { }
      
            return element;
          };
      
          Element.Methods.cumulativeOffset = function(element) {
            var valueT = 0, valueL = 0;
            do {
              valueT += element.offsetTop  || 0;
              valueL += element.offsetLeft || 0;
              if (element.offsetParent == document.body)
                if (Element.getStyle(element, 'position') == 'absolute') break;
      
              element = element.offsetParent;
            } while (element);
      
            return Element._returnOffset(valueL, valueT);
          };
        }
      
        if ('outerHTML' in document.documentElement) {
          Element.Methods.replace = function(element, content) {
            element = $(element);
      
            if (content && content.toElement) content = content.toElement();
            if (Object.isElement(content)) {
              element.parentNode.replaceChild(content, element);
              return element;
            }
      
            content = Object.toHTML(content);
            var parent = element.parentNode, tagName = parent.tagName.toUpperCase();
      
            if (Element._insertionTranslations.tags[tagName]) {
              var nextSibling = element.next();
              var fragments = Element._getContentFromAnonymousElement(tagName, content.stripScripts());
              parent.removeChild(element);
              if (nextSibling)
                fragments.each(function(node) { parent.insertBefore(node, nextSibling) });
              else
                fragments.each(function(node) { parent.appendChild(node) });
            }
            else element.outerHTML = content.stripScripts();
      
            content.evalScripts.bind(content).defer();
            return element;
          };
        }
      
        Element._returnOffset = function(l, t) {
          var result = [l, t];
          result.left = l;
          result.top = t;
          return result;
        };
      
        Element._getContentFromAnonymousElement = function(tagName, html) {
          var div = new Element('div'), t = Element._insertionTranslations.tags[tagName];
          if (t) {
            div.innerHTML = t[0] + html + t[1];
            t[2].times(function() { div = div.firstChild });
          } else div.innerHTML = html;
          return $A(div.childNodes);
        };
      
        Element._insertionTranslations = {
          before: function(element, node) {
            element.parentNode.insertBefore(node, element);
          },
          top: function(element, node) {
            element.insertBefore(node, element.firstChild);
          },
          bottom: function(element, node) {
            element.appendChild(node);
          },
          after: function(element, node) {
            element.parentNode.insertBefore(node, element.nextSibling);
          },
          tags: {
            TABLE:  ['<table>',                '</table>',                   1],
            TBODY:  ['<table><tbody>',         '</tbody></table>',           2],
            TR:     ['<table><tbody><tr>',     '</tr></tbody></table>',      3],
            TD:     ['<table><tbody><tr><td>', '</td></tr></tbody></table>', 4],
            SELECT: ['<select>',               '</select>',                  1]
          }
        };
      
        (function() {
          var tags = Element._insertionTranslations.tags;
          Object.extend(tags, {
            THEAD: tags.TBODY,
            TFOOT: tags.TBODY,
            TH:    tags.TD
          });
        })();
      
        Element.Methods.Simulated = {
          hasAttribute: function(element, attribute) {
            attribute = Element._attributeTranslations.has[attribute] || attribute;
            var node = $(element).getAttributeNode(attribute);
            return !!(node && node.specified);
          }
        };
      
        Element.Methods.ByTag = { };
      
        Object.extend(Element, Element.Methods);
      
        (function(div) {
      
          if (!Prototype.BrowserFeatures.ElementExtensions && div['__proto__']) {
            window.HTMLElement = { };
            window.HTMLElement.prototype = div['__proto__'];
            Prototype.BrowserFeatures.ElementExtensions = true;
          }
      
          div = null;
      
        })(document.createElement('div'))
      
        Element.extend = (function() {
      
          function checkDeficiency(tagName) {
            if (typeof window.Element != 'undefined') {
              var proto = window.Element.prototype;
              if (proto) {
                var id = '_' + (Math.random()+'').slice(2);
                var el = document.createElement(tagName);
                proto[id] = 'x';
                var isBuggy = (el[id] !== 'x');
                delete proto[id];
                el = null;
                return isBuggy;
              }
            }
            return false;
          }
      
          function extendElementWith(element, methods) {
            for (var property in methods) {
              var value = methods[property];
              if (Object.isFunction(value) && !(property in element))
                element[property] = value.methodize();
            }
          }
      
          var HTMLOBJECTELEMENT_PROTOTYPE_BUGGY = checkDeficiency('object');
      
          if (Prototype.BrowserFeatures.SpecificElementExtensions) {
            if (HTMLOBJECTELEMENT_PROTOTYPE_BUGGY) {
              return function(element) {
                if (element && typeof element._extendedByPrototype == 'undefined') {
                  var t = element.tagName;
                  if (t && (/^(?:object|applet|embed)$/i.test(t))) {
                    extendElementWith(element, Element.Methods);
                    extendElementWith(element, Element.Methods.Simulated);
                    extendElementWith(element, Element.Methods.ByTag[t.toUpperCase()]);
                  }
                }
                return element;
              }
            }
            return Prototype.K;
          }
      
          var Methods = { }, ByTag = Element.Methods.ByTag;
      
          var extend = Object.extend(function(element) {
            if (!element || typeof element._extendedByPrototype != 'undefined' ||
                element.nodeType != 1 || element == window) return element;
      
            var methods = Object.clone(Methods),
                tagName = element.tagName.toUpperCase();
      
            if (ByTag[tagName]) Object.extend(methods, ByTag[tagName]);
      
            extendElementWith(element, methods);
      
            element._extendedByPrototype = Prototype.emptyFunction;
            return element;
      
          }, {
            refresh: function() {
              if (!Prototype.BrowserFeatures.ElementExtensions) {
                Object.extend(Methods, Element.Methods);
                Object.extend(Methods, Element.Methods.Simulated);
              }
            }
          });
      
          extend.refresh();
          return extend;
        })();
      
        Element.hasAttribute = function(element, attribute) {
          if (element.hasAttribute) return element.hasAttribute(attribute);
          return Element.Methods.Simulated.hasAttribute(element, attribute);
        };
      
        Element.addMethods = function(methods) {
          var F = Prototype.BrowserFeatures, T = Element.Methods.ByTag;
      
          if (!methods) {
            Object.extend(Form, Form.Methods);
            Object.extend(Form.Element, Form.Element.Methods);
            Object.extend(Element.Methods.ByTag, {
              "FORM":     Object.clone(Form.Methods),
              "INPUT":    Object.clone(Form.Element.Methods),
              "SELECT":   Object.clone(Form.Element.Methods),
              "TEXTAREA": Object.clone(Form.Element.Methods)
            });
          }
      
          if (arguments.length == 2) {
            var tagName = methods;
            methods = arguments[1];
          }
      
          if (!tagName) Object.extend(Element.Methods, methods || { });
          else {
            if (Object.isArray(tagName)) tagName.each(extend);
            else extend(tagName);
          }
      
          function extend(tagName) {
            tagName = tagName.toUpperCase();
            if (!Element.Methods.ByTag[tagName])
              Element.Methods.ByTag[tagName] = { };
            Object.extend(Element.Methods.ByTag[tagName], methods);
          }
      
          function copy(methods, destination, onlyIfAbsent) {
            onlyIfAbsent = onlyIfAbsent || false;
            for (var property in methods) {
              var value = methods[property];
              if (!Object.isFunction(value)) continue;
              if (!onlyIfAbsent || !(property in destination))
                destination[property] = value.methodize();
            }
          }
      
          function findDOMClass(tagName) {
            var klass;
            var trans = {
              "OPTGROUP": "OptGroup", "TEXTAREA": "TextArea", "P": "Paragraph",
              "FIELDSET": "FieldSet", "UL": "UList", "OL": "OList", "DL": "DList",
              "DIR": "Directory", "H1": "Heading", "H2": "Heading", "H3": "Heading",
              "H4": "Heading", "H5": "Heading", "H6": "Heading", "Q": "Quote",
              "INS": "Mod", "DEL": "Mod", "A": "Anchor", "IMG": "Image", "CAPTION":
              "TableCaption", "COL": "TableCol", "COLGROUP": "TableCol", "THEAD":
              "TableSection", "TFOOT": "TableSection", "TBODY": "TableSection", "TR":
              "TableRow", "TH": "TableCell", "TD": "TableCell", "FRAMESET":
              "FrameSet", "IFRAME": "IFrame"
            };
            if (trans[tagName]) klass = 'HTML' + trans[tagName] + 'Element';
            if (window[klass]) return window[klass];
            klass = 'HTML' + tagName + 'Element';
            if (window[klass]) return window[klass];
            klass = 'HTML' + tagName.capitalize() + 'Element';
            if (window[klass]) return window[klass];
      
            var element = document.createElement(tagName);
            var proto = element['__proto__'] || element.constructor.prototype;
            element = null;
            return proto;
          }
      
          var elementPrototype = window.HTMLElement ? HTMLElement.prototype :
           Element.prototype;
      
          if (F.ElementExtensions) {
            copy(Element.Methods, elementPrototype);
            copy(Element.Methods.Simulated, elementPrototype, true);
          }
      
          if (F.SpecificElementExtensions) {
            for (var tag in Element.Methods.ByTag) {
              var klass = findDOMClass(tag);
              if (Object.isUndefined(klass)) continue;
              copy(T[tag], klass.prototype);
            }
          }
      
          Object.extend(Element, Element.Methods);
          delete Element.ByTag;
      
          if (Element.extend.refresh) Element.extend.refresh();
          Element.cache = { };
        };
      
      
        document.viewport = {
      
          getDimensions: function() {
            return { width: this.getWidth(), height: this.getHeight() };
          },
      
          getScrollOffsets: function() {
            return Element._returnOffset(
              window.pageXOffset || document.documentElement.scrollLeft || document.body.scrollLeft,
              window.pageYOffset || document.documentElement.scrollTop  || document.body.scrollTop);
          }
        };
      
        (function(viewport) {
          var B = Prototype.Browser, doc = document, element, property = {};
      
          function getRootElement() {
            if (B.WebKit && !doc.evaluate)
              return document;
      
            if (B.Opera && window.parseFloat(window.opera.version()) < 9.5)
              return document.body;
      
            return document.documentElement;
          }
      
          function define(D) {
            if (!element) element = getRootElement();
      
            property[D] = 'client' + D;
      
            viewport['get' + D] = function() { return element[property[D]] };
            return viewport['get' + D]();
          }
      
          viewport.getWidth  = define.curry('Width');
      
          viewport.getHeight = define.curry('Height');
        })(document.viewport);
      
      
        Element.Storage = {
          UID: 1
        };
      
        Element.addMethods({
          getStorage: function(element) {
            if (!(element = $(element))) return;
      
            var uid;
            if (element === window) {
              uid = 0;
            } else {
              if (typeof element._prototypeUID === "undefined")
                element._prototypeUID = [Element.Storage.UID++];
              uid = element._prototypeUID[0];
            }
      
            if (!Element.Storage[uid])
              Element.Storage[uid] = $H();
      
            return Element.Storage[uid];
          },
      
          store: function(element, key, value) {
            if (!(element = $(element))) return;
      
            if (arguments.length === 2) {
              Element.getStorage(element).update(key);
            } else {
              Element.getStorage(element).set(key, value);
            }
      
            return element;
          },
      
          retrieve: function(element, key, defaultValue) {
            if (!(element = $(element))) return;
            var hash = Element.getStorage(element), value = hash.get(key);
      
            if (Object.isUndefined(value)) {
              hash.set(key, defaultValue);
              value = defaultValue;
            }
      
            return value;
          },
      
          clone: function(element, deep) {
            if (!(element = $(element))) return;
            var clone = element.cloneNode(deep);
            clone._prototypeUID = void 0;
            if (deep) {
              var descendants = Element.select(clone, '*'),
                  i = descendants.length;
              while (i--) {
                descendants[i]._prototypeUID = void 0;
              }
            }
            return Element.extend(clone);
          }
        });
        /* Portions of the Selector class are derived from Jack Slocum's DomQuery,
         * part of YUI-Ext version 0.40, distributed under the terms of an MIT-style
         * license.  Please see http://www.yui-ext.com/ for more information. */
      
        var Selector = Class.create({
          initialize: function(expression) {
            this.expression = expression.strip();
      
            if (this.shouldUseSelectorsAPI()) {
              this.mode = 'selectorsAPI';
            } else if (this.shouldUseXPath()) {
              this.mode = 'xpath';
              this.compileXPathMatcher();
            } else {
              this.mode = "normal";
              this.compileMatcher();
            }
      
          },
      
          shouldUseXPath: (function() {
      
            var IS_DESCENDANT_SELECTOR_BUGGY = (function(){
              var isBuggy = false;
              if (document.evaluate && window.XPathResult) {
                var el = document.createElement('div');
                el.innerHTML = '<ul><li></li></ul><div><ul><li></li></ul></div>';
      
                var xpath = ".//*[local-name()='ul' or local-name()='UL']" +
                  "//*[local-name()='li' or local-name()='LI']";
      
                var result = document.evaluate(xpath, el, null,
                  XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
      
                isBuggy = (result.snapshotLength !== 2);
                el = null;
              }
              return isBuggy;
            })();
      
            return function() {
              if (!Prototype.BrowserFeatures.XPath) return false;
      
              var e = this.expression;
      
              if (Prototype.Browser.WebKit &&
               (e.include("-of-type") || e.include(":empty")))
                return false;
      
              if ((/(\[[\w-]*?:|:checked)/).test(e))
                return false;
      
              if (IS_DESCENDANT_SELECTOR_BUGGY) return false;
      
              return true;
            }
      
          })(),
      
          shouldUseSelectorsAPI: function() {
            if (!Prototype.BrowserFeatures.SelectorsAPI) return false;
      
            if (Selector.CASE_INSENSITIVE_CLASS_NAMES) return false;
      
            if (!Selector._div) Selector._div = new Element('div');
      
            try {
              Selector._div.querySelector(this.expression);
            } catch(e) {
              return false;
            }
      
            return true;
          },
      
          compileMatcher: function() {
            var e = this.expression, ps = Selector.patterns, h = Selector.handlers,
                c = Selector.criteria, le, p, m, len = ps.length, name;
      
            if (Selector._cache[e]) {
              this.matcher = Selector._cache[e];
              return;
            }
      
            this.matcher = ["this.matcher = function(root) {",
                            "var r = root, h = Selector.handlers, c = false, n;"];
      
            while (e && le != e && (/\S/).test(e)) {
              le = e;
              for (var i = 0; i<len; i++) {
                p = ps[i].re;
                name = ps[i].name;
                if (m = e.match(p)) {
                  this.matcher.push(Object.isFunction(c[name]) ? c[name](m) :
                    new Template(c[name]).evaluate(m));
                  e = e.replace(m[0], '');
                  break;
                }
              }
            }
      
            this.matcher.push("return h.unique(n);\n}");
            eval(this.matcher.join('\n'));
            Selector._cache[this.expression] = this.matcher;
          },
      
          compileXPathMatcher: function() {
            var e = this.expression, ps = Selector.patterns,
                x = Selector.xpath, le, m, len = ps.length, name;
      
            if (Selector._cache[e]) {
              this.xpath = Selector._cache[e]; return;
            }
      
            this.matcher = ['.//*'];
            while (e && le != e && (/\S/).test(e)) {
              le = e;
              for (var i = 0; i<len; i++) {
                name = ps[i].name;
                if (m = e.match(ps[i].re)) {
                  this.matcher.push(Object.isFunction(x[name]) ? x[name](m) :
                    new Template(x[name]).evaluate(m));
                  e = e.replace(m[0], '');
                  break;
                }
              }
            }
      
            this.xpath = this.matcher.join('');
            Selector._cache[this.expression] = this.xpath;
          },
      
          findElements: function(root) {
            root = root || document;
            var e = this.expression, results;
      
            switch (this.mode) {
              case 'selectorsAPI':
                if (root !== document) {
                  var oldId = root.id, id = $(root).identify();
                  id = id.replace(/([\.:])/g, "\\$1");
                  e = "#" + id + " " + e;
                }
      
                results = $A(root.querySelectorAll(e)).map(Element.extend);
                root.id = oldId;
      
                return results;
              case 'xpath':
                return document._getElementsByXPath(this.xpath, root);
              default:
               return this.matcher(root);
            }
          },
      
          match: function(element) {
            this.tokens = [];
      
            var e = this.expression, ps = Selector.patterns, as = Selector.assertions;
            var le, p, m, len = ps.length, name;
      
            while (e && le !== e && (/\S/).test(e)) {
              le = e;
              for (var i = 0; i<len; i++) {
                p = ps[i].re;
                name = ps[i].name;
                if (m = e.match(p)) {
                  if (as[name]) {
                    this.tokens.push([name, Object.clone(m)]);
                    e = e.replace(m[0], '');
                  } else {
                    return this.findElements(document).include(element);
                  }
                }
              }
            }
      
            var match = true, name, matches;
            for (var i = 0, token; token = this.tokens[i]; i++) {
              name = token[0], matches = token[1];
              if (!Selector.assertions[name](element, matches)) {
                match = false; break;
              }
            }
      
            return match;
          },
      
          toString: function() {
            return this.expression;
          },
      
          inspect: function() {
            return "#<Selector:" + this.expression.inspect() + ">";
          }
        });
      
        if (Prototype.BrowserFeatures.SelectorsAPI &&
         document.compatMode === 'BackCompat') {
          Selector.CASE_INSENSITIVE_CLASS_NAMES = (function(){
            var div = document.createElement('div'),
             span = document.createElement('span');
      
            div.id = "prototype_test_id";
            span.className = 'Test';
            div.appendChild(span);
            var isIgnored = (div.querySelector('#prototype_test_id .test') !== null);
            div = span = null;
            return isIgnored;
          })();
        }
      
        Object.extend(Selector, {
          _cache: { },
      
          xpath: {
            descendant:   "//*",
            child:        "/*",
            adjacent:     "/following-sibling::*[1]",
            laterSibling: '/following-sibling::*',
            tagName:      function(m) {
              if (m[1] == '*') return '';
              return "[local-name()='" + m[1].toLowerCase() +
                     "' or local-name()='" + m[1].toUpperCase() + "']";
            },
            className:    "[contains(concat(' ', @class, ' '), ' #{1} ')]",
            id:           "[@id='#{1}']",
            attrPresence: function(m) {
              m[1] = m[1].toLowerCase();
              return new Template("[@#{1}]").evaluate(m);
            },
            attr: function(m) {
              m[1] = m[1].toLowerCase();
              m[3] = m[5] || m[6];
              return new Template(Selector.xpath.operators[m[2]]).evaluate(m);
            },
            pseudo: function(m) {
              var h = Selector.xpath.pseudos[m[1]];
              if (!h) return '';
              if (Object.isFunction(h)) return h(m);
              return new Template(Selector.xpath.pseudos[m[1]]).evaluate(m);
            },
            operators: {
              '=':  "[@#{1}='#{3}']",
              '!=': "[@#{1}!='#{3}']",
              '^=': "[starts-with(@#{1}, '#{3}')]",
              '$=': "[substring(@#{1}, (string-length(@#{1}) - string-length('#{3}') + 1))='#{3}']",
              '*=': "[contains(@#{1}, '#{3}')]",
              '~=': "[contains(concat(' ', @#{1}, ' '), ' #{3} ')]",
              '|=': "[contains(concat('-', @#{1}, '-'), '-#{3}-')]"
            },
            pseudos: {
              'first-child': '[not(preceding-sibling::*)]',
              'last-child':  '[not(following-sibling::*)]',
              'only-child':  '[not(preceding-sibling::* or following-sibling::*)]',
              'empty':       "[count(*) = 0 and (count(text()) = 0)]",
              'checked':     "[@checked]",
              'disabled':    "[(@disabled) and (@type!='hidden')]",
              'enabled':     "[not(@disabled) and (@type!='hidden')]",
              'not': function(m) {
                var e = m[6], p = Selector.patterns,
                    x = Selector.xpath, le, v, len = p.length, name;
      
                var exclusion = [];
                while (e && le != e && (/\S/).test(e)) {
                  le = e;
                  for (var i = 0; i<len; i++) {
                    name = p[i].name
                    if (m = e.match(p[i].re)) {
                      v = Object.isFunction(x[name]) ? x[name](m) : new Template(x[name]).evaluate(m);
                      exclusion.push("(" + v.substring(1, v.length - 1) + ")");
                      e = e.replace(m[0], '');
                      break;
                    }
                  }
                }
                return "[not(" + exclusion.join(" and ") + ")]";
              },
              'nth-child':      function(m) {
                return Selector.xpath.pseudos.nth("(count(./preceding-sibling::*) + 1) ", m);
              },
              'nth-last-child': function(m) {
                return Selector.xpath.pseudos.nth("(count(./following-sibling::*) + 1) ", m);
              },
              'nth-of-type':    function(m) {
                return Selector.xpath.pseudos.nth("position() ", m);
              },
              'nth-last-of-type': function(m) {
                return Selector.xpath.pseudos.nth("(last() + 1 - position()) ", m);
              },
              'first-of-type':  function(m) {
                m[6] = "1"; return Selector.xpath.pseudos['nth-of-type'](m);
              },
              'last-of-type':   function(m) {
                m[6] = "1"; return Selector.xpath.pseudos['nth-last-of-type'](m);
              },
              'only-of-type':   function(m) {
                var p = Selector.xpath.pseudos; return p['first-of-type'](m) + p['last-of-type'](m);
              },
              nth: function(fragment, m) {
                var mm, formula = m[6], predicate;
                if (formula == 'even') formula = '2n+0';
                if (formula == 'odd')  formula = '2n+1';
                if (mm = formula.match(/^(\d+)$/)) // digit only
                  return '[' + fragment + "= " + mm[1] + ']';
                if (mm = formula.match(/^(-?\d*)?n(([+-])(\d+))?/)) { // an+b
                  if (mm[1] == "-") mm[1] = -1;
                  var a = mm[1] ? Number(mm[1]) : 1;
                  var b = mm[2] ? Number(mm[2]) : 0;
                  predicate = "[((#{fragment} - #{b}) mod #{a} = 0) and " +
                  "((#{fragment} - #{b}) div #{a} >= 0)]";
                  return new Template(predicate).evaluate({
                    fragment: fragment, a: a, b: b });
                }
              }
            }
          },
      
          criteria: {
            tagName:      'n = h.tagName(n, r, "#{1}", c);      c = false;',
            className:    'n = h.className(n, r, "#{1}", c);    c = false;',
            id:           'n = h.id(n, r, "#{1}", c);           c = false;',
            attrPresence: 'n = h.attrPresence(n, r, "#{1}", c); c = false;',
            attr: function(m) {
              m[3] = (m[5] || m[6]);
              return new Template('n = h.attr(n, r, "#{1}", "#{3}", "#{2}", c); c = false;').evaluate(m);
            },
            pseudo: function(m) {
              if (m[6]) m[6] = m[6].replace(/"/g, '\\"');
              return new Template('n = h.pseudo(n, "#{1}", "#{6}", r, c); c = false;').evaluate(m);
            },
            descendant:   'c = "descendant";',
            child:        'c = "child";',
            adjacent:     'c = "adjacent";',
            laterSibling: 'c = "laterSibling";'
          },
      
          patterns: [
            { name: 'laterSibling', re: /^\s*~\s*/ },
            { name: 'child',        re: /^\s*>\s*/ },
            { name: 'adjacent',     re: /^\s*\+\s*/ },
            { name: 'descendant',   re: /^\s/ },
      
            { name: 'tagName',      re: /^\s*(\*|[\w\-]+)(\b|$)?/ },
            { name: 'id',           re: /^#([\w\-\*]+)(\b|$)/ },
            { name: 'className',    re: /^\.([\w\-\*]+)(\b|$)/ },
            { name: 'pseudo',       re: /^:((first|last|nth|nth-last|only)(-child|-of-type)|empty|checked|(en|dis)abled|not)(\((.*?)\))?(\b|$|(?=\s|[:+~>]))/ },
            { name: 'attrPresence', re: /^\[((?:[\w-]+:)?[\w-]+)\]/ },
            { name: 'attr',         re: /\[((?:[\w-]*:)?[\w-]+)\s*(?:([!^$*~|]?=)\s*((['"])([^\4]*?)\4|([^'"][^\]]*?)))?\]/ }
          ],
      
          assertions: {
            tagName: function(element, matches) {
              return matches[1].toUpperCase() == element.tagName.toUpperCase();
            },
      
            className: function(element, matches) {
              return Element.hasClassName(element, matches[1]);
            },
      
            id: function(element, matches) {
              return element.id === matches[1];
            },
      
            attrPresence: function(element, matches) {
              return Element.hasAttribute(element, matches[1]);
            },
      
            attr: function(element, matches) {
              var nodeValue = Element.readAttribute(element, matches[1]);
              return nodeValue && Selector.operators[matches[2]](nodeValue, matches[5] || matches[6]);
            }
          },
      
          handlers: {
            concat: function(a, b) {
              for (var i = 0, node; node = b[i]; i++)
                a.push(node);
              return a;
            },
      
            mark: function(nodes) {
              var _true = Prototype.emptyFunction;
              for (var i = 0, node; node = nodes[i]; i++)
                node._countedByPrototype = _true;
              return nodes;
            },
      
            unmark: (function(){
      
              var PROPERTIES_ATTRIBUTES_MAP = (function(){
                var el = document.createElement('div'),
                    isBuggy = false,
                    propName = '_countedByPrototype',
                    value = 'x'
                el[propName] = value;
                isBuggy = (el.getAttribute(propName) === value);
                el = null;
                return isBuggy;
              })();
      
              return PROPERTIES_ATTRIBUTES_MAP ?
                function(nodes) {
                  for (var i = 0, node; node = nodes[i]; i++)
                    node.removeAttribute('_countedByPrototype');
                  return nodes;
                } :
                function(nodes) {
                  for (var i = 0, node; node = nodes[i]; i++)
                    node._countedByPrototype = void 0;
                  return nodes;
                }
            })(),
      
            index: function(parentNode, reverse, ofType) {
              parentNode._countedByPrototype = Prototype.emptyFunction;
              if (reverse) {
                for (var nodes = parentNode.childNodes, i = nodes.length - 1, j = 1; i >= 0; i--) {
                  var node = nodes[i];
                  if (node.nodeType == 1 && (!ofType || node._countedByPrototype)) node.nodeIndex = j++;
                }
              } else {
                for (var i = 0, j = 1, nodes = parentNode.childNodes; node = nodes[i]; i++)
                  if (node.nodeType == 1 && (!ofType || node._countedByPrototype)) node.nodeIndex = j++;
              }
            },
      
            unique: function(nodes) {
              if (nodes.length == 0) return nodes;
              var results = [], n;
              for (var i = 0, l = nodes.length; i < l; i++)
                if (typeof (n = nodes[i])._countedByPrototype == 'undefined') {
                  n._countedByPrototype = Prototype.emptyFunction;
                  results.push(Element.extend(n));
                }
              return Selector.handlers.unmark(results);
            },
      
            descendant: function(nodes) {
              var h = Selector.handlers;
              for (var i = 0, results = [], node; node = nodes[i]; i++)
                h.concat(results, node.getElementsByTagName('*'));
              return results;
            },
      
            child: function(nodes) {
              var h = Selector.handlers;
              for (var i = 0, results = [], node; node = nodes[i]; i++) {
                for (var j = 0, child; child = node.childNodes[j]; j++)
                  if (child.nodeType == 1 && child.tagName != '!') results.push(child);
              }
              return results;
            },
      
            adjacent: function(nodes) {
              for (var i = 0, results = [], node; node = nodes[i]; i++) {
                var next = this.nextElementSibling(node);
                if (next) results.push(next);
              }
              return results;
            },
      
            laterSibling: function(nodes) {
              var h = Selector.handlers;
              for (var i = 0, results = [], node; node = nodes[i]; i++)
                h.concat(results, Element.nextSiblings(node));
              return results;
            },
      
            nextElementSibling: function(node) {
              while (node = node.nextSibling)
                if (node.nodeType == 1) return node;
              return null;
            },
      
            previousElementSibling: function(node) {
              while (node = node.previousSibling)
                if (node.nodeType == 1) return node;
              return null;
            },
      
            tagName: function(nodes, root, tagName, combinator) {
              var uTagName = tagName.toUpperCase();
              var results = [], h = Selector.handlers;
              if (nodes) {
                if (combinator) {
                  if (combinator == "descendant") {
                    for (var i = 0, node; node = nodes[i]; i++)
                      h.concat(results, node.getElementsByTagName(tagName));
                    return results;
                  } else nodes = this[combinator](nodes);
                  if (tagName == "*") return nodes;
                }
                for (var i = 0, node; node = nodes[i]; i++)
                  if (node.tagName.toUpperCase() === uTagName) results.push(node);
                return results;
              } else return root.getElementsByTagName(tagName);
            },
      
            id: function(nodes, root, id, combinator) {
              var targetNode = $(id), h = Selector.handlers;
      
              if (root == document) {
                if (!targetNode) return [];
                if (!nodes) return [targetNode];
              } else {
                if (!root.sourceIndex || root.sourceIndex < 1) {
                  var nodes = root.getElementsByTagName('*');
                  for (var j = 0, node; node = nodes[j]; j++) {
                    if (node.id === id) return [node];
                  }
                }
              }
      
              if (nodes) {
                if (combinator) {
                  if (combinator == 'child') {
                    for (var i = 0, node; node = nodes[i]; i++)
                      if (targetNode.parentNode == node) return [targetNode];
                  } else if (combinator == 'descendant') {
                    for (var i = 0, node; node = nodes[i]; i++)
                      if (Element.descendantOf(targetNode, node)) return [targetNode];
                  } else if (combinator == 'adjacent') {
                    for (var i = 0, node; node = nodes[i]; i++)
                      if (Selector.handlers.previousElementSibling(targetNode) == node)
                        return [targetNode];
                  } else nodes = h[combinator](nodes);
                }
                for (var i = 0, node; node = nodes[i]; i++)
                  if (node == targetNode) return [targetNode];
                return [];
              }
              return (targetNode && Element.descendantOf(targetNode, root)) ? [targetNode] : [];
            },
      
            className: function(nodes, root, className, combinator) {
              if (nodes && combinator) nodes = this[combinator](nodes);
              return Selector.handlers.byClassName(nodes, root, className);
            },
      
            byClassName: function(nodes, root, className) {
              if (!nodes) nodes = Selector.handlers.descendant([root]);
              var needle = ' ' + className + ' ';
              for (var i = 0, results = [], node, nodeClassName; node = nodes[i]; i++) {
                nodeClassName = node.className;
                if (nodeClassName.length == 0) continue;
                if (nodeClassName == className || (' ' + nodeClassName + ' ').include(needle))
                  results.push(node);
              }
              return results;
            },
      
            attrPresence: function(nodes, root, attr, combinator) {
              if (!nodes) nodes = root.getElementsByTagName("*");
              if (nodes && combinator) nodes = this[combinator](nodes);
              var results = [];
              for (var i = 0, node; node = nodes[i]; i++)
                if (Element.hasAttribute(node, attr)) results.push(node);
              return results;
            },
      
            attr: function(nodes, root, attr, value, operator, combinator) {
              if (!nodes) nodes = root.getElementsByTagName("*");
              if (nodes && combinator) nodes = this[combinator](nodes);
              var handler = Selector.operators[operator], results = [];
              for (var i = 0, node; node = nodes[i]; i++) {
                var nodeValue = Element.readAttribute(node, attr);
                if (nodeValue === null) continue;
                if (handler(nodeValue, value)) results.push(node);
              }
              return results;
            },
      
            pseudo: function(nodes, name, value, root, combinator) {
              if (nodes && combinator) nodes = this[combinator](nodes);
              if (!nodes) nodes = root.getElementsByTagName("*");
              return Selector.pseudos[name](nodes, value, root);
            }
          },
      
          pseudos: {
            'first-child': function(nodes, value, root) {
              for (var i = 0, results = [], node; node = nodes[i]; i++) {
                if (Selector.handlers.previousElementSibling(node)) continue;
                  results.push(node);
              }
              return results;
            },
            'last-child': function(nodes, value, root) {
              for (var i = 0, results = [], node; node = nodes[i]; i++) {
                if (Selector.handlers.nextElementSibling(node)) continue;
                  results.push(node);
              }
              return results;
            },
            'only-child': function(nodes, value, root) {
              var h = Selector.handlers;
              for (var i = 0, results = [], node; node = nodes[i]; i++)
                if (!h.previousElementSibling(node) && !h.nextElementSibling(node))
                  results.push(node);
              return results;
            },
            'nth-child':        function(nodes, formula, root) {
              return Selector.pseudos.nth(nodes, formula, root);
            },
            'nth-last-child':   function(nodes, formula, root) {
              return Selector.pseudos.nth(nodes, formula, root, true);
            },
            'nth-of-type':      function(nodes, formula, root) {
              return Selector.pseudos.nth(nodes, formula, root, false, true);
            },
            'nth-last-of-type': function(nodes, formula, root) {
              return Selector.pseudos.nth(nodes, formula, root, true, true);
            },
            'first-of-type':    function(nodes, formula, root) {
              return Selector.pseudos.nth(nodes, "1", root, false, true);
            },
            'last-of-type':     function(nodes, formula, root) {
              return Selector.pseudos.nth(nodes, "1", root, true, true);
            },
            'only-of-type':     function(nodes, formula, root) {
              var p = Selector.pseudos;
              return p['last-of-type'](p['first-of-type'](nodes, formula, root), formula, root);
            },
      
            getIndices: function(a, b, total) {
              if (a == 0) return b > 0 ? [b] : [];
              return $R(1, total).inject([], function(memo, i) {
                if (0 == (i - b) % a && (i - b) / a >= 0) memo.push(i);
                return memo;
              });
            },
      
            nth: function(nodes, formula, root, reverse, ofType) {
              if (nodes.length == 0) return [];
              if (formula == 'even') formula = '2n+0';
              if (formula == 'odd')  formula = '2n+1';
              var h = Selector.handlers, results = [], indexed = [], m;
              h.mark(nodes);
              for (var i = 0, node; node = nodes[i]; i++) {
                if (!node.parentNode._countedByPrototype) {
                  h.index(node.parentNode, reverse, ofType);
                  indexed.push(node.parentNode);
                }
              }
              if (formula.match(/^\d+$/)) { // just a number
                formula = Number(formula);
                for (var i = 0, node; node = nodes[i]; i++)
                  if (node.nodeIndex == formula) results.push(node);
              } else if (m = formula.match(/^(-?\d*)?n(([+-])(\d+))?/)) { // an+b
                if (m[1] == "-") m[1] = -1;
                var a = m[1] ? Number(m[1]) : 1;
                var b = m[2] ? Number(m[2]) : 0;
                var indices = Selector.pseudos.getIndices(a, b, nodes.length);
                for (var i = 0, node, l = indices.length; node = nodes[i]; i++) {
                  for (var j = 0; j < l; j++)
                    if (node.nodeIndex == indices[j]) results.push(node);
                }
              }
              h.unmark(nodes);
              h.unmark(indexed);
              return results;
            },
      
            'empty': function(nodes, value, root) {
              for (var i = 0, results = [], node; node = nodes[i]; i++) {
                if (node.tagName == '!' || node.firstChild) continue;
                results.push(node);
              }
              return results;
            },
      
            'not': function(nodes, selector, root) {
              var h = Selector.handlers, selectorType, m;
              var exclusions = new Selector(selector).findElements(root);
              h.mark(exclusions);
              for (var i = 0, results = [], node; node = nodes[i]; i++)
                if (!node._countedByPrototype) results.push(node);
              h.unmark(exclusions);
              return results;
            },
      
            'enabled': function(nodes, value, root) {
              for (var i = 0, results = [], node; node = nodes[i]; i++)
                if (!node.disabled && (!node.type || node.type !== 'hidden'))
                  results.push(node);
              return results;
            },
      
            'disabled': function(nodes, value, root) {
              for (var i = 0, results = [], node; node = nodes[i]; i++)
                if (node.disabled) results.push(node);
              return results;
            },
      
            'checked': function(nodes, value, root) {
              for (var i = 0, results = [], node; node = nodes[i]; i++)
                if (node.checked) results.push(node);
              return results;
            }
          },
      
          operators: {
            '=':  function(nv, v) { return nv == v; },
            '!=': function(nv, v) { return nv != v; },
            '^=': function(nv, v) { return nv == v || nv && nv.startsWith(v); },
            '$=': function(nv, v) { return nv == v || nv && nv.endsWith(v); },
            '*=': function(nv, v) { return nv == v || nv && nv.include(v); },
            '~=': function(nv, v) { return (' ' + nv + ' ').include(' ' + v + ' '); },
            '|=': function(nv, v) { return ('-' + (nv || "").toUpperCase() +
             '-').include('-' + (v || "").toUpperCase() + '-'); }
          },
      
          split: function(expression) {
            var expressions = [];
            expression.scan(/(([\w#:.~>+()\s-]+|\*|\[.*?\])+)\s*(,|$)/, function(m) {
              expressions.push(m[1].strip());
            });
            return expressions;
          },
      
          matchElements: function(elements, expression) {
            var matches = $$(expression), h = Selector.handlers;
            h.mark(matches);
            for (var i = 0, results = [], element; element = elements[i]; i++)
              if (element._countedByPrototype) results.push(element);
            h.unmark(matches);
            return results;
          },
      
          findElement: function(elements, expression, index) {
            if (Object.isNumber(expression)) {
              index = expression; expression = false;
            }
            return Selector.matchElements(elements, expression || '*')[index || 0];
          },
      
          findChildElements: function(element, expressions) {
            expressions = Selector.split(expressions.join(','));
            var results = [], h = Selector.handlers;
            for (var i = 0, l = expressions.length, selector; i < l; i++) {
              selector = new Selector(expressions[i].strip());
              h.concat(results, selector.findElements(element));
            }
            return (l > 1) ? h.unique(results) : results;
          }
        });
      
        if (Prototype.Browser.IE) {
          Object.extend(Selector.handlers, {
            concat: function(a, b) {
              for (var i = 0, node; node = b[i]; i++)
                if (node.tagName !== "!") a.push(node);
              return a;
            }
          });
        }
      
        function $$() {
          return Selector.findChildElements(document, $A(arguments));
        }
      
        var Form = {
          reset: function(form) {
            form = $(form);
            form.reset();
            return form;
          },
      
          serializeElements: function(elements, options) {
            if (typeof options != 'object') options = { hash: !!options };
            else if (Object.isUndefined(options.hash)) options.hash = true;
            var key, value, submitted = false, submit = options.submit;
      
            var data = elements.inject({ }, function(result, element) {
              if (!element.disabled && element.name) {
                key = element.name; value = $(element).getValue();
                if (value != null && element.type != 'file' && (element.type != 'submit' || (!submitted &&
                    submit !== false && (!submit || key == submit) && (submitted = true)))) {
                  if (key in result) {
                    if (!Object.isArray(result[key])) result[key] = [result[key]];
                    result[key].push(value);
                  }
                  else result[key] = value;
                }
              }
              return result;
            });
      
            return options.hash ? data : Object.toQueryString(data);
          }
        };
      
        Form.Methods = {
          serialize: function(form, options) {
            return Form.serializeElements(Form.getElements(form), options);
          },
      
          getElements: function(form) {
            var elements = $(form).getElementsByTagName('*'),
                element,
                arr = [ ],
                serializers = Form.Element.Serializers;
            for (var i = 0; element = elements[i]; i++) {
              arr.push(element);
            }
            return arr.inject([], function(elements, child) {
              if (serializers[child.tagName.toLowerCase()])
                elements.push(Element.extend(child));
              return elements;
            })
          },
      
          getInputs: function(form, typeName, name) {
            form = $(form);
            var inputs = form.getElementsByTagName('input');
      
            if (!typeName && !name) return $A(inputs).map(Element.extend);
      
            for (var i = 0, matchingInputs = [], length = inputs.length; i < length; i++) {
              var input = inputs[i];
              if ((typeName && input.type != typeName) || (name && input.name != name))
                continue;
              matchingInputs.push(Element.extend(input));
            }
      
            return matchingInputs;
          },
      
          disable: function(form) {
            form = $(form);
            Form.getElements(form).invoke('disable');
            return form;
          },
      
          enable: function(form) {
            form = $(form);
            Form.getElements(form).invoke('enable');
            return form;
          },
      
          findFirstElement: function(form) {
            var elements = $(form).getElements().findAll(function(element) {
              return 'hidden' != element.type && !element.disabled;
            });
            var firstByIndex = elements.findAll(function(element) {
              return element.hasAttribute('tabIndex') && element.tabIndex >= 0;
            }).sortBy(function(element) { return element.tabIndex }).first();
      
            return firstByIndex ? firstByIndex : elements.find(function(element) {
              return /^(?:input|select|textarea)$/i.test(element.tagName);
            });
          },
      
          focusFirstElement: function(form) {
            form = $(form);
            form.findFirstElement().activate();
            return form;
          },
      
          request: function(form, options) {
            form = $(form), options = Object.clone(options || { });
      
            var params = options.parameters, action = form.readAttribute('action') || '';
            if (action.blank()) action = window.location.href;
            options.parameters = form.serialize(true);
      
            if (params) {
              if (Object.isString(params)) params = params.toQueryParams();
              Object.extend(options.parameters, params);
            }
      
            if (form.hasAttribute('method') && !options.method)
              options.method = form.method;
      
            return new Ajax.Request(action, options);
          }
        };
      
        /*--------------------------------------------------------------------------*/
      
      
        Form.Element = {
          focus: function(element) {
            $(element).focus();
            return element;
          },
      
          select: function(element) {
            $(element).select();
            return element;
          }
        };
      
        Form.Element.Methods = {
      
          serialize: function(element) {
            element = $(element);
            if (!element.disabled && element.name) {
              var value = element.getValue();
              if (value != undefined) {
                var pair = { };
                pair[element.name] = value;
                return Object.toQueryString(pair);
              }
            }
            return '';
          },
      
          getValue: function(element) {
            element = $(element);
            var method = element.tagName.toLowerCase();
            return Form.Element.Serializers[method](element);
          },
      
          setValue: function(element, value) {
            element = $(element);
            var method = element.tagName.toLowerCase();
            Form.Element.Serializers[method](element, value);
            return element;
          },
      
          clear: function(element) {
            $(element).value = '';
            return element;
          },
      
          present: function(element) {
            return $(element).value != '';
          },
      
          activate: function(element) {
            element = $(element);
            try {
              element.focus();
              if (element.select && (element.tagName.toLowerCase() != 'input' ||
                  !(/^(?:button|reset|submit)$/i.test(element.type))))
                element.select();
            } catch (e) { }
            return element;
          },
      
          disable: function(element) {
            element = $(element);
            element.disabled = true;
            return element;
          },
      
          enable: function(element) {
            element = $(element);
            element.disabled = false;
            return element;
          }
        };
      
        /*--------------------------------------------------------------------------*/
      
        var Field = Form.Element;
      
        var $F = Form.Element.Methods.getValue;
      
        /*--------------------------------------------------------------------------*/
      
        Form.Element.Serializers = {
          input: function(element, value) {
            switch (element.type.toLowerCase()) {
              case 'checkbox':
              case 'radio':
                return Form.Element.Serializers.inputSelector(element, value);
              default:
                return Form.Element.Serializers.textarea(element, value);
            }
          },
      
          inputSelector: function(element, value) {
            if (Object.isUndefined(value)) return element.checked ? element.value : null;
            else element.checked = !!value;
          },
      
          textarea: function(element, value) {
            if (Object.isUndefined(value)) return element.value;
            else element.value = value;
          },
      
          select: function(element, value) {
            if (Object.isUndefined(value))
              return this[element.type == 'select-one' ?
                'selectOne' : 'selectMany'](element);
            else {
              var opt, currentValue, single = !Object.isArray(value);
              for (var i = 0, length = element.length; i < length; i++) {
                opt = element.options[i];
                currentValue = this.optionValue(opt);
                if (single) {
                  if (currentValue == value) {
                    opt.selected = true;
                    return;
                  }
                }
                else opt.selected = value.include(currentValue);
              }
            }
          },
      
          selectOne: function(element) {
            var index = element.selectedIndex;
            return index >= 0 ? this.optionValue(element.options[index]) : null;
          },
      
          selectMany: function(element) {
            var values, length = element.length;
            if (!length) return null;
      
            for (var i = 0, values = []; i < length; i++) {
              var opt = element.options[i];
              if (opt.selected) values.push(this.optionValue(opt));
            }
            return values;
          },
      
          optionValue: function(opt) {
            return Element.extend(opt).hasAttribute('value') ? opt.value : opt.text;
          }
        };
      
        /*--------------------------------------------------------------------------*/
      
      
        Abstract.TimedObserver = Class.create(PeriodicalExecuter, {
          initialize: function($super, element, frequency, callback) {
            $super(callback, frequency);
            this.element   = $(element);
            this.lastValue = this.getValue();
          },
      
          execute: function() {
            var value = this.getValue();
            if (Object.isString(this.lastValue) && Object.isString(value) ?
                this.lastValue != value : String(this.lastValue) != String(value)) {
              this.callback(this.element, value);
              this.lastValue = value;
            }
          }
        });
      
        Form.Element.Observer = Class.create(Abstract.TimedObserver, {
          getValue: function() {
            return Form.Element.getValue(this.element);
          }
        });
      
        Form.Observer = Class.create(Abstract.TimedObserver, {
          getValue: function() {
            return Form.serialize(this.element);
          }
        });
      
        /*--------------------------------------------------------------------------*/
      
        Abstract.EventObserver = Class.create({
          initialize: function(element, callback) {
            this.element  = $(element);
            this.callback = callback;
      
            this.lastValue = this.getValue();
            if (this.element.tagName.toLowerCase() == 'form')
              this.registerFormCallbacks();
            else
              this.registerCallback(this.element);
          },
      
          onElementEvent: function() {
            var value = this.getValue();
            if (this.lastValue != value) {
              this.callback(this.element, value);
              this.lastValue = value;
            }
          },
      
          registerFormCallbacks: function() {
            Form.getElements(this.element).each(this.registerCallback, this);
          },
      
          registerCallback: function(element) {
            if (element.type) {
              switch (element.type.toLowerCase()) {
                case 'checkbox':
                case 'radio':
                  Event.observe(element, 'click', this.onElementEvent.bind(this));
                  break;
                default:
                  Event.observe(element, 'change', this.onElementEvent.bind(this));
                  break;
              }
            }
          }
        });
      
        Form.Element.EventObserver = Class.create(Abstract.EventObserver, {
          getValue: function() {
            return Form.Element.getValue(this.element);
          }
        });
      
        Form.EventObserver = Class.create(Abstract.EventObserver, {
          getValue: function() {
            return Form.serialize(this.element);
          }
        });
        (function() {
      
          var Event = {
            KEY_BACKSPACE: 8,
            KEY_TAB:       9,
            KEY_RETURN:   13,
            KEY_ESC:      27,
            KEY_LEFT:     37,
            KEY_UP:       38,
            KEY_RIGHT:    39,
            KEY_DOWN:     40,
            KEY_DELETE:   46,
            KEY_HOME:     36,
            KEY_END:      35,
            KEY_PAGEUP:   33,
            KEY_PAGEDOWN: 34,
            KEY_INSERT:   45,
      
            cache: {}
          };
      
          var docEl = document.documentElement;
          var MOUSEENTER_MOUSELEAVE_EVENTS_SUPPORTED = 'onmouseenter' in docEl
            && 'onmouseleave' in docEl;
      
          var _isButton;
          if (Prototype.Browser.IE) {
            var buttonMap = { 0: 1, 1: 4, 2: 2 };
            _isButton = function(event, code) {
              return event.button === buttonMap[code];
            };
          } else if (Prototype.Browser.WebKit) {
            _isButton = function(event, code) {
              switch (code) {
                case 0: return event.which == 1 && !event.metaKey;
                case 1: return event.which == 1 && event.metaKey;
                default: return false;
              }
            };
          } else {
            _isButton = function(event, code) {
              return event.which ? (event.which === code + 1) : (event.button === code);
            };
          }
      
          function isLeftClick(event)   { return _isButton(event, 0) }
      
          function isMiddleClick(event) { return _isButton(event, 1) }
      
          function isRightClick(event)  { return _isButton(event, 2) }
      
          function element(event) {
            event = Event.extend(event);
      
            var node = event.target, type = event.type,
             currentTarget = event.currentTarget;
      
            if (currentTarget && currentTarget.tagName) {
              if (type === 'load' || type === 'error' ||
                (type === 'click' && currentTarget.tagName.toLowerCase() === 'input'
                  && currentTarget.type === 'radio'))
                    node = currentTarget;
            }
      
            if (node.nodeType == Node.TEXT_NODE)
              node = node.parentNode;
      
            return Element.extend(node);
          }
      
          function findElement(event, expression) {
            var element = Event.element(event);
            if (!expression) return element;
            var elements = [element].concat(element.ancestors());
            return Selector.findElement(elements, expression, 0);
          }
      
          function pointer(event) {
            return { x: pointerX(event), y: pointerY(event) };
          }
      
          function pointerX(event) {
            var docElement = document.documentElement,
             body = document.body || { scrollLeft: 0 };
      
            return event.pageX || (event.clientX +
              (docElement.scrollLeft || body.scrollLeft) -
              (docElement.clientLeft || 0));
          }
      
          function pointerY(event) {
            var docElement = document.documentElement,
             body = document.body || { scrollTop: 0 };
      
            return  event.pageY || (event.clientY +
               (docElement.scrollTop || body.scrollTop) -
               (docElement.clientTop || 0));
          }
      
      
          function stop(event) {
            Event.extend(event);
            event.preventDefault();
            event.stopPropagation();
      
            event.stopped = true;
          }
      
          Event.Methods = {
            isLeftClick: isLeftClick,
            isMiddleClick: isMiddleClick,
            isRightClick: isRightClick,
      
            element: element,
            findElement: findElement,
      
            pointer: pointer,
            pointerX: pointerX,
            pointerY: pointerY,
      
            stop: stop
          };
      
      
          var methods = Object.keys(Event.Methods).inject({ }, function(m, name) {
            m[name] = Event.Methods[name].methodize();
            return m;
          });
      
          if (Prototype.Browser.IE) {
            function _relatedTarget(event) {
              var element;
              switch (event.type) {
                case 'mouseover': element = event.fromElement; break;
                case 'mouseout':  element = event.toElement;   break;
                default: return null;
              }
              return Element.extend(element);
            }
      
            Object.extend(methods, {
              stopPropagation: function() { this.cancelBubble = true },
              preventDefault:  function() { this.returnValue = false },
              inspect: function() { return '[object Event]' }
            });
      
            Event.extend = function(event, element) {
              if (!event) return false;
              if (event._extendedByPrototype) return event;
      
              event._extendedByPrototype = Prototype.emptyFunction;
              var pointer = Event.pointer(event);
      
              Object.extend(event, {
                target: event.srcElement || element,
                relatedTarget: _relatedTarget(event),
                pageX:  pointer.x,
                pageY:  pointer.y
              });
      
              return Object.extend(event, methods);
            };
          } else {
            Event.prototype = window.Event.prototype || document.createEvent('HTMLEvents').__proto__;
            Object.extend(Event.prototype, methods);
            Event.extend = Prototype.K;
          }
      
          function _createResponder(element, eventName, handler) {
            var registry = Element.retrieve(element, 'prototype_event_registry');
      
            if (Object.isUndefined(registry)) {
              CACHE.push(element);
              registry = Element.retrieve(element, 'prototype_event_registry', $H());
            }
      
            var respondersForEvent = registry.get(eventName);
            if (Object.isUndefined(respondersForEvent)) {
              respondersForEvent = [];
              registry.set(eventName, respondersForEvent);
            }
      
            if (respondersForEvent.pluck('handler').include(handler)) return false;
      
            var responder;
            if (eventName.include(":")) {
              responder = function(event) {
                if (Object.isUndefined(event.eventName))
                  return false;
      
                if (event.eventName !== eventName)
                  return false;
      
                Event.extend(event, element);
                handler.call(element, event);
              };
            } else {
              if (!MOUSEENTER_MOUSELEAVE_EVENTS_SUPPORTED &&
               (eventName === "mouseenter" || eventName === "mouseleave")) {
                if (eventName === "mouseenter" || eventName === "mouseleave") {
                  responder = function(event) {
                    Event.extend(event, element);
      
                    var parent = event.relatedTarget;
                    while (parent && parent !== element) {
                      try { parent = parent.parentNode; }
                      catch(e) { parent = element; }
                    }
      
                    if (parent === element) return;
      
                    handler.call(element, event);
                  };
                }
              } else {
                responder = function(event) {
                  Event.extend(event, element);
                  handler.call(element, event);
                };
              }
            }
      
            responder.handler = handler;
            respondersForEvent.push(responder);
            return responder;
          }
      
          function _destroyCache() {
            for (var i = 0, length = CACHE.length; i < length; i++) {
              Event.stopObserving(CACHE[i]);
              CACHE[i] = null;
            }
          }
      
          var CACHE = [];
      
          if (Prototype.Browser.IE)
            window.attachEvent('onunload', _destroyCache);
      
          if (Prototype.Browser.WebKit)
            window.addEventListener('unload', Prototype.emptyFunction, false);
      
      
          var _getDOMEventName = Prototype.K;
      
          if (!MOUSEENTER_MOUSELEAVE_EVENTS_SUPPORTED) {
            _getDOMEventName = function(eventName) {
              var translations = { mouseenter: "mouseover", mouseleave: "mouseout" };
              return eventName in translations ? translations[eventName] : eventName;
            };
          }
      
          function observe(element, eventName, handler) {
            element = $(element);
      
            var responder = _createResponder(element, eventName, handler);
      
            if (!responder) return element;
      
            if (eventName.include(':')) {
              if (element.addEventListener)
                element.addEventListener("dataavailable", responder, false);
              else {
                element.attachEvent("ondataavailable", responder);
                element.attachEvent("onfilterchange", responder);
              }
            } else {
              var actualEventName = _getDOMEventName(eventName);
      
              if (element.addEventListener)
                element.addEventListener(actualEventName, responder, false);
              else
                element.attachEvent("on" + actualEventName, responder);
            }
      
            return element;
          }
      
          function stopObserving(element, eventName, handler) {
            element = $(element);
      
            var registry = Element.retrieve(element, 'prototype_event_registry');
      
            if (Object.isUndefined(registry)) return element;
      
            if (eventName && !handler) {
              var responders = registry.get(eventName);
      
              if (Object.isUndefined(responders)) return element;
      
              responders.each( function(r) {
                Element.stopObserving(element, eventName, r.handler);
              });
              return element;
            } else if (!eventName) {
              registry.each( function(pair) {
                var eventName = pair.key, responders = pair.value;
      
                responders.each( function(r) {
                  Element.stopObserving(element, eventName, r.handler);
                });
              });
              return element;
            }
      
            var responders = registry.get(eventName);
      
            if (!responders) return;
      
            var responder = responders.find( function(r) { return r.handler === handler; });
            if (!responder) return element;
      
            var actualEventName = _getDOMEventName(eventName);
      
            if (eventName.include(':')) {
              if (element.removeEventListener)
                element.removeEventListener("dataavailable", responder, false);
              else {
                element.detachEvent("ondataavailable", responder);
                element.detachEvent("onfilterchange",  responder);
              }
            } else {
              if (element.removeEventListener)
                element.removeEventListener(actualEventName, responder, false);
              else
                element.detachEvent('on' + actualEventName, responder);
            }
      
            registry.set(eventName, responders.without(responder));
      
            return element;
          }
      
          function fire(element, eventName, memo, bubble) {
            element = $(element);
      
            if (Object.isUndefined(bubble))
              bubble = true;
      
            if (element == document && document.createEvent && !element.dispatchEvent)
              element = document.documentElement;
      
            var event;
            if (document.createEvent) {
              event = document.createEvent('HTMLEvents');
              event.initEvent('dataavailable', true, true);
            } else {
              event = document.createEventObject();
              event.eventType = bubble ? 'ondataavailable' : 'onfilterchange';
            }
      
            event.eventName = eventName;
            event.memo = memo || { };
      
            if (document.createEvent)
              element.dispatchEvent(event);
            else
              element.fireEvent(event.eventType, event);
      
            return Event.extend(event);
          }
      
      
          Object.extend(Event, Event.Methods);
      
          Object.extend(Event, {
            fire:          fire,
            observe:       observe,
            stopObserving: stopObserving
          });
      
          Element.addMethods({
            fire:          fire,
      
            observe:       observe,
      
            stopObserving: stopObserving
          });
      
          Object.extend(document, {
            fire:          fire.methodize(),
      
            observe:       observe.methodize(),
      
            stopObserving: stopObserving.methodize(),
      
            loaded:        false
          });
      
          if (window.Event) Object.extend(window.Event, Event);
          else window.Event = Event;
        })();
      
        (function() {
          /* Support for the DOMContentLoaded event is based on work by Dan Webb,
             Matthias Miller, Dean Edwards, John Resig, and Diego Perini. */
      
          var timer;
      
          function fireContentLoadedEvent() {
            if (document.loaded) return;
            if (timer) window.clearTimeout(timer);
            document.loaded = true;
            document.fire('dom:loaded');
          }
      
          function checkReadyState() {
            if (document.readyState === 'complete') {
              document.stopObserving('readystatechange', checkReadyState);
              fireContentLoadedEvent();
            }
          }
      
          function pollDoScroll() {
            try { document.documentElement.doScroll('left'); }
            catch(e) {
              timer = pollDoScroll.defer();
              return;
            }
            fireContentLoadedEvent();
          }
      
          if (document.addEventListener) {
            document.addEventListener('DOMContentLoaded', fireContentLoadedEvent, false);
          } else {
            document.observe('readystatechange', checkReadyState);
            if (window == top)
              timer = pollDoScroll.defer();
          }
      
          Event.observe(window, 'load', fireContentLoadedEvent);
        })();
      
        Element.addMethods();
      
        /*------------------------------- DEPRECATED -------------------------------*/
      
        Hash.toQueryString = Object.toQueryString;
      
        var Toggle = { display: Element.toggle };
      
        Element.Methods.childOf = Element.Methods.descendantOf;
      
        var Insertion = {
          Before: function(element, content) {
            return Element.insert(element, {before:content});
          },
      
          Top: function(element, content) {
            return Element.insert(element, {top:content});
          },
      
          Bottom: function(element, content) {
            return Element.insert(element, {bottom:content});
          },
      
          After: function(element, content) {
            return Element.insert(element, {after:content});
          }
        };
      
        var $continue = new Error('"throw $continue" is deprecated, use "return" instead');
      
        var Position = {
          includeScrollOffsets: false,
      
          prepare: function() {
            this.deltaX =  window.pageXOffset
                        || document.documentElement.scrollLeft
                        || document.body.scrollLeft
                        || 0;
            this.deltaY =  window.pageYOffset
                        || document.documentElement.scrollTop
                        || document.body.scrollTop
                        || 0;
          },
      
          within: function(element, x, y) {
            if (this.includeScrollOffsets)
              return this.withinIncludingScrolloffsets(element, x, y);
            this.xcomp = x;
            this.ycomp = y;
            this.offset = Element.cumulativeOffset(element);
      
            return (y >= this.offset[1] &&
                    y <  this.offset[1] + element.offsetHeight &&
                    x >= this.offset[0] &&
                    x <  this.offset[0] + element.offsetWidth);
          },
      
          withinIncludingScrolloffsets: function(element, x, y) {
            var offsetcache = Element.cumulativeScrollOffset(element);
      
            this.xcomp = x + offsetcache[0] - this.deltaX;
            this.ycomp = y + offsetcache[1] - this.deltaY;
            this.offset = Element.cumulativeOffset(element);
      
            return (this.ycomp >= this.offset[1] &&
                    this.ycomp <  this.offset[1] + element.offsetHeight &&
                    this.xcomp >= this.offset[0] &&
                    this.xcomp <  this.offset[0] + element.offsetWidth);
          },
      
          overlap: function(mode, element) {
            if (!mode) return 0;
            if (mode == 'vertical')
              return ((this.offset[1] + element.offsetHeight) - this.ycomp) /
                element.offsetHeight;
            if (mode == 'horizontal')
              return ((this.offset[0] + element.offsetWidth) - this.xcomp) /
                element.offsetWidth;
          },
      
      
          cumulativeOffset: Element.Methods.cumulativeOffset,
      
          positionedOffset: Element.Methods.positionedOffset,
      
          absolutize: function(element) {
            Position.prepare();
            return Element.absolutize(element);
          },
      
          relativize: function(element) {
            Position.prepare();
            return Element.relativize(element);
          },
      
          realOffset: Element.Methods.cumulativeScrollOffset,
      
          offsetParent: Element.Methods.getOffsetParent,
      
          page: Element.Methods.viewportOffset,
      
          clone: function(source, target, options) {
            options = options || { };
            return Element.clonePosition(target, source, options);
          }
        };
      
        /*--------------------------------------------------------------------------*/
      
        if (!document.getElementsByClassName) document.getElementsByClassName = function(instanceMethods){
          function iter(name) {
            return name.blank() ? null : "[contains(concat(' ', @class, ' '), ' " + name + " ')]";
          }
      
          instanceMethods.getElementsByClassName = Prototype.BrowserFeatures.XPath ?
          function(element, className) {
            className = className.toString().strip();
            var cond = /\s/.test(className) ? $w(className).map(iter).join('') : iter(className);
            return cond ? document._getElementsByXPath('.//*' + cond, element) : [];
          } : function(element, className) {
            className = className.toString().strip();
            var elements = [], classNames = (/\s/.test(className) ? $w(className) : null);
            if (!classNames && !className) return elements;
      
            var nodes = $(element).getElementsByTagName('*');
            className = ' ' + className + ' ';
      
            for (var i = 0, child, cn; child = nodes[i]; i++) {
              if (child.className && (cn = ' ' + child.className + ' ') && (cn.include(className) ||
                  (classNames && classNames.all(function(name) {
                    return !name.toString().blank() && cn.include(' ' + name + ' ');
                  }))))
                elements.push(Element.extend(child));
            }
            return elements;
          };
      
          return function(className, parentElement) {
            return $(parentElement || document.body).getElementsByClassName(className);
          };
        }(Element.Methods);
      
        /*--------------------------------------------------------------------------*/
      
        Element.ClassNames = Class.create();
        Element.ClassNames.prototype = {
          initialize: function(element) {
            this.element = $(element);
          },
      
          _each: function(iterator) {
            this.element.className.split(/\s+/).select(function(name) {
              return name.length > 0;
            })._each(iterator);
          },
      
          set: function(className) {
            this.element.className = className;
          },
      
          add: function(classNameToAdd) {
            if (this.include(classNameToAdd)) return;
            this.set($A(this).concat(classNameToAdd).join(' '));
          },
      
          remove: function(classNameToRemove) {
            if (!this.include(classNameToRemove)) return;
            this.set($A(this).without(classNameToRemove).join(' '));
          },
      
          toString: function() {
            return $A(this).join(' ');
          }
        };
      
        Object.extend(Element.ClassNames.prototype, Enumerable);
      
        /*--------------------------------------------------------------------------*/
    21: 
      name: body
      filter_id: Textile
      page_id: 12
      id: 21
      content: |
        <iframe width="868" height="480" frameborder="0" style="border:1px solid #dbd6d1;" scrolling="no" marginheight="0" marginwidth="0" src="http://maps.google.com/maps/ms?ie=UTF8&amp;hl=en&amp;t=k&amp;s=AARTsJoMI8Z8NYIgz5ckH51H72GUL2fOcw&amp;msa=0&amp;msid=113091985902776583734.00045f77d6a96be3a6389&amp;ll=45.519759,-122.668791&amp;spn=0.030069,0.075531&amp;z=14&amp;output=embed"></iframe><br /><small><a href="http://maps.google.com/maps/ms?ie=UTF8&amp;hl=en&amp;t=k&amp;msa=0&amp;msid=113091985902776583734.00045f77d6a96be3a6389&amp;ll=45.519759,-122.668791&amp;spn=0.030069,0.075531&amp;z=14&amp;source=embed" style="color:#0000FF;text-align:left">View Larger Map</a></small>

    10: 
      name: body
      filter_id: Textile
      page_id: 9
      id: 10
      content: "h2. Since 1999...\r\n\
        \r\n\
        Duis vitae mi. Nunc tristique mauris malesuada odio. Integer pharetra, urna sit amet scelerisque sollicitudin, felis est rhoncus nibh, sed sollicitudin ipsum lacus quis metus. In hac habitasse platea dictumst. Sed quis sem eu libero tristique vehicula. In fermentum, pede ut congue placerat, arcu erat tempor augue, id ornare ipsum ante vitae tellus. Duis bibendum quam vitae lectus. Curabitur euismod nulla a risus. Suspendisse erat. Nulla facilisi. Integer odio felis, sollicitudin in, feugiat non, dictum sit amet, elit. "
  Users: 
    1: 
      updated_by_id: 
      session_token: 
      salt: 258eadf34cd675e3ec8a08758886cb35d6694f24
      name: Administrator
      created_at: 2010-10-16 04:02:00 Z
      updated_at: 2010-10-16 04:02:00 Z
      notes: 
      created_by_id: 
      lock_version: 0
      designer: false
      admin: true
      id: 1
      locale: 
      password: 4ceb2c1bb155a172f1dba74440439361eb15da8f
      login: admin
      email: 
